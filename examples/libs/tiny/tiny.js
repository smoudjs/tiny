!function(){var t={498:function(){var t={VERSION:'2.2.2',style2hex:function(t){return+t.replace('#','0x')},hex2style:function(t){return'#'+('00000'+(0|t).toString(16)).substr(-6)},hex2rgb:function(t){return[(t>>16&255)/255,(t>>8&255)/255,(255&t)/255]},rgb2hex:function(t){return(255*t[0]<<16)+(255*t[1]<<8)+255*t[2]},style2rgb:function(e){return t.hex2rgb(t.style2hex(e))}};window.Tiny=t},847:function(){Date.now||(Date.now=function(){return(new Date).getTime()}),'undefined'==typeof Float32Array&&(window.Float32Array=Array,window.Uint16Array=Array),void 0===Object.assign&&(Object.assign=function(t){'use strict';if(null==t)throw new TypeError('Cannot convert undefined or null to object');for(var e=Object(t),i=1;i<arguments.length;i++){var r=arguments[i];if(null!=r)for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e})}},e={};function i(r){var s=e[r];if(void 0!==s)return s.exports;var n=e[r]={exports:{}};return t[r](n,n.exports,i),n.exports}!function(){"use strict";i(847),i(498);var t=function(t,e,i){this.width=t,this.height=e,this.canvas=document.createElement('canvas'),this.context=this.canvas.getContext('2d',i),this.canvas.width=t,this.canvas.height=e};function e(){this.a=[],this.n=0}t.prototype.constructor=t,t.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.width,this.height)},t.prototype.resize=function(t,e){this.width=this.canvas.width=t,this.height=this.canvas.height=e};var r={call:function(t){t&&(t=t.prototype||t,r.mixin(t))},mixin:function(t){const i={};function r(t,r,s,n){var h=i[t];h||(h=i[t]=new e),h.a.push(r,s||null,n||!1),h.n+=3}t.once=function(t,e,i){r(t,e,i,!0)},t.on=r,t.off=function(t,e,r){if(i[t]){var s=i[t].a;if(e)if(r)for(n=0;n<s.length;n+=3)s[n]==e&&s[n+1]==r&&(s.splice(n,3),n-=3);else for(var n=0;n<s.length;n+=3)s[n]==e&&(s.splice(n,3),n-=3);else s.length=0;0==s.length&&delete i[t]}},t.emit=function(t,e,r,s){var n=i[t];if(n){var h=n.a;n.n=0;for(var o,a,u=arguments.length,l=0;l<h.length-n.n;l+=3)o=h[l],a=h[l+1],h[l+2]&&(h.splice(l,3),l-=3),u<=1?o.call(a):2==u?o.call(a,e):3==u?o.call(a,e,r):o.call(a,e,r,s);0==h.length&&delete i[t]}}}},s=Math.PI/180,n=180/Math.PI,h={distance:function(t,e,i,r){var s=t-i,n=e-r;return Math.sqrt(s*s+n*n)},degToRad:function(t){return t*s},radToDeg:function(t){return t*n},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t}};const o={NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},a={LINEAR:0,NEAREST:1},u={POLY:0,RECT:1,CIRC:2,ELIP:3,RREC:4};Tiny.CanvasBuffer=t,Tiny.EventEmitter=r,Tiny.Math=h,Object.assign(Tiny,o),Object.assign(Tiny,a),Object.assign(Tiny,u);var l=[];function c(t,e){l.push({name:t,_class_:e})}var d,p,f,y,g,v=function(){},m=function(t){this.callbackContext=this,this.state=0,this.timeScale=1,this.width=0,this.height=0,this.systems=[],this.updatable=[],this.paused=!1,this.pauseDuration=0,this.inputView=document.body,Tiny.app||(Tiny.app=this),r.mixin(this),t=t||{},this.boot=t.boot||this.boot||v,this.preload=t.preload||this.preload||v,this.create=t.create||this.create||v,this.update=t.update||this.update||v,this.render=t.render||this.render||v,this._resize_cb=t.resize||v,this._destroy_cb=t.destroy||v;var e=this;setTimeout((function(){e._boot()}),0)};m.prototype._boot=function(){for(var t=0;t<l.length;t++){var e=l[t],i=new e._class_(this);this.systems.push(i),i.update&&this.updatable.push(i),e.name&&(this[e.name]=i)}Tiny.RAF&&(this.raf=new Tiny.RAF(this)),this.boot.call(this.callbackContext);var r=this;setTimeout((function(){r.load?r._preload():r._create()}),0)},m.prototype._preload=function(){this.preload.call(this.callbackContext),this.state=1,this.load.start(this._create)},m.prototype._create=function(){this.emit('load'),this.create.call(this.callbackContext),this.raf&&this.raf.start(),this.state=2},m.prototype.pause=function(){if(this.raf&&this.raf.reset(),!this.paused){for(var t=0;t<this.systems.length;t++)this.systems[t].pause&&this.systems[t].pause();this.paused=!0}},m.prototype.resume=function(){if(this.raf&&this.raf.reset(),this.paused){for(var t=0;t<this.systems.length;t++)this.systems[t].resume&&this.systems[t].resume();this.paused=!1}},m.prototype._update=function(t,e){if(this.paused)this.pauseDuration+=e;else{e*=this.timeScale,this.update.call(this.callbackContext,t,e),this.emit('update',e);for(var i=0;i<this.updatable.length;i++)this.updatable[i].update(e)}this.render(),this.emit('postrender')},m.prototype.resize=function(t,e){this.width=t||this.width,this.height=e||this.height,this.state>0&&(this._resize_cb.call(this.callbackContext,this.width,this.height),this.emit('resize',t,e));var i=this;setTimeout((function(){i.input&&i.input.updateBounds()}),0)},m.prototype.destroy=function(t){for(var e=0;e<this.systems.length;e++)this.systems[e].destroy&&this.systems[e].destroy(t);this.paused=!0,t&&this.load.clearCache(),this.raf&&this.raf.stop(),this._destroy_cb.call(this.callbackContext),Tiny.app===this&&(Tiny.app=null)};var _=function(){return(new Date).getTime()};void 0!==self.performance&&void 0!==self.performance.now?_=self.performance.now.bind(self.performance):void 0!==Date.now&&(_=Date.now);var x=function(t,e){void 0===e&&(e=!1),this.game=t,this.isRunning=!1,this.forceSetTimeOut=e;for(var i=['ms','moz','webkit','o'],r=0;r<i.length&&!window.requestAnimationFrame;r++)window.requestAnimationFrame=window[i[r]+'RequestAnimationFrame'],window.cancelAnimationFrame=window[i[r]+'CancelAnimationFrame']||window[i[r]+'CancelRequestAnimationFrame'];d=!1,p=null,f=null,y=0,g=0};x.prototype={start:function(){y=_(),this.isRunning=!0;var t=this;!window.requestAnimationFrame||this.forceSetTimeOut?(d=!0,p=function(){return t.updateSetTimeout()},f=window.setTimeout(p,0)):(d=!1,p=function(){return t.updateRAF()},f=window.requestAnimationFrame(p))},updateRAF:function(){g=_(),this.isRunning&&(this.game._update(Math.floor(g),g-y),f=window.requestAnimationFrame(p)),y=g},updateSetTimeout:function(){g=_(),this.isRunning&&(this.game._update(Math.floor(g),g-y),f=window.setTimeout(p,x.timeToCall)),y=g},reset:function(){y=_()},stop:function(){d?clearTimeout(f):window.cancelAnimationFrame(f),this.isRunning=!1}},x.timeToCall=15;var w=0;function b(){return++w}function T(t){return!(t&t-1||!t)}var E=function(t,e){this.resolution=1,this.width=100,this.height=100,this.scaleMode=e||0,this.loaded=!1,this.source=t,this._UID=b(),this.premultipliedAlpha=!0,this._glTextures=[],this.mipmap=!1,this._dirty=[!0,!0,!0,!0],t&&((t.complete||t.getContext)&&t.width&&t.height?this.onLoad():t.onload=this.onLoad.bind(this),this.imageUrl=null,this._powerOf2=!1)};E.prototype.constructor=E,E.prototype.onLoad=function(t){this.loaded=!0,this.width=this.source.naturalWidth||this.source.width,this.height=this.source.naturalHeight||this.source.height,this.dirty(),this.onload&&this.onload()},E.prototype.destroy=function(){this.imageUrl?(delete BaseTextureCache[this.imageUrl],delete PIXI.TextureCache[this.imageUrl],this.imageUrl=null,navigator.isCocoonJS||(this.source.src='')):this.source&&this.source._pixiId&&delete BaseTextureCache[this.source._pixiId],this.source=null,this.unloadFromGPU()},E.prototype.dirty=function(){for(var t=0;t<this._glTextures.length;t++)this._dirty[t]=!0},E.prototype.unloadFromGPU=function(){this.dirty();for(var t=this._glTextures.length-1;t>=0;t--){var e=this._glTextures[t],i=Tiny.glContexts[t];i&&e&&i.deleteTexture(e)}this._glTextures.length=0,this.dirty()};var A,S={image:{},texture:{}},R=function(t){r.mixin(this),t.cache=S,this.game=t,this.list=[]};R.prototype={clearCache:function(){for(var t in S.texture)S.texture[t].destroy();for(var t in S)S[t]={}},all:function(t){this.list=this.list.concat(t)},image:function(t,e){this.list.push({src:e,key:t,type:'image'})},spritesheet:function(t,e,i,r,s,n){var h={src:e,key:t,type:'spritesheet'};'number'==typeof i?(h.width=i,h.height=r,h.total=s,h.duration=n):i.length>0&&(h.data=i),this.list.push(h)},atlas:function(t,e,i){this.list.push({src:e,key:t,data:i,type:'atlas'})},start:function(t){var e=this,i=e.game,r=e.list,s=r.length;function n(){var t=r.shift(),e=R[t.type];e?e(t,h):h()}function h(h,o){e.emit('progress',1-r.length/s),0!=r.length?n():(e.emit('complete'),t.call(i))}0!=s?n():t.call(i)}},R.atlas=function(t,e){var i=t.key;R.image(t,(function(t,r){for(var s=0;s<t.data.length;s++){var n=i+'.'+t.data[s].name,h=new Tiny.Texture(r,t.data[s]);h.key=i,S.texture[n]=h}e()}))},R.spritesheet=function(t,e){var i=t.key;R.image(t,(function(t,r){var s,n,h;if(t.data){var o=t.data;s=o.length-1;for(var a=0;a<=s;a++)n=i+'.'+a,(h=new Tiny.Texture(r,{name:a,x:Math.floor(o[a].x),y:Math.floor(o[a].y),width:Math.floor(o[a].width),height:Math.floor(o[a].height),duration:o[a].duration})).key=i,h.lastFrame=s,S.texture[n]=h}else{var u=r.width,l=r.height,c=t.width,d=t.height;c||(c=Math.floor(u/(t.cols||1))),d||(d=Math.floor(l/(t.rows||1)));var p=Math.floor(u/c)*Math.floor(l/d);if(0===p)return e();t.total&&(p=Math.min(p,t.total));var f=0,y=0;s=p-1;for(a=0;a<p;a++)n=i+'.'+a,(h=new Tiny.Texture(r,{name:a,x:f,y,width:c,height:d,duration:t.duration})).key=i,h.lastFrame=s,S.texture[n]=h,(f+=c)+c>u&&(f=0,y+=d)}e()}))},R.image=function(t,e){const i=new Image;i.addEventListener('load',(function(){var r=new E(i);S.image[t.key]=r,e(t,r)})),i.src=t.src},c('load',R);var C=function(t){this.game=t;var e=this.domElement=t.inputView;this.bounds={x:0,y:0,width:0,height:0},this.candidates=[],this.list=[],this.lastMove=null,this.isDown=!1,this.downHandler=this.downHandler.bind(this),this.moveHandler=this.moveHandler.bind(this),this.upHandler=this.upHandler.bind(this),e.addEventListener('touchstart',this.downHandler),e.addEventListener('touchmove',this.moveHandler),e.addEventListener('touchend',this.upHandler),e.addEventListener('touchcancel',this.upHandler),e.addEventListener('mousedown',this.downHandler),e.addEventListener('mousemove',this.moveHandler),e.addEventListener('mouseup',this.upHandler),r.mixin(this);for(var i=0;i<C.systems.length;i++)C.systems[i].init.call(this);this.updateBounds()};C.prototype={add:function(t,e){t.inputEnabled=!0,(e=e||{}).system=this,t.input=e,r.mixin(t.input),this.list.push(t)},remove:function(t){var e=this.list.indexOf(t);if(e>-1){var i=this.list[e];return i.input=null,i.inputEnabled=!1,this.list.splice(e,1),i}},inputHandler:function(t,e){var i=this.getCoords(e);if(null!==i){if('move'!=t){this.candidates.length=0;for(var r=0;r<C.systems.length;r++)C.systems[r].preHandle.call(this,i.x,i.y);for(var s,n=0;n<this.list.length;n++)(s=this.list[n]).inputEnabled&&s.parent&&(s.input.checkBounds?s.input.checkBounds.call(this,s,i.x,i.y):C.checkBounds.call(this,s,i.x,i.y))&&this.candidates.push(s);for(r=this.candidates.length-1;r>=0;r--){if((s=this.candidates[r]).input['last_'+t]={x:i.x,y:i.y},s.input.emit(t,{x:i.x,y:i.y}),'up'==t){var o=s.input.last_down;o&&h.distance(o.x,o.y,i.x,i.y)<30&&s.input.emit('click',{x:i.x,y:i.y})}if(!s.input.transparent)break}}this.emit(t,{x:i.x,y:i.y})}},moveHandler:function(t){this.lastMove=t,this.inputHandler('move',t)},upHandler:function(t){this.isDown=!1,this.inputHandler('up',this.lastMove)},downHandler:function(t){this.isDown=!0,this.lastMove=t,this.inputHandler('down',t)},clickHandler:function(t){this.inputHandler('click',t)},getCoords:function(t){var e=null;return'undefined'!=typeof TouchEvent&&t instanceof TouchEvent?(A=!0,t.touches.length>0?e={x:t.touches[0].clientX,y:t.touches[0].clientY}:t.clientX&&t.clientY&&(e={x:t.clientX,y:t.clientY})):e={x:t.clientX,y:t.clientY},A&&t instanceof MouseEvent||null===e?null:e={x:e.x-this.bounds.x,y:e.y-this.bounds.y}},updateBounds:function(){var t=this.bounds,e=this.domElement.getBoundingClientRect();t.x=e.left,t.y=e.top,t.width=e.width,t.height=e.height},destroy:function(){var t=this.domElement;t.removeEventListener('touchstart',this.downHandler),t.removeEventListener('touchmove',this.moveHandler),t.removeEventListener('touchend',this.upHandler),t.removeEventListener('touchcancel',this.upHandler),t.removeEventListener('mousedown',this.downHandler),t.removeEventListener('mousemove',this.moveHandler),t.removeEventListener('mouseup',this.upHandler)}},C.checkBounds=function(t,e,i){if(t.worldVisible&&t.getBounds().contains(e,i))return!0},C.systems=[],c('input',C);var B=function(){},M=function(t,e,i,r,s,n,h,o,a){this.game=i,this.cb=r||B,this.ctx=s||this,this.delay=null==n?1e3:n,this.loop=h,this.count=o||0,this.repeat=this.count>0,this.running=!!t,this._lastFrame=0,this.autoRemove=e,this.onComplete=a||B};M.prototype={start:function(){this.running=!0},pause:function(){this.running=!1},stop:function(){this.running=!1,this._lastFrame=0},update:function(t){this.running&&(this._lastFrame+=t,this._lastFrame>=this.delay&&(this.cb.call(this.ctx),this._lastFrame=0,this.repeat?(this.count--,0===this.count&&(this.running=!1,this.autoRemove&&this.game.timer.remove(this),this.onComplete())):this.loop||(this.running=!1,this.autoRemove&&this.game.timer.remove(this))))}};var P=function(t){this.game=t,this.list=[],this.autoStart=!0,this.autoRemove=!0};P.prototype={update:function(t){for(var e=0;e<this.list.length;e++)this.list[e].update(t)},removeAll:function(){for(var t=0;t<this.list.length;t++)this.list[t].stop();this.list=[]},remove:function(t){var e=this.list.indexOf(t);e>-1&&(t.stop(),this.list.splice(e,1))},add:function(t,e,i,r,s){r=null!=r?r:this.autoStart,s=null!=s?s:this.autoRemove;var n=new M(r,s,this.game,e,i,t);return this.list.push(n),n},loop:function(t,e,i,r,s){r=null!=r?r:this.autoStart,s=null!=s?s:this.autoRemove;var n=new M(r,s,this.game,e,i,t,!0);return this.list.push(n),n},repeat:function(t,e,i,r,s,n,h){s=null!=s?s:this.autoStart,n=null!=n?n:this.autoRemove;var o=new M(s,n,this.game,i,r,t,!1,e,h);return this.list.push(o),o},destroy:function(){this.removeAll()}},c('timer',P);var L=function(){this._tweens={},this._tweensAddedDuringUpdate={}};L.prototype={getAll:function(){return Object.keys(this._tweens).map(function(t){return this._tweens[t]}.bind(this))},removeAll:function(){this._tweens={}},add:function(t){var e=t.getId();this._tweens[e]=t,this._tweensAddedDuringUpdate[e]=t},remove:function(t){var e=t.getId();delete this._tweens[e],delete this._tweensAddedDuringUpdate[e]},update:function(t,e){var i=Object.keys(this._tweens);if(0===i.length)return!1;for(;i.length>0;){this._tweensAddedDuringUpdate={};for(var r=0;r<i.length;r++){var s=this._tweens[i[r]];s&&!1===s.update(t)&&(s._isPlaying=!1,e||delete this._tweens[i[r]])}i=Object.keys(this._tweensAddedDuringUpdate)}return!0}};var F=new L;F.Group=L,F._nextId=0,F.nextId=function(){return F._nextId++};var I=function(t,e){this._isPaused=!1,this._object=t,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._repeatDelayTime=void 0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._time=0,this._easingFunction=O.Linear.None,this._interpolationFunction=D.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onRepeatCallback=null,this._onCompleteCallback=null,this._onStopCallback=null,this._group=e||F,this._id=F.nextId()};I.prototype={getId:function(){return this._id},isPlaying:function(){return this._isPlaying},isPaused:function(){return this._isPaused},to:function(t,e){return this._valuesEnd=Object.create(t),void 0!==e&&(this._duration=e),this},duration:function(t){return this._duration=t,this},start:function(t){for(var e in this._group.add(this),this._isPlaying=!0,this._isPaused=!1,this._time=0,this._onStartCallbackFired=!1,this._startTime=this._delayTime,this._valuesEnd){if(this._valuesEnd[e]instanceof Array){if(0===this._valuesEnd[e].length)continue;this._valuesEnd[e]=[this._object[e]].concat(this._valuesEnd[e])}void 0!==this._object[e]&&(1!=t&&void 0!==this._valuesStart[e]||(this._valuesStart[e]=this._object[e]),this._valuesStart[e]instanceof Array==!1&&(this._valuesStart[e]*=1),this._valuesStartRepeat[e]=this._valuesStart[e]||0)}return this},stop:function(){return this._isPlaying?(this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,null!==this._onStopCallback&&this._onStopCallback(this._object),this.stopChainedTweens(),this):this},end:function(){return this.update(1/0),this},pause:function(){return this._isPaused||!this._isPlaying||(this._isPaused=!0,this._group.remove(this)),this},resume:function(){return this._isPaused&&this._isPlaying?(this._isPaused=!1,this._group.add(this),this):this},stopChainedTweens:function(){for(var t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].stop()},group:function(t){return this._group=t,this},delay:function(t){return this._delayTime=t,this},repeat:function(t){return this._repeat=t,this},repeatDelay:function(t){return this._repeatDelayTime=t,this},yoyo:function(t){return this._yoyo=t,this},easing:function(t){return this._easingFunction=t,this},interpolation:function(t){return this._interpolationFunction=t,this},chain:function(){return this._chainedTweens=arguments,this},onStart:function(t){return this._onStartCallback=t,this},onUpdate:function(t){return this._onUpdateCallback=t,this},onRepeat:function(t){return this._onRepeatCallback=t,this},onComplete:function(t){return this._onCompleteCallback=t,this},onStop:function(t){return this._onStopCallback=t,this},update:function(t){var e,i,r;if(this._time+=t,this._time<this._startTime)return!0;for(e in!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),i=(this._time-this._startTime)/this._duration,i=0===this._duration||i>1?1:i,r=this._easingFunction(i),this._valuesEnd)if(void 0!==this._valuesStart[e]){var s=this._valuesStart[e]||0,n=this._valuesEnd[e];n instanceof Array?this._object[e]=this._interpolationFunction(n,r):('string'==typeof n&&(n='+'===n.charAt(0)||'-'===n.charAt(0)?s+parseFloat(n):parseFloat(n)),'number'==typeof n&&(this._object[e]=s+(n-s)*r))}if(null!==this._onUpdateCallback&&this._onUpdateCallback(this._object,i),1===i){if(this._time=0,this._repeat>0){for(e in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat){if('string'==typeof this._valuesEnd[e]&&(this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(this._valuesEnd[e])),this._yoyo){var h=this._valuesStartRepeat[e];this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=h}this._valuesStart[e]=this._valuesStartRepeat[e]}return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=this._repeatDelayTime:this._startTime=this._delayTime,null!==this._onRepeatCallback&&this._onRepeatCallback(this._object),!0}null!==this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var o=0,a=this._chainedTweens.length;o<a;o++)this._chainedTweens[o].start();return!1}return!0}};var U,O={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-O.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*O.Bounce.In(2*t):.5*O.Bounce.Out(2*t-1)+.5}}},D={Linear:function(t,e){var i=t.length-1,r=i*e,s=Math.floor(r),n=D.Utils.Linear;return e<0?n(t[0],t[1],r):e>1?n(t[i],t[i-1],i-r):n(t[s],t[s+1>i?i:s+1],r-s)},Bezier:function(t,e){for(var i=0,r=t.length-1,s=Math.pow,n=D.Utils.Bernstein,h=0;h<=r;h++)i+=s(1-e,r-h)*s(e,h)*t[h]*n(r,h);return i},CatmullRom:function(t,e){var i=t.length-1,r=i*e,s=Math.floor(r),n=D.Utils.CatmullRom;return t[0]===t[i]?(e<0&&(s=Math.floor(r=i*(1+e))),n(t[(s-1+i)%i],t[s],t[(s+1)%i],t[(s+2)%i],r-s)):e<0?t[0]-(n(t[0],t[0],t[1],t[1],-r)-t[0]):e>1?t[i]-(n(t[i],t[i],t[i-1],t[i-1],r-i)-t[i]):n(t[s?s-1:0],t[s],t[i<s+1?i:s+1],t[i<s+2?i:s+2],r-s)},Utils:{Linear:function(t,e,i){return(e-t)*i+t},Bernstein:function(t,e){var i=D.Utils.Factorial;return i(t)/i(e)/i(t-e)},Factorial:(U=[1],function(t){var e=1;if(U[t])return U[t];for(var i=t;i>1;i--)e*=i;return U[t]=e,e}),CatmullRom:function(t,e,i,r,s){var n=.5*(i-t),h=.5*(r-e),o=s*s;return(2*e-2*i+n+h)*(s*o)+(-3*e+3*i-2*n-h)*o+n*s+e}}},N=function(t){this.game=t,this.bufferList=[],this.group=new L};N.prototype={remove:function(t){this.group.remove(t)},add:function(t){return new I(t,this.group)},pause:function(){for(var t in this.bufferList.length=0,this.group._tweens)this.bufferList.push(this.group._tweens[t]),this.group._tweens[t].pause()},resume(){for(var t=0;t<this.bufferList.length;t++)this.bufferList[t].resume();this.bufferList.length=0},update:function(t){this.group.update(t)},destroy:function(){this.bufferList.length=0,this.group.removeAll(),this.group=null}},c('tweens',N),Tiny.App=m,Tiny.RAF=x,Tiny.registerSystem=c,Tiny.systems=l,Tiny.TweenManager=N,Tiny.Cache=S,Tiny.Loader=R,Tiny.Easing=O,Tiny.Interpolation=D,Tiny.Input=C,Tiny.Timer=M;var k=function(t,e){this.x=t||0,this.y=e||0};k.prototype={set:function(t,e){return this.x=t||0,this.y=e||(0!==e?this.x:0),this}};var j=function(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0};j.prototype.fromArray=function(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]},j.prototype.toArray=function(t){this.array||(this.array=new Float32Array(9));var e=this.array;return t?(e[0]=this.a,e[1]=this.b,e[2]=0,e[3]=this.c,e[4]=this.d,e[5]=0,e[6]=this.tx,e[7]=this.ty,e[8]=1):(e[0]=this.a,e[1]=this.c,e[2]=this.tx,e[3]=this.b,e[4]=this.d,e[5]=this.ty,e[6]=0,e[7]=0,e[8]=1),e},j.prototype.apply=function(t,e){e=e||new k;var i=t.x,r=t.y;return e.x=this.a*i+this.c*r+this.tx,e.y=this.b*i+this.d*r+this.ty,e},j.prototype.applyInverse=function(t,e){e=e||new k;var i=1/(this.a*this.d+this.c*-this.b),r=t.x,s=t.y;return e.x=this.d*i*r+-this.c*i*s+(this.ty*this.c-this.tx*this.d)*i,e.y=this.a*i*s+-this.b*i*r+(-this.ty*this.a+this.tx*this.b)*i,e},j.prototype.translate=function(t,e){return this.tx+=t,this.ty+=e,this},j.prototype.scale=function(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this},j.prototype.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),r=this.a,s=this.c,n=this.tx;return this.a=r*e-this.b*i,this.b=r*i+this.b*e,this.c=s*e-this.d*i,this.d=s*i+this.d*e,this.tx=n*e-this.ty*i,this.ty=n*i+this.ty*e,this},j.prototype.append=function(t){var e=this.a,i=this.b,r=this.c,s=this.d;return this.a=t.a*e+t.b*r,this.b=t.a*i+t.b*s,this.c=t.c*e+t.d*r,this.d=t.c*i+t.d*s,this.tx=t.tx*e+t.ty*r+this.tx,this.ty=t.tx*i+t.ty*s+this.ty,this},j.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this};var G=new j,Y=function(t,e,i,r){t=t||0,e=e||0,i=i||0,r=r||0,this.x=t,this.y=e,this.width=i,this.height=r,this.type=u.RECT};Y.prototype={setTo:function(t,e,i,r){return this.x=t,this.y=e,this.width=i,this.height=r,this},contains:function(t,e){return Y.contains(this,t,e)},intersects:function(t){return Y.intersects(this,t)}},Object.defineProperty(Y.prototype,'bottom',{get:function(){return this.y+this.height},set:function(t){t<=this.y?this.height=0:this.height=t-this.y}}),Object.defineProperty(Y.prototype,'right',{get:function(){return this.x+this.width},set:function(t){t<=this.x?this.width=0:this.width=t-this.x}}),Object.defineProperty(Y.prototype,'volume',{get:function(){return this.width*this.height}}),Y.prototype.constructor=Y,Y.contains=function(t,e,i){return!(t.width<=0||t.height<=0)&&(e>=t.x&&e<t.right&&i>=t.y&&i<t.bottom)},Y.containsPoint=function(t,e){return Y.contains(t,e.x,e.y)},Y.containsRect=function(t,e){return!(t.volume>e.volume)&&(t.x>=e.x&&t.y>=e.y&&t.right<e.right&&t.bottom<e.bottom)},Y.intersects=function(t,e){return!(t.width<=0||t.height<=0||e.width<=0||e.height<=0)&&!(t.right<e.x||t.bottom<e.y||t.x>e.right||t.y>e.bottom)};var V=new Y(0,0,0,0),H=2*Math.PI,W=function(){this.position=new k(0,0),this.scale=new k(1,1),this.pivot=new k(0,0),this.rotation=0,this.alpha=1,this.visible=!0,this.renderable=!1,this.parent=null,this.worldAlpha=1,this.worldTransform=new j,this._sr=0,this._cr=1,this._cacheAsBitmap=!1};W.prototype.constructor=W,W.prototype.destroy=function(){this.parent&&this.parent.remove(this),this.parent=null,this.worldTransform=null,this.visible=!1,this.renderable=!1,this._destroyCachedSprite()},Object.defineProperty(W.prototype,'worldVisible',{get:function(){var t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}}),Object.defineProperty(W.prototype,'cacheAsBitmap',{get:function(){return this._cacheAsBitmap},set:function(t){this._cacheAsBitmap!==t&&(t?this._generateCachedSprite():this._destroyCachedSprite(),this._cacheAsBitmap=t)}}),W.prototype.updateTransform=function(){if(this.parent){var t,e,i,r,s,n,h=this.parent.worldTransform,o=this.worldTransform;this.rotation%H?(this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),t=this._cr*this.scale.x,e=this._sr*this.scale.x,i=-this._sr*this.scale.y,r=this._cr*this.scale.y,s=this.position.x,n=this.position.y,(this.pivot.x||this.pivot.y)&&(s-=this.pivot.x*t+this.pivot.y*i,n-=this.pivot.x*e+this.pivot.y*r),o.a=t*h.a+e*h.c,o.b=t*h.b+e*h.d,o.c=i*h.a+r*h.c,o.d=i*h.b+r*h.d,o.tx=s*h.a+n*h.c+h.tx,o.ty=s*h.b+n*h.d+h.ty):(t=this.scale.x,r=this.scale.y,s=this.position.x-this.pivot.x*t,n=this.position.y-this.pivot.y*r,o.a=t*h.a,o.b=t*h.b,o.c=r*h.c,o.d=r*h.d,o.tx=s*h.a+n*h.c+h.tx,o.ty=s*h.b+n*h.d+h.ty),this.worldAlpha=this.alpha*this.parent.worldAlpha}},W.prototype.displayObjectUpdateTransform=W.prototype.updateTransform,W.prototype.getBounds=function(t){return V},W.prototype.getLocalBounds=function(){return this.getBounds(G)},W.prototype.generateTexture=function(t,e){var i=this.getLocalBounds(),r=new Tiny.RenderTexture(0|i.width,0|i.height,e,t);return W._tempMatrix.tx=-i.x,W._tempMatrix.ty=-i.y,r.render(this,W._tempMatrix),r},W.prototype.updateCache=function(){this._generateCachedSprite()},W.prototype.toGlobal=function(t){return this.displayObjectUpdateTransform(),this.worldTransform.apply(t)},W.prototype.toLocal=function(t,e){return e&&(t=e.toGlobal(t)),this.displayObjectUpdateTransform(),this.worldTransform.applyInverse(t)},W.prototype._renderCachedSprite=function(t){this._cachedSprite.worldAlpha=this.worldAlpha,Tiny.Sprite.prototype.render.call(this._cachedSprite,t)},W.prototype._generateCachedSprite=function(){this._cachedSprite=null,this._cacheAsBitmap=!1;var t=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.texture.resize(0|t.width,0|t.height);else{var e=new Tiny.RenderTexture(0|t.width,0|t.height);this._cachedSprite=new Tiny.Sprite(e),this._cachedSprite.worldTransform=this.worldTransform}W._tempMatrix.tx=-t.x,W._tempMatrix.ty=-t.y,this._cachedSprite.texture.render(this,W._tempMatrix,!0),this._cachedSprite.anchor.x=-t.x/t.width,this._cachedSprite.anchor.y=-t.y/t.height,this._cacheAsBitmap=!0},W.prototype._destroyCachedSprite=function(){this._cachedSprite&&(this._cachedSprite.texture.destroy(!0),this._cachedSprite=null)},W.prototype.render=function(t){},Object.defineProperty(W.prototype,'x',{get:function(){return this.position.x},set:function(t){this.position.x=t}}),Object.defineProperty(W.prototype,'y',{get:function(){return this.position.y},set:function(t){this.position.y=t}}),W._tempMatrix=new j;var X=function(){W.call(this),this.children=[],this._bounds=new Y(0,0,1,1),this._currentBounds=null,this._mask=null};(X.prototype=Object.create(W.prototype)).constructor=X,Object.defineProperty(X.prototype,'width',{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(t){var e=this.getLocalBounds().width;this.scale.x=0!==e?t/e:1,this._width=t}}),Object.defineProperty(X.prototype,'height',{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(t){var e=this.getLocalBounds().height;this.scale.y=0!==e?t/e:1,this._height=t}}),Object.defineProperty(X.prototype,'mask',{get:function(){return this._mask},set:function(t){this._mask&&(this._mask.isMask=!1),this._mask=t,this._mask&&(this._mask.isMask=!0)}}),X.prototype.destroy=function(){for(var t=this.children.length;t--;)this.children[t].destroy();this.children=[],W.prototype.destroy.call(this),this._bounds=null,this._currentBounds=null,this._mask=null,this.input&&this.input.system.remove(this)},X.prototype.add=function(t){return this.addChildAt(t,this.children.length)},X.prototype.addChildAt=function(t,e){if(e>=0&&e<=this.children.length)return t.parent&&t.parent.remove(t),t.parent=this,this.game&&(t.game=this.game),this.children.splice(e,0,t),t;throw new Error(t+'addChildAt: The index '+e+' supplied is out of bounds '+this.children.length)},X.prototype.swapChildren=function(t,e){if(t!==e){var i=this.getChildIndex(t),r=this.getChildIndex(e);if(i<0||r<0)throw new Error('swapChildren: Both the supplied Objects must be a child of the caller.');this.children[i]=e,this.children[r]=t}},X.prototype.getChildIndex=function(t){var e=this.children.indexOf(t);if(-1===e)throw new Error('The supplied Object must be a child of the caller');return e},X.prototype.setChildIndex=function(t,e){if(e<0||e>=this.children.length)throw new Error('The supplied index is out of bounds');var i=this.getChildIndex(t);this.children.splice(i,1),this.children.splice(e,0,t)},X.prototype.getChildAt=function(t){if(t<0||t>=this.children.length)throw new Error('getChildAt: Supplied index '+t+' does not exist in the child list, or the supplied Object must be a child of the caller');return this.children[t]},X.prototype.remove=function(t){var e=this.children.indexOf(t);if(-1!==e)return this.removeChildAt(e)},X.prototype.removeChildAt=function(t){var e=this.getChildAt(t);return e.parent=void 0,this.children.splice(t,1),e},X.prototype.updateTransform=function(){if(this.visible&&(this.displayObjectUpdateTransform(),!this._cacheAsBitmap))for(var t=0,e=this.children.length;t<e;t++)this.children[t].updateTransform()},X.prototype.displayObjectContainerUpdateTransform=X.prototype.updateTransform,X.prototype.getBounds=function(){if(0===this.children.length)return V;if(this._cachedSprite)return this._cachedSprite.getBounds();for(var t,e,i,r=1/0,s=1/0,n=-1/0,h=-1/0,o=!1,a=0,u=this.children.length;a<u;a++){this.children[a].visible&&(o=!0,r=r<(t=this.children[a].getBounds()).x?r:t.x,s=s<t.y?s:t.y,n=n>(e=t.width+t.x)?n:e,h=h>(i=t.height+t.y)?h:i)}if(!o)return V;var l=this._bounds;return l.x=r,l.y=s,l.width=n-r,l.height=h-s,l},X.prototype.getLocalBounds=function(){var t=this.worldTransform;this.worldTransform=G;for(var e=0,i=this.children.length;e<i;e++)this.children[e].updateTransform();var r=this.getBounds();return this.worldTransform=t,r},X.prototype.render=function(t){var e,i;if(this.visible&&!(this.alpha<=0))if(this._cacheAsBitmap)this._renderCachedSprite(t);else if(this._mask||this._filters){for(this._filters&&(t.spriteBatch.flush(),t.filterManager.pushFilter(this._filterBlock)),this._mask&&(t.spriteBatch.stop(),t.maskManager.pushMask(this.mask,t),t.spriteBatch.start()),e=0,i=this.children.length;e<i;e++)this.children[e].render(t);t.spriteBatch.stop(),this._mask&&t.maskManager.popMask(this._mask,t),this._filters&&t.filterManager.popFilter(),t.spriteBatch.start()}else for(e=0,i=this.children.length;e<i;e++)this.children[e].render(t)};var z=function(t){X.call(this),this.worldTransform=new j,this.game=t};(z.prototype=Object.create(X.prototype)).constructor=z,z.prototype.updateTransform=function(){this.worldAlpha=1;for(var t=0,e=this.children.length;t<e;t++)this.children[t].updateTransform()};var K=function(){this.x0=0,this.y0=0,this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.x3=0,this.y3=0};Tiny.TextureCacheIdGenerator=0;var q=function(t,e,i,r){if(this.noFrame=!1,e||(this.noFrame=!0,e=new Y(0,0,1,1)),'string'==typeof t){var s=t;if(!(t=S.image[s]))throw new Error('Cache Error: image '+s+' does`t found in cache');S.texture[s]=this,this.key=s}else t instanceof q?t=t.base:t instanceof E||(t=new E(t));this.base=t,this.frame=e,this.trim=r,this.valid=!1,this._uvs=null,this.width=0,this.height=0,this.crop=i||new Y(0,0,1,1),t.loaded?this.onBaseLoaded():t.onload=this.onBaseLoaded.bind(this)};q.prototype.constructor=q,q.prototype.onBaseLoaded=function(){var t=this.base;this.noFrame&&(this.frame=new Y(0,0,t.width,t.height)),this.setFrame(this.frame)},q.prototype.addToCache=function(t,e){this.key=this.key||t,this.frame.name=this.frame.name||e,this.frame.name&&(t+='.'+this.frame.name),S.texture[t]=this},q.prototype.destroy=function(t){t&&this.base.destroy(),this.key&&delete S.texture[this.key],this.valid=!1},q.prototype.setFrame=function(t){this.noFrame=!1,this.frame=t,this.valid=t&&t.width&&t.height&&this.base.source&&this.base.loaded,this.valid&&(this.width=t.width,this.height=t.height,this.crop.x=t.x,this.crop.y=t.y,this.crop.width=t.width,this.crop.height=t.height,this.trim||!(t.x+t.width>this.base.width||t.y+t.height>this.base.height)?(this.trim&&(this.width=this.trim.width,this.height=this.trim.height,this.frame.width=this.trim.width,this.frame.height=this.trim.height),this._updateUvs()):this.valid=!1)},q.prototype._updateUvs=function(){this._uvs||(this._uvs=new K);var t=this.crop,e=this.base.width,i=this.base.height;this._uvs.x0=t.x/e,this._uvs.y0=t.y/i,this._uvs.x1=(t.x+t.width)/e,this._uvs.y1=t.y/i,this._uvs.x2=(t.x+t.width)/e,this._uvs.y2=(t.y+t.height)/i,this._uvs.x3=t.x/e,this._uvs.y3=(t.y+t.height)/i};var Q=function(t,e){X.call(this),this.anchor=new k,this.setTexture(t,e,!1),this._width=0,this._height=0,this.tint='#ffffff',this.blendMode=o.NORMAL,this.texture.loaded&&this.onTextureUpdate(),this.renderable=!0};(Q.prototype=Object.create(X.prototype)).constructor=Q,Object.defineProperty(Q.prototype,'frameName',{get:function(){return this.texture.frame.name},set:function(t){this.texture.frame.name&&this.setTexture(S.texture[this.texture.key+'.'+t])}}),Object.defineProperty(Q.prototype,'width',{get:function(){return this.scale.x*this.texture.frame.width},set:function(t){this.scale.x=t/this.texture.frame.width,this._width=t}}),Object.defineProperty(Q.prototype,'height',{get:function(){return this.scale.y*this.texture.frame.height},set:function(t){this.scale.y=t/this.texture.frame.height,this._height=t}}),Q.prototype.setTexture=function(t,e,i){if('string'==typeof t){var r=t;null!=e&&(r=r+'.'+e),(t=S.texture[r])||(t=new q(r))}return this.texture!==t&&(this.texture=t,this.cachedTint='#ffffff',!0===i&&this.onTextureUpdate(),!0)},Q.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width),this._height&&(this.scale.y=this._height/this.texture.frame.height)},Q.prototype.getBounds=function(t){var e=this.texture.frame.width/this.texture.resolution,i=this.texture.frame.height/this.texture.resolution,r=e*(1-this.anchor.x),s=e*-this.anchor.x,n=i*(1-this.anchor.y),h=i*-this.anchor.y,o=t||this.worldTransform,a=o.a,u=o.b,l=o.c,c=o.d,d=o.tx,p=o.ty,f=-1/0,y=-1/0,g=1/0,v=1/0;if(0===u&&0===l)a<0?(g=a*r+d,f=a*s+d):(g=a*s+d,f=a*r+d),c<0?(v=c*n+p,y=c*h+p):(v=c*h+p,y=c*n+p);else{var m=a*s+l*h+d,_=c*h+u*s+p,x=a*r+l*h+d,w=c*h+u*r+p,b=a*r+l*n+d,T=c*n+u*r+p,E=a*s+l*n+d,A=c*n+u*s+p;g=E<(g=b<(g=x<(g=m<g?m:g)?x:g)?b:g)?E:g,v=A<(v=T<(v=w<(v=_<v?_:v)?w:v)?T:v)?A:v,f=E>(f=b>(f=x>(f=m>f?m:f)?x:f)?b:f)?E:f,y=A>(y=T>(y=w>(y=_>y?_:y)?w:y)?T:y)?A:y}var S=this._bounds;return S.x=g,S.width=f-g,S.y=v,S.height=y-v,this._currentBounds=S,S},Q.prototype.render=function(t){var e,i;if(this.visible&&!(this.alpha<=0))if(this._mask||this._filters){var r=t.spriteBatch;for(this._filters&&(r.flush(),t.filterManager.pushFilter(this._filterBlock)),this._mask&&(r.stop(),t.maskManager.pushMask(this.mask,t),r.start()),r.render(this),e=0,i=this.children.length;e<i;e++)this.children[e].render(t);r.stop(),this._mask&&t.maskManager.popMask(this._mask,t),this._filters&&t.filterManager.popFilter(),r.start()}else for(t.spriteBatch.render(this),e=0,i=this.children.length;e<i;e++)this.children[e].render(t)};var J=function(t,e){this.canvas=document.createElement('canvas'),this.context=this.canvas.getContext('2d'),this.resolution=1,Q.call(this,new q(this.canvas)),this.setText(t),this.setStyle(e)};(J.prototype=Object.create(Q.prototype)).constructor=J,Object.defineProperty(J.prototype,'width',{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.x*this.texture.frame.width},set:function(t){this.scale.x=t/this.texture.frame.width,this._width=t}}),Object.defineProperty(J.prototype,'height',{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.y*this.texture.frame.height},set:function(t){this.scale.y=t/this.texture.frame.height,this._height=t}}),J.prototype.setStyle=function(t){(t=t||{}).font=t.font||'bold 20pt Arial',t.fill=t.fill||'black',t.align=t.align||'left',t.stroke=t.stroke||'black',t.strokeThickness=t.strokeThickness||0,t.wordWrap=t.wordWrap||!1,t.lineSpacing=t.lineSpacing||0,t.wordWrapWidth=void 0!==t.wordWrapWidth?t.wordWrapWidth:100,t.dropShadow=t.dropShadow||!1,t.dropShadowAngle=void 0!==t.dropShadowAngle?t.dropShadowAngle:Math.PI/6,t.dropShadowDistance=void 0!==t.dropShadowDistance?t.dropShadowDistance:4,t.dropShadowColor=t.dropShadowColor||'black',this.style=t,this.dirty=!0},J.prototype.setText=function(t){this.text=t.toString()||' ',this.dirty=!0},J.prototype.updateText=function(){this.texture.resolution=this.resolution,this.context.font=this.style.font;var t=this.text;this.style.wordWrap&&(t=this.wordWrap(this.text));for(var e=t.split(/(?:\r\n|\r|\n)/),i=[],r=0,s=this.determineFontProperties(this.style.font),n=0;n<e.length;n++){var h=this.context.measureText(e[n]).width;i[n]=h,r=Math.max(r,h)}var o=r+this.style.strokeThickness;this.style.dropShadow&&(o+=this.style.dropShadowDistance),this.canvas.width=(o+this.context.lineWidth)*this.resolution;var a,u,l=s.fontSize+this.style.strokeThickness+this.style.lineSpacing,c=l*e.length;if(this.style.dropShadow&&(c+=this.style.dropShadowDistance),this.canvas.height=(c-this.style.lineSpacing)*this.resolution,this.context.scale(this.resolution,this.resolution),navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.lineWidth=this.style.strokeThickness,this.context.textBaseline='alphabetic',this.context.miterLimit=2,this.style.dropShadow){this.context.fillStyle=this.style.dropShadowColor;var d=Math.sin(this.style.dropShadowAngle)*this.style.dropShadowDistance,p=Math.cos(this.style.dropShadowAngle)*this.style.dropShadowDistance;for(n=0;n<e.length;n++)a=this.style.strokeThickness/2,u=this.style.strokeThickness/2+n*l+s.ascent,'right'===this.style.align?a+=r-i[n]:'center'===this.style.align&&(a+=(r-i[n])/2),this.style.fill&&this.context.fillText(e[n],a+d,u+p)}for(this.context.fillStyle=this.style.fill,n=0;n<e.length;n++)a=this.style.strokeThickness/2,u=this.style.strokeThickness/2+n*l+s.ascent,'right'===this.style.align?a+=r-i[n]:'center'===this.style.align&&(a+=(r-i[n])/2),this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(e[n],a,u),this.style.fill&&this.context.fillText(e[n],a,u);this.updateTexture()},J.prototype.updateTexture=function(){this.texture.width=this.canvas.width,this.texture.height=this.canvas.height,this.texture.crop.width=this.texture.frame.width=this.canvas.width,this.texture.crop.height=this.texture.frame.height=this.canvas.height,this._width=this.canvas.width,this._height=this.canvas.height},J.prototype.render=function(t){(this.dirty||this.resolution!==t.resolution)&&(this.resolution=t.resolution,this.updateText(),this.dirty=!1),Q.prototype.render.call(this,t)},J.prototype.determineFontProperties=function(t){var e=J.fontPropertiesCache[t];if(!e){e={};var i=J.fontPropertiesCanvas,r=J.fontPropertiesContext;r.font=t;var s=Math.ceil(r.measureText('|MÉq').width),n=Math.ceil(r.measureText('|MÉq').width),h=2*n;n=1.4*n|0,i.width=s,i.height=h,r.fillStyle='#f00',r.fillRect(0,0,s,h),r.font=t,r.textBaseline='alphabetic',r.fillStyle='#000',r.fillText('|MÉq',0,n);var o,a,u=r.getImageData(0,0,s,h).data,l=u.length,c=4*s,d=0,p=!1;for(o=0;o<n;o++){for(a=0;a<c;a+=4)if(255!==u[d+a]){p=!0;break}if(p)break;d+=c}for(e.ascent=n-o,d=l-c,p=!1,o=h;o>n;o--){for(a=0;a<c;a+=4)if(255!==u[d+a]){p=!0;break}if(p)break;d-=c}e.descent=o-n,e.descent+=6,e.fontSize=e.ascent+e.descent,J.fontPropertiesCache[t]=e}return e},J.prototype.wordWrap=function(t){for(var e='',i=t.split('\n'),r=0;r<i.length;r++){for(var s=this.style.wordWrapWidth,n=i[r].split(' '),h=0;h<n.length;h++){var o=this.context.measureText(n[h]).width,a=o+this.context.measureText(' ').width;0===h||a>s?(h>0&&(e+='\n'),e+=n[h],s=this.style.wordWrapWidth-o):(s-=a,e+=' '+n[h])}r<i.length-1&&(e+='\n')}return e},J.prototype.getBounds=function(t){return this.dirty&&(this.updateText(),this.dirty=!1),Q.prototype.getBounds.call(this,t)},J.prototype.destroy=function(){this.context=null,this.canvas=null,this.texture.destroy(),Q.prototype.destroy.call(this)},J.fontPropertiesCache={},J.fontPropertiesCanvas=document.createElement('canvas'),J.fontPropertiesContext=J.fontPropertiesCanvas.getContext('2d');var Z=function(t,e,i){t=t||0,e=e||0,i=i||0,this.x=t,this.y=e,this._diameter=i,this._radius=0,i>0&&(this._radius=.5*i),this.type=u.CIRC};(Z.prototype={getBounds:function(){return new Y(this.x-this.radius,this.y-this.radius,this.diameter,this.diameter)},setTo:function(t,e,i){return this.x=t,this.y=e,this._diameter=i,this._radius=.5*i,this},copyFrom:function(t){return this.setTo(t.x,t.y,t.diameter)},copyTo:function(t){return t.x=this.x,t.y=this.y,t.diameter=this._diameter,t},distance:function(t,e){var i=Tiny.Math.distance(this.x,this.y,t.x,t.y);return e?Math.round(i):i},clone:function(t){return null==t?t=new Z(this.x,this.y,this.diameter):t.setTo(this.x,this.y,this.diameter),t},contains:function(t,e){return Z.contains(this,t,e)},offset:function(t,e){return this.x+=t,this.y+=e,this},offsetPoint:function(t){return this.offset(t.x,t.y)}}).constructor=Z,Object.defineProperty(Z.prototype,'diameter',{get:function(){return this._diameter},set:function(t){t>0&&(this._diameter=t,this._radius=.5*t)}}),Object.defineProperty(Z.prototype,'radius',{get:function(){return this._radius},set:function(t){t>0&&(this._radius=t,this._diameter=2*t)}}),Object.defineProperty(Z.prototype,'left',{get:function(){return this.x-this._radius},set:function(t){t>this.x?(this._radius=0,this._diameter=0):this.radius=this.x-t}}),Object.defineProperty(Z.prototype,'right',{get:function(){return this.x+this._radius},set:function(t){t<this.x?(this._radius=0,this._diameter=0):this.radius=t-this.x}}),Object.defineProperty(Z.prototype,'top',{get:function(){return this.y-this._radius},set:function(t){t>this.y?(this._radius=0,this._diameter=0):this.radius=this.y-t}}),Object.defineProperty(Z.prototype,'bottom',{get:function(){return this.y+this._radius},set:function(t){t<this.y?(this._radius=0,this._diameter=0):this.radius=t-this.y}}),Object.defineProperty(Z.prototype,'area',{get:function(){return this._radius>0?Math.PI*this._radius*this._radius:0}}),Object.defineProperty(Z.prototype,'empty',{get:function(){return 0===this._diameter},set:function(t){!0===t&&this.setTo(0,0,0)}}),Z.contains=function(t,e,i){return t.radius>0&&e>=t.left&&e<=t.right&&i>=t.top&&i<=t.bottom&&(t.x-e)*(t.x-e)+(t.y-i)*(t.y-i)<=t.radius*t.radius},Z.equals=function(t,e){return t.x==e.x&&t.y==e.y&&t.diameter==e.diameter},Z.intersects=function(t,e){return Tiny.Math.distance(t.x,t.y,e.x,e.y)<=t.radius+e.radius},Z.intersectsRectangle=function(t,e){var i=Math.abs(t.x-e.x-e.halfWidth);if(i>e.halfWidth+t.radius)return!1;var r=Math.abs(t.y-e.y-e.halfHeight);if(r>e.halfHeight+t.radius)return!1;if(i<=e.halfWidth||r<=e.halfHeight)return!0;var s=i-e.halfWidth,n=r-e.halfHeight;return s*s+n*n<=t.radius*t.radius};var $=function(){this.area=0,this._points=[],arguments.length>0&&this.setTo.apply(this,arguments),this.closed=!0,this.type=u.POLY};$.prototype={toNumberArray:function(t){void 0===t&&(t=[]);for(var e=0;e<this._points.length;e++)'number'==typeof this._points[e]?(t.push(this._points[e]),t.push(this._points[e+1]),e++):(t.push(this._points[e].x),t.push(this._points[e].y));return t},flatten:function(){return this._points=this.toNumberArray(),this},clone:function(t){var e=this._points.slice();return null==t?t=new $(e):t.setTo(e),t},contains:function(t,e){for(var i=this._points.length,r=!1,s=-1,n=i-1;++s<i;n=s){var h=this._points[s].x,o=this._points[s].y,a=this._points[n].x,u=this._points[n].y;(o<=e&&e<u||u<=e&&e<o)&&t<(a-h)*(e-o)/(u-o)+h&&(r=!r)}return r},setTo:function(t){if(this.area=0,this._points=[],arguments.length>0){Array.isArray(t)||(t=Array.prototype.slice.call(arguments));for(var e=Number.MAX_VALUE,i=0,r=t.length;i<r;i++){if('number'==typeof t[i]){var s=new k(t[i],t[i+1]);i++}else s=new k(t[i].x,t[i].y);this._points.push(s),s.y<e&&(e=s.y)}this.calculateArea(e)}return this},calculateArea:function(t){for(var e,i,r,s,n=0,h=this._points.length;n<h;n++)e=this._points[n],i=n===h-1?this._points[0]:this._points[n+1],r=(e.y-t+(i.y-t))/2,s=e.x-i.x,this.area+=r*s;return this.area}},$.prototype.constructor=$,Object.defineProperty($.prototype,'points',{get:function(){return this._points},set:function(t){null!=t?this.setTo(t):this.setTo()}});var tt=function(t,e,i,r,s){this.x=t||0,this.y=e||0,this.width=i||0,this.height=r||0,this.radius=s||0,this.type=u.RREC};tt.prototype.clone=function(){return new tt(this.x,this.y,this.width,this.height,this.radius)},tt.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;var i=this.x;if(t>=i&&t<=i+this.width){var r=this.y;if(e>=r&&e<=r+this.height)return!0}return!1},tt.prototype.constructor=tt;var et=function(t,e,i,r,s,n,h){this.lineWidth=t,this.lineColor=e,this.lineAlpha=i,this._lineTint=e,this.fillColor=r,this.fillAlpha=s,this._fillTint=r,this.fill=n,this.shape=h,this.type=h.type};et.prototype.constructor=et,et.prototype.clone=function(){return new et(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)};var it=function(){X.call(this),this.renderable=!0,this.fillAlpha=1,this.lineWidth=0,this.lineColor='#000000',this.graphicsData=[],this.tint='#ffffff',this.blendMode=o.NORMAL,this.currentPath=null,this._webGL=[],this.isMask=!1,this.boundsPadding=0,this._localBounds=new Y(0,0,1,1),this._boundsDirty=!0,this.dirty=!0,this.webGLDirty=!1,this.cachedSpriteDirty=!1};(it.prototype=Object.create(X.prototype)).constructor=it,it.prototype.lineStyle=function(t,e,i){return this.lineWidth=t||0,this.lineColor=e||'#000000',this.lineAlpha=void 0===i?1:i,this.currentPath&&(this.currentPath.shape.points.length?this.drawShape(new $(this.currentPath.shape.points.slice(-2))):(this.currentPath.lineWidth=this.lineWidth,this.currentPath.lineColor=this.lineColor,this.currentPath.lineAlpha=this.lineAlpha)),this},it.prototype.moveTo=function(t,e){return this.drawShape(new $([t,e])),this},it.prototype.lineTo=function(t,e){return this.currentPath||this.moveTo(0,0),this.currentPath.shape.points.push(t,e),this._boundsDirty=!0,this.cachedSpriteDirty=!0,this},it.prototype.quadraticCurveTo=function(t,e,i,r){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var s,n,h=this.currentPath.shape.points;0===h.length&&this.moveTo(0,0);for(var o=h[h.length-2],a=h[h.length-1],u=0,l=1;l<=20;++l)s=o+(t-o)*(u=l/20),n=a+(e-a)*u,h.push(s+(t+(i-t)*u-s)*u,n+(e+(r-e)*u-n)*u);return this._boundsDirty=!0,this.cachedSpriteDirty=!0,this},it.prototype.bezierCurveTo=function(t,e,i,r,s,n){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);for(var h,o,a,u,l,c=this.currentPath.shape.points,d=c[c.length-2],p=c[c.length-1],f=0,y=1;y<=20;++y)a=(o=(h=1-(f=y/20))*h)*h,l=(u=f*f)*f,c.push(a*d+3*o*f*t+3*h*u*i+l*s,a*p+3*o*f*e+3*h*u*r+l*n);return this._boundsDirty=!0,this.cachedSpriteDirty=!0,this},it.prototype.arcTo=function(t,e,i,r,s){this.currentPath?0===this.currentPath.shape.points.length&&this.currentPath.shape.points.push(t,e):this.moveTo(t,e);var n=this.currentPath.shape.points,h=n[n.length-2],o=n[n.length-1]-e,a=h-t,u=r-e,l=i-t,c=Math.abs(o*l-a*u);if(c<1e-8||0===s)n[n.length-2]===t&&n[n.length-1]===e||n.push(t,e);else{var d=o*o+a*a,p=u*u+l*l,f=o*u+a*l,y=s*Math.sqrt(d)/c,g=s*Math.sqrt(p)/c,v=y*f/d,m=g*f/p,_=y*l+g*a,x=y*u+g*o,w=a*(g+v),b=o*(g+v),T=l*(y+m),E=u*(y+m),A=Math.atan2(b-x,w-_),S=Math.atan2(E-x,T-_);this.arc(_+t,x+e,s,A,S,a*u>l*o)}return this._boundsDirty=!0,this.cachedSpriteDirty=!0,this},it.prototype.arc=function(t,e,i,r,s,n){if(r===s)return this;void 0===n&&(n=!1),!n&&s<=r?s+=2*Math.PI:n&&r<=s&&(r+=2*Math.PI);var h=n?-1*(r-s):s-r,o=40*Math.ceil(Math.abs(h)/(2*Math.PI));if(0===h)return this;var a=t+Math.cos(r)*i,u=e+Math.sin(r)*i;n&&this.filling?this.moveTo(t,e):this.moveTo(a,u);for(var l=this.currentPath.shape.points,c=h/(2*o),d=2*c,p=Math.cos(c),f=Math.sin(c),y=o-1,g=y%1/y,v=0;v<=y;v++){var m=c+r+d*(v+g*v),_=Math.cos(m),x=-Math.sin(m);l.push((p*_+f*x)*i+t,(p*-x+f*_)*i+e)}return this._boundsDirty=!0,this.cachedSpriteDirty=!0,this},it.prototype.beginFill=function(t,e){return this.filling=!0,this.fillColor=t||'#000000',this.fillAlpha=void 0===e?1:e,this.currentPath&&this.currentPath.shape.points.length<=2&&(this.currentPath.fill=this.filling,this.currentPath.fillColor=this.fillColor,this.currentPath.fillAlpha=this.fillAlpha),this},it.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this},it.prototype.drawRect=function(t,e,i,r){return this.drawShape(new Y(t,e,i,r)),this},it.prototype.drawRoundedRect=function(t,e,i,r,s){return s>0?this.drawShape(new tt(t,e,i,r,s)):this.drawRect(t,e,i,r),this},it.prototype.drawCircle=function(t,e,i){return this.drawShape(new Z(t,e,i)),this},it.prototype.drawPolygon=function(t){var e=t;if(!Array.isArray(e)){e=new Array(arguments.length);for(var i=0;i<e.length;++i)e[i]=arguments[i]}return this.drawShape(new $(e)),this},it.prototype.clear=function(){return this.lineWidth=0,this.filling=!1,this._boundsDirty=!0,this.cachedSpriteDirty=!0,this.graphicsData=[],this.updateLocalBounds(),this},it.prototype.destroy=function(t){X.prototype.destroy.call(this),this.clear()},it.prototype.generateTexture=function(e){e=e||1;var i=this.getBounds(),r=new t(i.width*e,i.height*e),s=new q(r.canvas);return s.resolution=e,r.context.scale(e,e),r.context.translate(-i.x,-i.y),Tiny.CanvasGraphics.renderGraphics(this,r.context),s},it.prototype.render=function(t){if(!1!==this.visible&&0!==this.alpha&&!0!==this.isMask){if(this._cacheAsBitmap)return(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1),this._cachedSprite.worldAlpha=this.worldAlpha,void Q.prototype.render.call(this._cachedSprite,t);if(t.spriteBatch.stop(),t.blendModeManager.setBlendMode(this.blendMode),this._mask&&t.maskManager.pushMask(this._mask,t),this._filters&&t.filterManager.pushFilter(this._filterBlock),this.blendMode!==t.spriteBatch.currentBlendMode){t.spriteBatch.currentBlendMode=this.blendMode;var e=t.blendModes[t.spriteBatch.currentBlendMode];t.spriteBatch.gl.blendFunc(e[0],e[1])}if(this.webGLDirty&&(this.dirty=!0,this.webGLDirty=!1),Tiny.WebGLGraphics.renderGraphics(this,t),this.children.length){t.spriteBatch.start();for(var i=0,r=this.children.length;i<r;i++)this.children[i].render(t);t.spriteBatch.stop()}this._filters&&t.filterManager.popFilter(),this._mask&&t.maskManager.popMask(this.mask,t),t.drawCount++,t.spriteBatch.start()}},it.prototype.getBounds=function(t){if(!this._currentBounds||this._boundsDirty){if(!this.renderable)return V;this._boundsDirty&&(this.updateLocalBounds(),this.cachedSpriteDirty=!0,this._boundsDirty=!1);var e=this._localBounds,i=e.x,r=e.width+e.x,s=e.y,n=e.height+e.y,h=t||this.worldTransform,o=h.a,a=h.b,u=h.c,l=h.d,c=h.tx,d=h.ty,p=o*r+u*n+c,f=l*n+a*r+d,y=o*i+u*n+c,g=l*n+a*i+d,v=o*i+u*s+c,m=l*s+a*i+d,_=o*r+u*s+c,x=l*s+a*r+d,w=p,b=f,T=p,E=f;T=_<(T=v<(T=y<T?y:T)?v:T)?_:T,E=x<(E=m<(E=g<E?g:E)?m:E)?x:E,w=_>(w=v>(w=y>w?y:w)?v:w)?_:w,b=x>(b=m>(b=g>b?g:b)?m:b)?x:b,this._bounds.x=T,this._bounds.width=w-T,this._bounds.y=E,this._bounds.height=b-E,this._currentBounds=this._bounds}return this._currentBounds},it.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,tempPoint);for(var e=this.graphicsData,i=0;i<e.length;i++){var r=e[i];if(r.fill&&(r.shape&&r.shape.contains(tempPoint.x,tempPoint.y)))return!0}return!1},it.prototype.updateLocalBounds=function(){var t=1/0,e=-1/0,i=1/0,r=-1/0;if(this.graphicsData.length)for(var s,n,h,o,a,l,c=0;c<this.graphicsData.length;c++){var d=this.graphicsData[c],p=d.type,f=d.lineWidth;if(s=d.shape,p===u.RECT||p===u.RREC)h=s.x-f/2,o=s.y-f/2,t=h<t?h:t,e=h+(a=s.width+f)>e?h+a:e,i=o<i?o:i,r=o+(l=s.height+f)>r?o+l:r;else if(p===u.CIRC)h=s.x,o=s.y,t=h-(a=s.radius+f/2)<t?h-a:t,e=h+a>e?h+a:e,i=o-(l=s.radius+f/2)<i?o-l:i,r=o+l>r?o+l:r;else if(p===u.ELIP)h=s.x,o=s.y,t=h-(a=s.width+f/2)<t?h-a:t,e=h+a>e?h+a:e,i=o-(l=s.height+f/2)<i?o-l:i,r=o+l>r?o+l:r;else{n=s.points;for(var y=0;y<n.length;y++)n[y]instanceof k?(h=n[y].x,o=n[y].y):(h=n[y],o=n[y+1],y<n.length-1&&y++),t=h-f<t?h-f:t,e=h+f>e?h+f:e,i=o-f<i?o-f:i,r=o+f>r?o+f:r}}else t=0,e=0,i=0,r=0;var g=this.boundsPadding;this._localBounds.x=t-g,this._localBounds.width=e-t+2*g,this._localBounds.y=i-g,this._localBounds.height=r-i+2*g},it.prototype._generateCachedSprite=function(){var e=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.buffer.resize(e.width,e.height);else{var i=new t(e.width,e.height),r=new q(i.canvas);this._cachedSprite=new Q(r),this._cachedSprite.buffer=i,this._cachedSprite.worldTransform=this.worldTransform}this._cachedSprite.anchor.x=-e.x/e.width,this._cachedSprite.anchor.y=-e.y/e.height,this._cachedSprite.buffer.context.translate(-e.x,-e.y),this.worldAlpha=1,Tiny.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context),this._cachedSprite.alpha=this.alpha},it.prototype.updateCachedSpriteTexture=function(){var t=this._cachedSprite,e=t.texture,i=t.buffer.canvas;e.width=i.width,e.height=i.height,e.crop.width=e.frame.width=i.width,e.crop.height=e.frame.height=i.height,t._width=i.width,t._height=i.height},it.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(!0),this._cachedSprite=null},it.prototype.drawShape=function(t){this.currentPath&&this.currentPath.shape.points.length<=2&&this.graphicsData.pop(),this.currentPath=null,t instanceof $&&t.flatten();var e=new et(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,t);return this.graphicsData.push(e),e.type===u.POLY&&(e.shape.closed=this.filling,this.currentPath=e),this._boundsDirty=!0,this.cachedSpriteDirty=!0,e},Object.defineProperty(it.prototype,'cacheAsBitmap',{get:function(){return this._cacheAsBitmap},set:function(t){this._cacheAsBitmap=t,this._cacheAsBitmap?this._generateCachedSprite():(this.destroyCachedSprite(),this._boundsDirty=!0)}});var rt=function(e,i,r,s){this.width=e||100,this.height=i||100,s=s||1,this.textureBuffer=new t(this.width*s,this.height*s),q.call(this,this.textureBuffer.canvas,new Y(0,0,Math.floor(this.width*s),Math.floor(this.height*s))),this.resolution=s,this.renderer=r||Tiny.defaultRenderer,this.valid=!0};(rt.prototype=Object.create(q.prototype)).constructor=rt,rt.prototype.resize=function(t,e,i){t===this.width&&e===this.height||(this.valid=t>0&&e>0,this.width=t,this.height=e,this.frame.width=this.crop.width=t*this.resolution,this.frame.height=this.crop.height=e*this.resolution,this.valid&&this.textureBuffer.resize(this.width*this.resolution,this.height*this.resolution))},rt.prototype.clear=function(){this.valid&&this.textureBuffer.clear()},rt.prototype.render=function(t,e,i){if(this.valid){var r=t.worldTransform;r.identity(),e&&r.append(e),t.worldAlpha=1;for(var s=t.children,n=0,h=s.length;n<h;n++)s[n].updateTransform();i&&this.textureBuffer.clear();var o=this.textureBuffer.context,a=this.renderer.resolution;this.renderer.resolution=this.resolution,this.renderer.renderObject(t,o),this.renderer.resolution=a}},rt.prototype.getImage=function(){var t=new Image;return t.src=this.getBase64(),t},rt.prototype.getBase64=function(){return this.getCanvas().toDataURL()},rt.prototype.getCanvas=function(){return this.textureBuffer.canvas};var st=function(){this.stencilStack=[],this.reverse=!0,this.count=0};st.prototype.setContext=function(t){this.gl=t},st.prototype.pushStencil=function(t,e,i){var r=this.gl;this.bindGraphics(t,e,i),0===this.stencilStack.length&&(r.enable(r.STENCIL_TEST),r.clear(r.STENCIL_BUFFER_BIT),this.reverse=!0,this.count=0),this.stencilStack.push(e);var s=this.count;r.colorMask(!1,!1,!1,!1),r.stencilFunc(r.ALWAYS,0,255),r.stencilOp(r.KEEP,r.KEEP,r.INVERT),1===e.mode?(r.drawElements(r.TRIANGLE_FAN,e.indices.length-4,r.UNSIGNED_SHORT,0),this.reverse?(r.stencilFunc(r.EQUAL,255-s,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)):(r.stencilFunc(r.EQUAL,s,255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,2*(e.indices.length-4)),this.reverse?r.stencilFunc(r.EQUAL,255-(s+1),255):r.stencilFunc(r.EQUAL,s+1,255),this.reverse=!this.reverse):(this.reverse?(r.stencilFunc(r.EQUAL,s,255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)):(r.stencilFunc(r.EQUAL,255-s,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)),r.drawElements(r.TRIANGLE_STRIP,e.indices.length,r.UNSIGNED_SHORT,0),this.reverse?r.stencilFunc(r.EQUAL,s+1,255):r.stencilFunc(r.EQUAL,255-(s+1),255)),r.colorMask(!0,!0,!0,!0),r.stencilOp(r.KEEP,r.KEEP,r.KEEP),this.count++},st.prototype.bindGraphics=function(t,e,i){this._currentGraphics=t;var r,s=this.gl,n=i.projection,h=i.offset;1===e.mode?(r=i.shaderManager.complexPrimitiveShader,i.shaderManager.setShader(r),s.uniform1f(r.flipY,i.flipY),s.uniformMatrix3fv(r.translationMatrix,!1,t.worldTransform.toArray(!0)),s.uniform2f(r.projectionVector,n.x,-n.y),s.uniform2f(r.offsetVector,-h.x,-h.y),s.uniform3fv(r.tintColor,PIXI.hex2rgb(t.tint)),s.uniform3fv(r.color,e.color),s.uniform1f(r.alpha,t.worldAlpha*e.alpha),s.bindBuffer(s.ARRAY_BUFFER,e.buffer),s.vertexAttribPointer(r.aVertexPosition,2,s.FLOAT,!1,8,0),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,e.indexBuffer)):(r=i.shaderManager.primitiveShader,i.shaderManager.setShader(r),s.uniformMatrix3fv(r.translationMatrix,!1,t.worldTransform.toArray(!0)),s.uniform1f(r.flipY,i.flipY),s.uniform2f(r.projectionVector,n.x,-n.y),s.uniform2f(r.offsetVector,-h.x,-h.y),s.uniform3fv(r.tintColor,PIXI.hex2rgb(t.tint)),s.uniform1f(r.alpha,t.worldAlpha),s.bindBuffer(s.ARRAY_BUFFER,e.buffer),s.vertexAttribPointer(r.aVertexPosition,2,s.FLOAT,!1,24,0),s.vertexAttribPointer(r.colorAttribute,4,s.FLOAT,!1,24,8),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,e.indexBuffer))},st.prototype.popStencil=function(t,e,i){var r=this.gl;if(this.stencilStack.pop(),this.count--,0===this.stencilStack.length)r.disable(r.STENCIL_TEST);else{var s=this.count;this.bindGraphics(t,e,i),r.colorMask(!1,!1,!1,!1),1===e.mode?(this.reverse=!this.reverse,this.reverse?(r.stencilFunc(r.EQUAL,255-(s+1),255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)):(r.stencilFunc(r.EQUAL,s+1,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,2*(e.indices.length-4)),r.stencilFunc(r.ALWAYS,0,255),r.stencilOp(r.KEEP,r.KEEP,r.INVERT),r.drawElements(r.TRIANGLE_FAN,e.indices.length-4,r.UNSIGNED_SHORT,0),this.reverse?r.stencilFunc(r.EQUAL,s,255):r.stencilFunc(r.EQUAL,255-s,255)):(this.reverse?(r.stencilFunc(r.EQUAL,s+1,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)):(r.stencilFunc(r.EQUAL,255-(s+1),255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)),r.drawElements(r.TRIANGLE_STRIP,e.indices.length,r.UNSIGNED_SHORT,0),this.reverse?r.stencilFunc(r.EQUAL,s,255):r.stencilFunc(r.EQUAL,255-s,255)),r.colorMask(!0,!0,!0,!0),r.stencilOp(r.KEEP,r.KEEP,r.KEEP)}},st.prototype.destroy=function(){this.stencilStack=null,this.gl=null};var nt=function(t,e){this.passes=[this],this.shaders=[],this.dirty=!0,this.padding=0,this.uniforms=e||{},this.fragmentSrc=t||[]};nt.prototype.constructor=nt,nt.prototype.syncUniforms=function(){for(var t=0,e=this.shaders.length;t<e;t++)this.shaders[t].dirty=!0};var ht=function(t,e,i){var r=e.join('\n'),s=t.createShader(i);return t.shaderSource(s,r),t.compileShader(s),t.getShaderParameter(s,t.COMPILE_STATUS)?s:(window.console.log(t.getShaderInfoLog(s)),null)},ot=function(t,e,i){var r=function(t,e){return ht(t,e,t.FRAGMENT_SHADER)}(t,i),s=function(t,e){return ht(t,e,t.VERTEX_SHADER)}(t,e),n=t.createProgram();return t.attachShader(n,s),t.attachShader(n,r),t.linkProgram(n),t.getProgramParameter(n,t.LINK_STATUS)||window.console.log('Could not initialise shaders'),n},at=function(t){this._UID=b(),this.gl=t,this.program=null,this.fragmentSrc=['precision lowp float;','varying vec2 vTextureCoord;','varying vec4 vColor;','uniform sampler2D uSampler;','void main(void) {','   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;','}'],this.textureCount=0,this.firstRun=!0,this.dirty=!0,this.attributes=[],this.init()};at.prototype.constructor=at,at.prototype.init=function(){var t=this.gl,e=ot(t,this.vertexSrc||at.defaultVertexSrc,this.fragmentSrc);for(var i in t.useProgram(e),this.uSampler=t.getUniformLocation(e,'uSampler'),this.projectionVector=t.getUniformLocation(e,'projectionVector'),this.offsetVector=t.getUniformLocation(e,'offsetVector'),this.dimensions=t.getUniformLocation(e,'dimensions'),this.aVertexPosition=t.getAttribLocation(e,'aVertexPosition'),this.aTextureCoord=t.getAttribLocation(e,'aTextureCoord'),this.colorAttribute=t.getAttribLocation(e,'aColor'),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute],this.uniforms)this.uniforms[i].uniformLocation=t.getUniformLocation(e,i);this.initUniforms(),this.program=e},at.prototype.initUniforms=function(){this.textureCount=1;var t,e=this.gl;for(var i in this.uniforms){var r=(t=this.uniforms[i]).type;'sampler2D'===r?(t._init=!1,null!==t.value&&this.initSampler2D(t)):'mat2'===r||'mat3'===r||'mat4'===r?(t.glMatrix=!0,t.glValueLength=1,'mat2'===r?t.glFunc=e.uniformMatrix2fv:'mat3'===r?t.glFunc=e.uniformMatrix3fv:'mat4'===r&&(t.glFunc=e.uniformMatrix4fv)):(t.glFunc=e['uniform'+r],t.glValueLength='2f'===r||'2i'===r?2:'3f'===r||'3i'===r?3:'4f'===r||'4i'===r?4:1)}},at.prototype.initSampler2D=function(t){if(t.value&&t.value.base&&t.value.base.loaded){var e=this.gl;if(e.activeTexture(e['TEXTURE'+this.textureCount]),e.bindTexture(e.TEXTURE_2D,t.value.base._glTextures[e.id]),t.textureData){var i=t.textureData,r=i.magFilter?i.magFilter:e.LINEAR,s=i.minFilter?i.minFilter:e.LINEAR,n=i.wrapS?i.wrapS:e.CLAMP_TO_EDGE,h=i.wrapT?i.wrapT:e.CLAMP_TO_EDGE,o=i.luminance?e.LUMINANCE:e.RGBA;if(i.repeat&&(n=e.REPEAT,h=e.REPEAT),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!!i.flipY),i.width){var a=i.width?i.width:512,u=i.height?i.height:2,l=i.border?i.border:0;e.texImage2D(e.TEXTURE_2D,0,o,a,u,l,o,e.UNSIGNED_BYTE,null)}else e.texImage2D(e.TEXTURE_2D,0,o,e.RGBA,e.UNSIGNED_BYTE,t.value.base.source);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,h)}e.uniform1i(t.uniformLocation,this.textureCount),t._init=!0,this.textureCount++}},at.prototype.syncUniforms=function(){var t;this.textureCount=1;var e=this.gl;for(var i in this.uniforms)1===(t=this.uniforms[i]).glValueLength?!0===t.glMatrix?t.glFunc.call(e,t.uniformLocation,t.transpose,t.value):t.glFunc.call(e,t.uniformLocation,t.value):2===t.glValueLength?t.glFunc.call(e,t.uniformLocation,t.value.x,t.value.y):3===t.glValueLength?t.glFunc.call(e,t.uniformLocation,t.value.x,t.value.y,t.value.z):4===t.glValueLength?t.glFunc.call(e,t.uniformLocation,t.value.x,t.value.y,t.value.z,t.value.w):'sampler2D'===t.type&&(t._init?(e.activeTexture(e['TEXTURE'+this.textureCount]),t.value.base._dirty[e.id]?Tiny.instances[e.id].updateTexture(t.value.base):e.bindTexture(e.TEXTURE_2D,t.value.base._glTextures[e.id]),e.uniform1i(t.uniformLocation,this.textureCount),this.textureCount++):this.initSampler2D(t))},at.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},at.defaultVertexSrc=['attribute vec2 aVertexPosition;','attribute vec2 aTextureCoord;','attribute vec4 aColor;','uniform vec2 projectionVector;','uniform vec2 offsetVector;','varying vec2 vTextureCoord;','varying vec4 vColor;','const vec2 center = vec2(-1.0, 1.0);','void main(void) {','   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);','   vTextureCoord = aTextureCoord;','   vColor = vec4(aColor.rgb * aColor.a, aColor.a);','}'];var ut=function(t){this.renderer=t,this.vertSize=5,this.size=2e3;var e=4*this.size*4*this.vertSize,i=6*this.size;this.vertices=new ArrayBuffer(e),this.positions=new Float32Array(this.vertices),this.colors=new Uint32Array(this.vertices),this.indices=new Uint16Array(i),this.lastIndexCount=0;for(var r=0,s=0;r<i;r+=6,s+=4)this.indices[r+0]=s+0,this.indices[r+1]=s+1,this.indices[r+2]=s+2,this.indices[r+3]=s+0,this.indices[r+4]=s+2,this.indices[r+5]=s+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.dirty=!0,this.textures=[],this.blendModes=[],this.shaders=[],this.sprites=[],this.defaultShader=new nt(['precision lowp float;','varying vec2 vTextureCoord;','varying vec4 vColor;','uniform sampler2D uSampler;','void main(void) {','   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;','}'])};ut.prototype.setContext=function(t){this.gl=t,this.vertexBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW),this.currentBlendMode=99999;var e=new at(t);e.fragmentSrc=this.defaultShader.fragmentSrc,e.uniforms={},e.init(),this.defaultShader.shaders[t.id]=e},ut.prototype.begin=function(t){this.shader=t.shaderManager.defaultShader,this.start()},ut.prototype.render=function(t){var e=t.texture;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=e.base);var i=e._uvs;if(i){var r,s,n,h,o=t.anchor.x,a=t.anchor.y;if(e.trim){var u=e.trim;r=(s=u.x-o*u.width)+e.crop.width,n=(h=u.y-a*u.height)+e.crop.height}else r=e.frame.width*(1-o),s=e.frame.width*-o,n=e.frame.height*(1-a),h=e.frame.height*-a;var l=4*this.currentBatchSize*this.vertSize,c=e.base.resolution,d=t.worldTransform,p=d.a/c,f=d.b/c,y=d.c/c,g=d.d/c,v=d.tx,m=d.ty,_=this.colors,x=this.positions;this.renderer.roundPixels?(x[l]=p*s+y*h+v|0,x[l+1]=g*h+f*s+m|0,x[l+5]=p*r+y*h+v|0,x[l+6]=g*h+f*r+m|0,x[l+10]=p*r+y*n+v|0,x[l+11]=g*n+f*r+m|0,x[l+15]=p*s+y*n+v|0,x[l+16]=g*n+f*s+m|0):(x[l]=p*s+y*h+v,x[l+1]=g*h+f*s+m,x[l+5]=p*r+y*h+v,x[l+6]=g*h+f*r+m,x[l+10]=p*r+y*n+v,x[l+11]=g*n+f*r+m,x[l+15]=p*s+y*n+v,x[l+16]=g*n+f*s+m),x[l+2]=i.x0,x[l+3]=i.y0,x[l+7]=i.x1,x[l+8]=i.y1,x[l+12]=i.x2,x[l+13]=i.y2,x[l+17]=i.x3,x[l+18]=i.y3;_[l+4]=_[l+9]=_[l+14]=_[l+19]=16777215+(255*t.worldAlpha<<24),this.sprites[this.currentBatchSize++]=t}},ut.prototype.renderTilingSprite=function(t){var e=t.tilingTexture;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=e.base),t._uvs||(t._uvs=new PIXI.TextureUvs);var i=t._uvs;t.tilePosition.x%=e.base.width*t.tileScaleOffset.x,t.tilePosition.y%=e.base.height*t.tileScaleOffset.y;var r=t.tilePosition.x/(e.base.width*t.tileScaleOffset.x),s=t.tilePosition.y/(e.base.height*t.tileScaleOffset.y),n=t.width/e.base.width/(t.tileScale.x*t.tileScaleOffset.x),h=t.height/e.base.height/(t.tileScale.y*t.tileScaleOffset.y);i.x0=0-r,i.y0=0-s,i.x1=1*n-r,i.y1=0-s,i.x2=1*n-r,i.y2=1*h-s,i.x3=0-r,i.y3=1*h-s;var o=t.tint,a=(o>>16)+(65280&o)+((255&o)<<16)+(255*t.alpha<<24),u=this.positions,l=this.colors,c=t.width,d=t.height,p=t.anchor.x,f=t.anchor.y,y=c*(1-p),g=c*-p,v=d*(1-f),m=d*-f,_=4*this.currentBatchSize*this.vertSize,x=e.base.resolution,w=t.worldTransform,b=w.a/x,T=w.b/x,E=w.c/x,A=w.d/x,S=w.tx,R=w.ty;u[_++]=b*g+E*m+S,u[_++]=A*m+T*g+R,u[_++]=i.x0,u[_++]=i.y0,l[_++]=a,u[_++]=b*y+E*m+S,u[_++]=A*m+T*y+R,u[_++]=i.x1,u[_++]=i.y1,l[_++]=a,u[_++]=b*y+E*v+S,u[_++]=A*v+T*y+R,u[_++]=i.x2,u[_++]=i.y2,l[_++]=a,u[_++]=b*g+E*v+S,u[_++]=A*v+T*g+R,u[_++]=i.x3,u[_++]=i.y3,l[_++]=a,this.sprites[this.currentBatchSize++]=t},ut.prototype.flush=function(){if(0!==this.currentBatchSize){var t,e,i,r,s=this.gl;if(this.dirty){this.dirty=!1,s.activeTexture(s.TEXTURE0),s.bindBuffer(s.ARRAY_BUFFER,this.vertexBuffer),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t=this.defaultShader.shaders[s.id];var n=4*this.vertSize;s.vertexAttribPointer(t.aVertexPosition,2,s.FLOAT,!1,n,0),s.vertexAttribPointer(t.aTextureCoord,2,s.FLOAT,!1,n,8),s.vertexAttribPointer(t.colorAttribute,4,s.UNSIGNED_BYTE,!0,n,16)}if(this.currentBatchSize>.5*this.size)s.bufferSubData(s.ARRAY_BUFFER,0,this.vertices);else{var h=this.positions.subarray(0,4*this.currentBatchSize*this.vertSize);s.bufferSubData(s.ARRAY_BUFFER,0,h)}for(var o,a=0,u=0,l=null,c=this.renderer.blendModeManager.currentBlendMode,d=null,p=!1,f=!1,y=0,g=this.currentBatchSize;y<g;y++){if(e=(o=this.sprites[y]).texture.base,p=c!==(i=o.blendMode),f=d!==(r=o.shader||this.defaultShader),(l!==e||p||f)&&(this.renderBatch(l,a,u),u=y,a=0,l=e,p&&(c=i,this.renderer.blendModeManager.setBlendMode(c)),f)){(t=(d=r).shaders[s.id])||((t=new at(s)).fragmentSrc=d.fragmentSrc,t.uniforms=d.uniforms,t.init(),d.shaders[s.id]=t),this.renderer.shaderManager.setShader(t),t.dirty&&t.syncUniforms();var v=this.renderer.projection;s.uniform2f(t.projectionVector,v.x,v.y);var m=this.renderer.offset;s.uniform2f(t.offsetVector,m.x,m.y)}a++}this.renderBatch(l,a,u),this.currentBatchSize=0}},ut.prototype.renderBatch=function(t,e,i){if(0!==e){var r=this.gl;t._dirty[r.id]?this.renderer.updateTexture(t):r.bindTexture(r.TEXTURE_2D,t._glTextures[r.id]),r.drawElements(r.TRIANGLES,6*e,r.UNSIGNED_SHORT,6*i*2),this.renderer.drawCount++}},ut.prototype.stop=function(){this.flush(),this.dirty=!0},ut.prototype.start=function(){this.dirty=!0},ut.prototype.destroy=function(){this.vertices=null,this.indices=null,this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteBuffer(this.indexBuffer),this.currentBaseTexture=null,this.gl=null};var lt=function(t){this._UID=b(),this.gl=t,this.program=null,this.fragmentSrc=['precision mediump float;','varying vec4 vColor;','void main(void) {','   gl_FragColor = vColor;','}'],this.vertexSrc=['attribute vec2 aVertexPosition;','attribute vec4 aColor;','uniform mat3 translationMatrix;','uniform vec2 projectionVector;','uniform vec2 offsetVector;','uniform float alpha;','uniform float flipY;','uniform vec3 tint;','varying vec4 vColor;','void main(void) {','   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);','   v -= offsetVector.xyx;','   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);','   vColor = aColor * vec4(tint * alpha, alpha);','}'],this.init()};lt.prototype.constructor=lt,lt.prototype.init=function(){var t=this.gl,e=ot(t,this.vertexSrc,this.fragmentSrc);t.useProgram(e),this.projectionVector=t.getUniformLocation(e,'projectionVector'),this.offsetVector=t.getUniformLocation(e,'offsetVector'),this.tintColor=t.getUniformLocation(e,'tint'),this.flipY=t.getUniformLocation(e,'flipY'),this.aVertexPosition=t.getAttribLocation(e,'aVertexPosition'),this.colorAttribute=t.getAttribLocation(e,'aColor'),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=t.getUniformLocation(e,'translationMatrix'),this.alpha=t.getUniformLocation(e,'alpha'),this.program=e},lt.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null};var ct=function(t){this._UID=b(),this.gl=t,this.program=null,this.fragmentSrc=['precision mediump float;','varying vec4 vColor;','void main(void) {','   gl_FragColor = vColor;','}'],this.vertexSrc=['attribute vec2 aVertexPosition;','uniform mat3 translationMatrix;','uniform vec2 projectionVector;','uniform vec2 offsetVector;','uniform vec3 tint;','uniform float alpha;','uniform vec3 color;','uniform float flipY;','varying vec4 vColor;','void main(void) {','   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);','   v -= offsetVector.xyx;','   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);','   vColor = vec4(color * alpha * tint, alpha);','}'],this.init()};ct.prototype.constructor=ct,ct.prototype.init=function(){var t=this.gl,e=ot(t,this.vertexSrc,this.fragmentSrc);t.useProgram(e),this.projectionVector=t.getUniformLocation(e,'projectionVector'),this.offsetVector=t.getUniformLocation(e,'offsetVector'),this.tintColor=t.getUniformLocation(e,'tint'),this.color=t.getUniformLocation(e,'color'),this.flipY=t.getUniformLocation(e,'flipY'),this.aVertexPosition=t.getAttribLocation(e,'aVertexPosition'),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=t.getUniformLocation(e,'translationMatrix'),this.alpha=t.getUniformLocation(e,'alpha'),this.program=e},ct.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null};var dt=function(){this.maxAttibs=10,this.attribState=[],this.tempAttribState=[];for(var t=0;t<this.maxAttibs;t++)this.attribState[t]=!1;this.stack=[]};dt.prototype.constructor=dt,dt.prototype.setContext=function(t){this.gl=t,this.primitiveShader=new lt(t),this.complexPrimitiveShader=new ct(t),this.defaultShader=new at(t),this.setShader(this.defaultShader)},dt.prototype.setAttribs=function(t){var e;for(e=0;e<this.tempAttribState.length;e++)this.tempAttribState[e]=!1;for(e=0;e<t.length;e++){var i=t[e];this.tempAttribState[i]=!0}var r=this.gl;for(e=0;e<this.attribState.length;e++)this.attribState[e]!==this.tempAttribState[e]&&(this.attribState[e]=this.tempAttribState[e],this.tempAttribState[e]?r.enableVertexAttribArray(e):r.disableVertexAttribArray(e))},dt.prototype.setShader=function(t){return this._currentId!==t._UID&&(this._currentId=t._UID,this.currentShader=t,this.gl.useProgram(t.program),this.setAttribs(t.attributes),!0)},dt.prototype.destroy=function(){this.attribState=null,this.tempAttribState=null,this.primitiveShader.destroy(),this.complexPrimitiveShader.destroy(),this.defaultShader.destroy(),this.gl=null};var pt=function(){};pt.prototype.constructor=pt,pt.prototype.setContext=function(t){this.gl=t},pt.prototype.pushMask=function(t,e){var i=e.gl;t.dirty&&PIXI.WebGLGraphics.updateGraphics(t,i),t._webGL[i.id].data.length&&e.stencilManager.pushStencil(t,t._webGL[i.id].data[0],e)},pt.prototype.popMask=function(t,e){var i=this.gl;e.stencilManager.popStencil(t,t._webGL[i.id].data[0],e)},pt.prototype.destroy=function(){this.gl=null};var ft=function(t){this.renderer=t,this.filterStack=[],this.offsetX=0,this.offsetY=0};ft.prototype.constructor=ft,ft.prototype.setContext=function(t){this.gl=t,this.texturePool=[],this.initShaderBuffers()},ft.prototype.begin=function(t,e){this.defaultShader=t.shaderManager.defaultShader;var i=t.projection;this.width=2*i.x,this.height=2*-i.y,this.buffer=e},ft.prototype.pushFilter=function(t){var e=this.gl,i=this.renderer.projection,r=this.renderer.offset;t._filterArea=t.target.filterArea||t.target.getBounds(),this.filterStack.push(t);var s=t.filterPasses[0];this.offsetX+=t._filterArea.x,this.offsetY+=t._filterArea.y;var n=this.texturePool.pop();n?n.resize(this.width,this.height):n=new PIXI.FilterTexture(this.gl,this.width,this.height),e.bindTexture(e.TEXTURE_2D,n.texture);var h=t._filterArea,o=s.padding;h.x-=o,h.y-=o,h.width+=2*o,h.height+=2*o,h.x<0&&(h.x=0),h.width>this.width&&(h.width=this.width),h.y<0&&(h.y=0),h.height>this.height&&(h.height=this.height),e.bindFramebuffer(e.FRAMEBUFFER,n.frameBuffer),e.viewport(0,0,h.width,h.height),i.x=h.width/2,i.y=-h.height/2,r.x=-h.x,r.y=-h.y,e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),t._glFilterTexture=n},ft.prototype.popFilter=function(){var t=this.gl,e=this.filterStack.pop(),i=e._filterArea,r=e._glFilterTexture,s=this.renderer.projection,n=this.renderer.offset;if(e.filterPasses.length>1){t.viewport(0,0,i.width,i.height),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=0,this.vertexArray[1]=i.height,this.vertexArray[2]=i.width,this.vertexArray[3]=i.height,this.vertexArray[4]=0,this.vertexArray[5]=0,this.vertexArray[6]=i.width,this.vertexArray[7]=0,t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=i.width/this.width,this.uvArray[5]=i.height/this.height,this.uvArray[6]=i.width/this.width,this.uvArray[7]=i.height/this.height,t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray);var h=r,o=this.texturePool.pop();o||(o=new PIXI.FilterTexture(this.gl,this.width,this.height)),o.resize(this.width,this.height),t.bindFramebuffer(t.FRAMEBUFFER,o.frameBuffer),t.clear(t.COLOR_BUFFER_BIT),t.disable(t.BLEND);for(var a=0;a<e.filterPasses.length-1;a++){var u=e.filterPasses[a];t.bindFramebuffer(t.FRAMEBUFFER,o.frameBuffer),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,h.texture),this.applyFilterPass(u,i,i.width,i.height);var l=h;h=o,o=l}t.enable(t.BLEND),r=h,this.texturePool.push(o)}var c=e.filterPasses[e.filterPasses.length-1];this.offsetX-=i.x,this.offsetY-=i.y;var d=this.width,p=this.height,f=0,y=0,g=this.buffer;if(0===this.filterStack.length)t.colorMask(!0,!0,!0,!0);else{var v=this.filterStack[this.filterStack.length-1];d=(i=v._filterArea).width,p=i.height,f=i.x,y=i.y,g=v._glFilterTexture.frameBuffer}s.x=d/2,s.y=-p/2,n.x=f,n.y=y;var m=(i=e._filterArea).x-f,_=i.y-y;t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=m,this.vertexArray[1]=_+i.height,this.vertexArray[2]=m+i.width,this.vertexArray[3]=_+i.height,this.vertexArray[4]=m,this.vertexArray[5]=_,this.vertexArray[6]=m+i.width,this.vertexArray[7]=_,t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=i.width/this.width,this.uvArray[5]=i.height/this.height,this.uvArray[6]=i.width/this.width,this.uvArray[7]=i.height/this.height,t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray),t.viewport(0,0,d*this.renderer.resolution,p*this.renderer.resolution),t.bindFramebuffer(t.FRAMEBUFFER,g),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,r.texture),this.applyFilterPass(c,i,d,p),this.texturePool.push(r),e._glFilterTexture=null},ft.prototype.applyFilterPass=function(t,e,i,r){var s=this.gl,n=t.shaders[s.id];n||((n=new PIXI.PixiShader(s)).fragmentSrc=t.fragmentSrc,n.uniforms=t.uniforms,n.init(),t.shaders[s.id]=n),this.renderer.shaderManager.setShader(n),s.uniform2f(n.projectionVector,i/2,-r/2),s.uniform2f(n.offsetVector,0,0),t.uniforms.dimensions&&(t.uniforms.dimensions.value[0]=this.width,t.uniforms.dimensions.value[1]=this.height,t.uniforms.dimensions.value[2]=this.vertexArray[0],t.uniforms.dimensions.value[3]=this.vertexArray[5]),n.syncUniforms(),s.bindBuffer(s.ARRAY_BUFFER,this.vertexBuffer),s.vertexAttribPointer(n.aVertexPosition,2,s.FLOAT,!1,0,0),s.bindBuffer(s.ARRAY_BUFFER,this.uvBuffer),s.vertexAttribPointer(n.aTextureCoord,2,s.FLOAT,!1,0,0),s.bindBuffer(s.ARRAY_BUFFER,this.colorBuffer),s.vertexAttribPointer(n.colorAttribute,2,s.FLOAT,!1,0,0),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,this.indexBuffer),s.drawElements(s.TRIANGLES,6,s.UNSIGNED_SHORT,0),this.renderer.drawCount++},ft.prototype.initShaderBuffers=function(){var t=this.gl;this.vertexBuffer=t.createBuffer(),this.uvBuffer=t.createBuffer(),this.colorBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),this.vertexArray=new Float32Array([0,0,1,0,0,1,1,1]),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertexArray,t.STATIC_DRAW),this.uvArray=new Float32Array([0,0,1,0,0,1,1,1]),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),t.bufferData(t.ARRAY_BUFFER,this.uvArray,t.STATIC_DRAW),this.colorArray=new Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]),t.bindBuffer(t.ARRAY_BUFFER,this.colorBuffer),t.bufferData(t.ARRAY_BUFFER,this.colorArray,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),t.STATIC_DRAW)},ft.prototype.destroy=function(){var t=this.gl;this.filterStack=null,this.offsetX=0,this.offsetY=0;for(var e=0;e<this.texturePool.length;e++)this.texturePool[e].destroy();this.texturePool=null,t.deleteBuffer(this.vertexBuffer),t.deleteBuffer(this.uvBuffer),t.deleteBuffer(this.colorBuffer),t.deleteBuffer(this.indexBuffer)};var yt=function(t){this.currentBlendMode=99999,this.renderer=t};yt.prototype.constructor=yt,yt.prototype.setContext=function(t){this.gl=t},yt.prototype.setBlendMode=function(t){if(this.currentBlendMode===t)return!1;this.currentBlendMode=t;var e=this.renderer.blendModes[this.currentBlendMode];return this.gl.blendFunc(e[0],e[1]),!0},yt.prototype.destroy=function(){this.gl=null},Tiny.glContexts=[],Tiny.instances=[];var gt=function(t,e,i){i=Object.assign({},{view:null,transparent:!1,antialias:!1,preserveDrawingBuffer:!1,resolution:1,clearBeforeRender:!0,autoResize:!1},i),Tiny.defaultRenderer||(Tiny.defaultRenderer=this),this.resolution=i.resolution,this.transparent=i.transparent,this.autoResize=i.autoResize||!1,this.preserveDrawingBuffer=i.preserveDrawingBuffer,this.clearBeforeRender=i.clearBeforeRender,this.width=t||800,this.height=e||600,this.view=i.view||document.createElement('canvas'),this.domElement=this.view,this.contextLostBound=this.handleContextLost.bind(this),this.contextRestoredBound=this.handleContextRestored.bind(this),this.view.addEventListener('webglcontextlost',this.contextLostBound,!1),this.view.addEventListener('webglcontextrestored',this.contextRestoredBound,!1),this._contextOptions={alpha:this.transparent,antialias:i.antialias,premultipliedAlpha:this.transparent&&'notMultiplied'!==this.transparent,stencil:!0,preserveDrawingBuffer:i.preserveDrawingBuffer},this.projection=new k,this.offset=new k(0,0),this.shaderManager=new dt,this.spriteBatch=new ut(this),this.maskManager=new pt,this.filterManager=new ft(this),this.stencilManager=new st,this.blendModeManager=new yt(this),this.initContext()};gt.prototype.constructor=gt,gt.prototype.initContext=function(){var t=this.view.getContext('webgl',this._contextOptions)||this.view.getContext('experimental-webgl',this._contextOptions);if(this.gl=t,!t)throw new Error('This browser does not support webGL. Try using the canvas renderer');if(this.glContextId=t.id=gt.glContextId++,Tiny.glContexts[this.glContextId]=t,Tiny.instances[this.glContextId]=this,t.disable(t.DEPTH_TEST),t.disable(t.CULL_FACE),t.enable(t.BLEND),!this.blendModes){var e={};e[o.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[o.ADD]=[t.ONE,t.DST_ALPHA],e[o.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA],e[o.SCREEN]=[t.ONE,t.ONE_MINUS_SRC_COLOR],e[o.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[o.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[o.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[o.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[o.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[o.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[o.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[o.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[o.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[o.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[o.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[o.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[o.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],this.blendModes=e}this.shaderManager.setContext(t),this.spriteBatch.setContext(t),this.maskManager.setContext(t),this.filterManager.setContext(t),this.blendModeManager.setContext(t),this.stencilManager.setContext(t),this.resize(this.width,this.height)},gt.prototype.setClearColor=function(t){this.clearColor=Tiny.hex2rgb(Tiny.style2hex(t))},gt.prototype.render=function(t){if(!this.contextLost){this.__scene!==t&&(t.interactive&&t.interactionManager.removeEvents(),this.__scene=t),t.updateTransform();var e=this.gl;t._interactive?t._interactiveEventsAdded||(t._interactiveEventsAdded=!0,t.interactionManager.setTarget(this)):t._interactiveEventsAdded&&(t._interactiveEventsAdded=!1,t.interactionManager.setTarget(this)),e.viewport(0,0,this.width,this.height),e.bindFramebuffer(e.FRAMEBUFFER,null),this.clearBeforeRender&&(this.transparent?e.clearColor(0,0,0,0):e.clearColor(this.clearColor[0],this.clearColor[1],this.clearColor[2],1),e.clear(e.COLOR_BUFFER_BIT)),this.renderObject(t,this.projection)}},gt.prototype.renderObject=function(t,e,i){this.blendModeManager.setBlendMode(o.NORMAL),this.drawCount=0,this.flipY=i?-1:1,this.projection=e,this.spriteBatch.begin(this),this.filterManager.begin(this,i),t.render(this),this.spriteBatch.flush()},gt.prototype.resize=function(t,e){this.width=Math.floor(t*this.resolution),this.height=Math.floor(e*this.resolution);var i=this.view;i.width=this.width,i.height=this.height,this.autoResize&&(i.style.width=t+'px',i.style.height=e+'px'),this.gl.viewport(0,0,this.width,this.height),this.projection.x=this.width/2/this.resolution,this.projection.y=-this.height/2/this.resolution},gt.prototype.updateTexture=function(t){if(t.loaded){var e=this.gl;return t._glTextures[e.id]||(t._glTextures[e.id]=e.createTexture()),e.bindTexture(e.TEXTURE_2D,t._glTextures[e.id]),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultipliedAlpha),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t.source),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t.scaleMode===a.LINEAR?e.LINEAR:e.NEAREST),t.mipmap&&T(t.width)&&T(t.height)?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t.scaleMode===a.LINEAR?e.LINEAR_MIPMAP_LINEAR:e.NEAREST_MIPMAP_NEAREST),e.generateMipmap(e.TEXTURE_2D)):e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t.scaleMode===a.LINEAR?e.LINEAR:e.NEAREST),t._powerOf2?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)),t._dirty[e.id]=!1,t._glTextures[e.id]}},gt.prototype.handleContextLost=function(t){t.preventDefault(),this.contextLost=!0},gt.prototype.handleContextRestored=function(){for(var t in this.initContext(),S.image)S.image[t]._glTextures=[];this.contextLost=!1},gt.prototype.destroy=function(t){this.view.removeEventListener('webglcontextlost',this.contextLostBound),this.view.removeEventListener('webglcontextrestored',this.contextRestoredBound),Tiny.glContexts[this.glContextId]=null,this.projection=null,this.offset=null,this.shaderManager.destroy(),this.spriteBatch.destroy(),this.maskManager.destroy(),this.filterManager.destroy(),this.shaderManager=null,this.spriteBatch=null,this.maskManager=null,this.filterManager=null,this.gl=null,!1!==t&&this.domElement.parentNode&&this.domElement.parentNode.removeChild(this.domElement)},gt.glContextId=0;var vt={Triangulate:function(t){var e=!0,i=t.length>>1;if(i<3)return[];for(var r=[],s=[],n=0;n<i;n++)s.push(n);n=0;for(var h=i;h>3;){var o=s[(n+0)%h],a=s[(n+1)%h],u=s[(n+2)%h],l=t[2*o],c=t[2*o+1],d=t[2*a],p=t[2*a+1],f=t[2*u],y=t[2*u+1],g=!1;if(vt._convex(l,c,d,p,f,y,e)){g=!0;for(var v=0;v<h;v++){var m=s[v];if(m!==o&&m!==a&&m!==u&&vt._PointInTriangle(t[2*m],t[2*m+1],l,c,d,p,f,y)){g=!1;break}}}if(g)r.push(o,a,u),s.splice((n+1)%h,1),h--,n=0;else if(n++>3*h){if(!e)return null;for(r=[],s=[],n=0;n<i;n++)s.push(n);n=0,h=i,e=!1}}return r.push(s[0],s[1],s[2]),r},_PointInTriangle:function(t,e,i,r,s,n,h,o){var a=h-i,u=o-r,l=s-i,c=n-r,d=t-i,p=e-r,f=a*a+u*u,y=a*l+u*c,g=a*d+u*p,v=l*l+c*c,m=l*d+c*p,_=1/(f*v-y*y),x=(v*g-y*m)*_,w=(f*m-y*g)*_;return x>=0&&w>=0&&x+w<1},_convex:function(t,e,i,r,s,n,h){return(e-r)*(s-i)+(i-t)*(n-r)>=0===h}},mt=function(){};mt.renderGraphics=function(t,e){var i,r=e.gl,s=e.projection,n=e.offset,h=e.shaderManager.primitiveShader;t.dirty&&mt.updateGraphics(t,r);for(var o=t._webGL[r.id],a=0;a<o.data.length;a++)1===o.data[a].mode?(i=o.data[a],e.stencilManager.pushStencil(t,i,e),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,2*(i.indices.length-4)),e.stencilManager.popStencil(t,i,e)):(i=o.data[a],e.shaderManager.setShader(h),h=e.shaderManager.primitiveShader,r.uniformMatrix3fv(h.translationMatrix,!1,t.worldTransform.toArray(!0)),r.uniform1f(h.flipY,1),r.uniform2f(h.projectionVector,s.x,-s.y),r.uniform2f(h.offsetVector,-n.x,-n.y),r.uniform3fv(h.tintColor,Tiny.style2rgb(t.tint)),r.uniform1f(h.alpha,t.worldAlpha),r.bindBuffer(r.ARRAY_BUFFER,i.buffer),r.vertexAttribPointer(h.aVertexPosition,2,r.FLOAT,!1,24,0),r.vertexAttribPointer(h.colorAttribute,4,r.FLOAT,!1,24,8),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,i.indexBuffer),r.drawElements(r.TRIANGLE_STRIP,i.indices.length,r.UNSIGNED_SHORT,0))},mt.updateGraphics=function(t,e){var i,r,s=t._webGL[e.id];if(s||(s=t._webGL[e.id]={lastIndex:0,data:[],gl:e}),t.dirty=!1,t.clearDirty){for(t.clearDirty=!1,i=0;i<s.data.length;i++){var n=s.data[i];n.reset(),mt.graphicsDataPool.push(n)}s.data=[],s.lastIndex=0}for(i=s.lastIndex;i<t.graphicsData.length;i++){var h=t.graphicsData[i];if(h.type===u.POLY){if(h.points=h.shape.points.slice(),h.shape.closed&&(h.points[0]===h.points[h.points.length-2]&&h.points[1]===h.points[h.points.length-1]||h.points.push(h.points[0],h.points[1])),h.fill)if(h.points.length>=6)if(h.points.length<12)r=mt.switchMode(s,0),mt.buildPoly(h,r)||(r=mt.switchMode(s,1),mt.buildComplexPoly(h,r));else r=mt.switchMode(s,1),mt.buildComplexPoly(h,r);h.lineWidth>0&&(r=mt.switchMode(s,0),mt.buildLine(h,r))}else r=mt.switchMode(s,0),h.type===u.RECT?mt.buildRectangle(h,r):h.type===u.CIRC||h.type===u.ELIP?mt.buildCircle(h,r):h.type===u.RREC&&mt.buildRoundedRectangle(h,r);s.lastIndex++}for(i=0;i<s.data.length;i++)(r=s.data[i]).dirty&&r.upload()},mt.switchMode=function(t,e){var i;return t.data.length&&(i=t.data[t.data.length-1]).mode===e&&1!==e||((i=mt.graphicsDataPool.pop()||new _t(t.gl)).mode=e,t.data.push(i)),i.dirty=!0,i},mt.buildRectangle=function(t,e){var i=t.shape,r=i.x,s=i.y,n=i.width,h=i.height;if(t.fill){var o=Tiny.style2rgb(t.fillColor),a=t.fillAlpha,u=o[0]*a,l=o[1]*a,c=o[2]*a,d=e.points,p=e.indices,f=d.length/6;d.push(r,s),d.push(u,l,c,a),d.push(r+n,s),d.push(u,l,c,a),d.push(r,s+h),d.push(u,l,c,a),d.push(r+n,s+h),d.push(u,l,c,a),p.push(f,f,f+1,f+2,f+3,f+3)}if(t.lineWidth){var y=t.points;t.points=[r,s,r+n,s,r+n,s+h,r,s+h,r,s],mt.buildLine(t,e),t.points=y}},mt.buildRoundedRectangle=function(t,e){var i=t.shape,r=i.x,s=i.y,n=i.width,h=i.height,o=i.radius,a=[];if(a.push(r,s+o),a=(a=(a=(a=a.concat(mt.quadraticBezierCurve(r,s+h-o,r,s+h,r+o,s+h))).concat(mt.quadraticBezierCurve(r+n-o,s+h,r+n,s+h,r+n,s+h-o))).concat(mt.quadraticBezierCurve(r+n,s+o,r+n,s,r+n-o,s))).concat(mt.quadraticBezierCurve(r+o,s,r,s,r,s+o)),t.fill){var u=Tiny.style2rgb(t.fillColor),l=t.fillAlpha,c=u[0]*l,d=u[1]*l,p=u[2]*l,f=e.points,y=e.indices,g=f.length/6,v=vt.Triangulate(a),m=0;for(m=0;m<v.length;m+=3)y.push(v[m]+g),y.push(v[m]+g),y.push(v[m+1]+g),y.push(v[m+2]+g),y.push(v[m+2]+g);for(m=0;m<a.length;m++)f.push(a[m],a[++m],c,d,p,l)}if(t.lineWidth){var _=t.points;t.points=a,mt.buildLine(t,e),t.points=_}},mt.quadraticBezierCurve=function(t,e,i,r,s,n){var h,o,a,u,l,c,d=[];function p(t,e,i){return t+(e-t)*i}for(var f=0,y=0;y<=20;y++)h=p(t,i,f=y/20),o=p(e,r,f),a=p(i,s,f),u=p(r,n,f),l=p(h,a,f),c=p(o,u,f),d.push(l,c);return d},mt.buildCircle=function(t,e){var i,r,s=t.shape,n=s.x,h=s.y;t.type===u.CIRC?(i=s.radius,r=s.radius):(i=s.width,r=s.height);var o=2*Math.PI/40,a=0;if(t.fill){var l=Tiny.style2rgb(t.fillColor),c=t.fillAlpha,d=l[0]*c,p=l[1]*c,f=l[2]*c,y=e.points,g=e.indices,v=y.length/6;for(g.push(v),a=0;a<41;a++)y.push(n,h,d,p,f,c),y.push(n+Math.sin(o*a)*i,h+Math.cos(o*a)*r,d,p,f,c),g.push(v++,v++);g.push(v-1)}if(t.lineWidth){var m=t.points;for(t.points=[],a=0;a<41;a++)t.points.push(n+Math.sin(o*a)*i,h+Math.cos(o*a)*r);mt.buildLine(t,e),t.points=m}},mt.buildLine=function(t,e){var i=0,r=t.points;if(0!==r.length){if(t.lineWidth%2)for(i=0;i<r.length;i++)r[i]+=.5;var s=new k(r[0],r[1]),n=new k(r[r.length-2],r[r.length-1]);if(s.x===n.x&&s.y===n.y){(r=r.slice()).pop(),r.pop();var h=(n=new k(r[r.length-2],r[r.length-1])).x+.5*(s.x-n.x),o=n.y+.5*(s.y-n.y);r.unshift(h,o),r.push(h,o)}var a,u,l,c,d,p,f,y,g,v,m,_,x,w,b,T,E,A,S,R,C,B,M=e.points,P=e.indices,L=r.length/2,F=r.length,I=M.length/6,U=t.lineWidth/2,O=Tiny.style2rgb(t.lineColor),D=t.lineAlpha,N=O[0]*D,j=O[1]*D,G=O[2]*D;for(l=r[0],c=r[1],d=r[2],g=-(c-(p=r[3])),v=l-d,g/=B=Math.sqrt(g*g+v*v),v/=B,g*=U,v*=U,M.push(l-g,c-v,N,j,G,D),M.push(l+g,c+v,N,j,G,D),i=1;i<L-1;i++)l=r[2*(i-1)],c=r[2*(i-1)+1],d=r[2*i],p=r[2*i+1],f=r[2*(i+1)],y=r[2*(i+1)+1],g=-(c-p),v=l-d,g/=B=Math.sqrt(g*g+v*v),v/=B,g*=U,v*=U,m=-(p-y),_=d-f,m/=B=Math.sqrt(m*m+_*_),_/=B,E=(-g+l)*(-v+p)-(-g+d)*(-v+c),R=(-(m*=U)+f)*(-(_*=U)+p)-(-m+d)*(-_+y),C=(b=-v+c-(-v+p))*(S=-m+d-(-m+f))-(A=-_+y-(-_+p))*(T=-g+d-(-g+l)),Math.abs(C)<.1?(C+=10.1,M.push(d-g,p-v,N,j,G,D),M.push(d+g,p+v,N,j,G,D)):((a=(T*R-S*E)/C)-d)*(a-d)+((u=(A*E-b*R)/C)-p)+(u-p)>19600?(x=g-m,w=v-_,x/=B=Math.sqrt(x*x+w*w),w/=B,x*=U,w*=U,M.push(d-x,p-w),M.push(N,j,G,D),M.push(d+x,p+w),M.push(N,j,G,D),M.push(d-x,p-w),M.push(N,j,G,D),F++):(M.push(a,u),M.push(N,j,G,D),M.push(d-(a-d),p-(u-p)),M.push(N,j,G,D));for(l=r[2*(L-2)],c=r[2*(L-2)+1],d=r[2*(L-1)],g=-(c-(p=r[2*(L-1)+1])),v=l-d,g/=B=Math.sqrt(g*g+v*v),v/=B,g*=U,v*=U,M.push(d-g,p-v),M.push(N,j,G,D),M.push(d+g,p+v),M.push(N,j,G,D),P.push(I),i=0;i<F;i++)P.push(I++);P.push(I-1)}},mt.buildComplexPoly=function(t,e){var i=t.points.slice();if(!(i.length<6)){var r=e.indices;e.points=i,e.alpha=t.fillAlpha,e.color=Tiny.style2rgb(t.fillColor);for(var s,n,h=1/0,o=-1/0,a=1/0,u=-1/0,l=0;l<i.length;l+=2)h=(s=i[l])<h?s:h,o=s>o?s:o,a=(n=i[l+1])<a?n:a,u=n>u?n:u;i.push(h,a,o,a,o,u,h,u);var c=i.length/2;for(l=0;l<c;l++)r.push(l)}},mt.buildPoly=function(t,e){var i=t.points;if(!(i.length<6)){var r=e.points,s=e.indices,n=i.length/2,h=Tiny.style2rgb(t.fillColor),o=t.fillAlpha,a=h[0]*o,u=h[1]*o,l=h[2]*o,c=vt.Triangulate(i);if(!c)return!1;var d=r.length/6,p=0;for(p=0;p<c.length;p+=3)s.push(c[p]+d),s.push(c[p]+d),s.push(c[p+1]+d),s.push(c[p+2]+d),s.push(c[p+2]+d);for(p=0;p<n;p++)r.push(i[2*p],i[2*p+1],a,u,l,o);return!0}},mt.graphicsDataPool=[];var _t=function(t){this.gl=t,this.color=[0,0,0],this.points=[],this.indices=[],this.buffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),this.mode=1,this.alpha=1,this.dirty=!0};_t.prototype.reset=function(){this.points=[],this.indices=[]},_t.prototype.upload=function(){var t=this.gl;this.glPoints=new Float32Array(this.points),t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.bufferData(t.ARRAY_BUFFER,this.glPoints,t.STATIC_DRAW),this.glIndicies=new Uint16Array(this.indices),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.glIndicies,t.STATIC_DRAW),this.dirty=!1},Tiny.BaseObject2D=W,Tiny.Object2D=X,Tiny.Scene=z,Tiny.Sprite=Q,Tiny.Text=J,Tiny.Graphics=it,Tiny.Texture=q,Tiny.RenderTexture=rt,Tiny.Rectangle=Y,Tiny.WebGLGraphics=mt,Tiny.Renderer=gt}()}();