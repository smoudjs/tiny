!function(){var t={538:function(){Object.assign(Tiny.Graphics.prototype,{generateTexture:function(t,e){t=t||1;var i=this.getBounds(),s=new Tiny.CanvasBuffer(i.width*t,i.height*t),r=new Tiny.Texture(s.canvas,e);return r.base.resolution=t,s.context.scale(t,t),s.context.translate(-i.x,-i.y),Tiny.CanvasGraphics.renderGraphics(this,s.context),r},renderCanvas:function(t){if(!1!==this.visible&&0!==this.alpha&&!0!==this.isMask){if(this._cacheAsBitmap)return(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1),this._cachedSprite.alpha=this.alpha,void Tiny.Sprite.prototype.renderCanvas.call(this._cachedSprite,t);var e=t.context,i=this.worldTransform;this._prevTint!==this.tint.int&&(this.dirty=!0,this._prevTint=this.tint.int),this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,e.globalCompositeOperation=PIXI.blendModesCanvas[t.currentBlendMode]),this._mask&&t.maskManager.pushMask(this._mask,t);var s=t.resolution;e.setTransform(i.a*s,i.b*s,i.c*s,i.d*s,i.tx*s,i.ty*s),Tiny.CanvasGraphics.renderGraphics(this,e);for(var r=0,n=this.children.length;r<n;r++)this.children[r]._renderCanvas(t);this._mask&&t.maskManager.popMask(t)}},_generateCachedSprite:function(){var t=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.buffer.resize(t.width,t.height);else{var e=new Tiny.CanvasBuffer(t.width,t.height),i=new Tiny.Texture(e.canvas);this._cachedSprite=new Tiny.Sprite(i),this._cachedSprite.buffer=e,this._cachedSprite.worldTransform=this.worldTransform}this._cachedSprite.anchor.x=-t.x/t.width,this._cachedSprite.anchor.y=-t.y/t.height,this._cachedSprite.buffer.context.translate(-t.x,-t.y),this.worldAlpha=1,this.dirty=!0,Tiny.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context),this._cachedSprite.alpha=this.alpha},updateCachedSpriteTexture:function(){var t=this._cachedSprite,e=t.texture,i=t.buffer.canvas;e.base.width=i.width,e.base.height=i.height,e.crop.width=e.frame.width=i.width,e.crop.height=e.frame.height=i.height,t._width=i.width,t._height=i.height,e.base.dirty()},destroyCachedSprite:function(){this._cachedSprite.texture.destroy(!0),this._cachedSprite=null}})},178:function(){Tiny.Object2D.prototype.renderCanvas=function(t){if(!1!==this.visible&&0!==this.alpha)if(this._cacheAsBitmap)this._renderCachedSprite(t);else{this._mask&&t.maskManager.pushMask(this._mask,t);for(var e=0,i=this.children.length;e<i;e++)this.children[e].renderCanvas(t);this._mask&&t.maskManager.popMask(t)}},Tiny.Sprite.prototype.renderCanvas=function(t){if(!(!1===this.visible||0===this.alpha||!1===this.renderable||this.texture.crop.width<=0||this.texture.crop.height<=0)){if(this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,t.context.globalCompositeOperation=t.blendModes[t.currentBlendMode]),this._mask&&t.maskManager.pushMask(this._mask,t),this.texture.valid){var e=this.texture.base.resolution/t.resolution;t.context.globalAlpha=this.worldAlpha;var i=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,s=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height;t.roundPixels?(t.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution|0,this.worldTransform.ty*t.resolution|0),i|=0,s|=0):t.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution,this.worldTransform.ty*t.resolution),16777215!==this.tint.int?(this.cachedTint!==this.tint.int&&(this.cachedTint=this.tint.int,this.tintedTexture=Tiny.CanvasTinter.getTintedTexture(this,this.tint)),t.context.drawImage(this.tintedTexture,0,0,this.texture.crop.width,this.texture.crop.height,i/e,s/e,this.texture.crop.width/e,this.texture.crop.height/e)):t.context.drawImage(this.texture.base.source,this.texture.crop.x,this.texture.crop.y,this.texture.crop.width,this.texture.crop.height,i/e,s/e,this.texture.crop.width/e,this.texture.crop.height/e)}for(var r=0;r<this.children.length;r++)this.children[r].renderCanvas(t);this._mask&&t.maskManager.popMask(t)}},Tiny.Text.prototype.renderCanvas=function(t){(this.dirty||this.resolution!==t.resolution)&&(this.resolution=t.resolution,this.updateText(),this.dirty=!1),Tiny.Sprite.prototype.renderCanvas.call(this,t)},Tiny.RenderTexture.prototype.renderCanvas=function(t,e,i){if(this.valid){var s=t.worldTransform;s.identity(),e&&s.append(e),t.worldAlpha=1;for(var r=t.children,n=0,h=r.length;n<h;n++)r[n].updateTransform();s.identity(),i&&this.textureBuffer.clear();var o=this.textureBuffer.context,a=this.renderer.resolution;this.renderer.resolution=this.base.resolution,this.renderer.renderObject(t,o),this.renderer.resolution=a}}},498:function(){var t={VERSION:'2.2.2'};window.Tiny=t},847:function(){Date.now||(Date.now=function(){return(new Date).getTime()}),'undefined'==typeof Float32Array&&(window.Float32Array=Array,window.Uint16Array=Array),void 0===Object.assign&&(Object.assign=function(t){'use strict';if(null==t)throw new TypeError('Cannot convert undefined or null to object');for(var e=Object(t),i=1;i<arguments.length;i++){var s=arguments[i];if(null!=s)for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e})}},e={};function i(s){var r=e[s];if(void 0!==r)return r.exports;var n=e[s]={exports:{}};return t[s](n,n.exports,i),n.exports}!function(){"use strict";i(847),i(498);var t=function(t,e,i){this.width=t,this.height=e,this.canvas=document.createElement('canvas'),this.context=this.canvas.getContext('2d',i),this.canvas.width=t,this.canvas.height=e};function e(){this.a=[],this.n=0}t.prototype.constructor=t,t.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.width,this.height)},t.prototype.resize=function(t,e){this.width=this.canvas.width=t,this.height=this.canvas.height=e};var s={call:function(t){t&&(t=t.prototype||t,s.mixin(t))},mixin:function(t){const i={};function s(t,s,r,n){var h=i[t];h||(h=i[t]=new e),h.a.push(s,r||null,n||!1),h.n+=3}t.once=function(t,e,i){s(t,e,i,!0)},t.on=s,t.off=function(t,e,s){if(i[t]){var r=i[t].a;if(e)if(s)for(n=0;n<r.length;n+=3)r[n]==e&&r[n+1]==s&&(r.splice(n,3),n-=3);else for(var n=0;n<r.length;n+=3)r[n]==e&&(r.splice(n,3),n-=3);else r.length=0;0==r.length&&delete i[t]}},t.emit=function(t,e,s,r){var n=i[t];if(n){var h=n.a;n.n=0;for(var o,a,l=arguments.length,u=0;u<h.length-n.n;u+=3)o=h[u],a=h[u+1],h[u+2]&&(h.splice(u,3),u-=3),l<=1?o.call(a):2==l?o.call(a,e):3==l?o.call(a,e,s):o.call(a,e,s,r);0==h.length&&delete i[t]}}}},r=0;var n=Math.PI/180,h=180/Math.PI,o={distance:function(t,e,i,s){var r=t-i,n=e-s;return Math.sqrt(r*r+n*n)},degToRad:function(t){return t*n},radToDeg:function(t){return t*h},isPow2:function(t){return!(t&t-1||!t)},getNextPow2:function(t){if(t>0&&0==(t&t-1))return t;for(var e=1;e<t;)e<<=1;return e}};function a(t,e,i){return this.r=1,this.g=1,this.b=1,this.a=1,this.int=16777215,void 0===e&&void 0===i?this.set(t):this.setRGB(t,e,i)}Object.assign(a.prototype,{set:function(t){return t&&'number'==typeof t.int?this.copy(t):'number'==typeof t?this.setHex(t):'string'==typeof t&&this.setStyle(t),this},refresh:function(){return this.int=(255*this.r<<16)+(255*this.g<<8)+(255*this.b|0),this},setHex:function(t){return t|=0,this.int=t,this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,e,i){return this.r=t,this.g=e,this.b=i,this.refresh()},setStyle:function(t){var e=t.length;if(4===e){var i=t.charAt(1),s=t.charAt(2),r=t.charAt(3);return this.setHex(+('0x'+i+i+s+s+r+r))}return 7===e?this.setHex(+t.replace('#','0x')):this},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this.refresh()},toStyle(){return'#'+('00000'+this.int.toString(16)).slice(-6)},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this.refresh()},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}});var l=function(t,e){this.x=t||0,this.y=e||0};l.prototype={set:function(t,e){return this.x=t||0,this.y=e||(0!==e?this.x:0),this}};var u=function(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0};u.prototype.fromArray=function(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]},u.prototype.toArray=function(t){this.array||(this.array=new Float32Array(9));var e=this.array;return t?(e[0]=this.a,e[1]=this.b,e[2]=0,e[3]=this.c,e[4]=this.d,e[5]=0,e[6]=this.tx,e[7]=this.ty,e[8]=1):(e[0]=this.a,e[1]=this.c,e[2]=this.tx,e[3]=this.b,e[4]=this.d,e[5]=this.ty,e[6]=0,e[7]=0,e[8]=1),e},u.prototype.apply=function(t,e){e=e||new l;var i=t.x,s=t.y;return e.x=this.a*i+this.c*s+this.tx,e.y=this.b*i+this.d*s+this.ty,e},u.prototype.applyInverse=function(t,e){e=e||new l;var i=1/(this.a*this.d+this.c*-this.b),s=t.x,r=t.y;return e.x=this.d*i*s+-this.c*i*r+(this.ty*this.c-this.tx*this.d)*i,e.y=this.a*i*r+-this.b*i*s+(-this.ty*this.a+this.tx*this.b)*i,e},u.prototype.translate=function(t,e){return this.tx+=t,this.ty+=e,this},u.prototype.scale=function(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this},u.prototype.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),s=this.a,r=this.c,n=this.tx;return this.a=s*e-this.b*i,this.b=s*i+this.b*e,this.c=r*e-this.d*i,this.d=r*i+this.d*e,this.tx=n*e-this.ty*i,this.ty=n*i+this.ty*e,this},u.prototype.append=function(t){var e=this.a,i=this.b,s=this.c,r=this.d;return this.a=t.a*e+t.b*s,this.b=t.a*i+t.b*r,this.c=t.c*e+t.d*s,this.d=t.c*i+t.d*r,this.tx=t.tx*e+t.ty*s+this.tx,this.ty=t.tx*i+t.ty*r+this.ty,this},u.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this};var c=new u;const d={NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},p={LINEAR:0,NEAREST:1},f={POLY:0,RECT:1,CIRC:2,ELIP:3,RREC:4};Tiny.CanvasBuffer=t,Tiny.EventEmitter=s,Tiny.Math=o,Tiny.Mat3=u,Tiny.Vec2=l,Tiny.Color=a,Object.assign(Tiny,d),Object.assign(Tiny,p),Object.assign(Tiny,f);var y=[];function g(t,e){y.push({name:t,_class_:e})}var m,v,w,x,_,T=function(){},b=function(t){this.callbackContext=this,this.state=0,this.timeScale=1,this.width=0,this.height=0,this.systems=[],this.updatable=[],this.paused=!1,this.pauseDuration=0,this.inputView=document.body,Tiny.app||(Tiny.app=this),s.mixin(this),t=t||{},this.boot=t.boot||this.boot||T,this.preload=t.preload||this.preload||T,this.create=t.create||this.create||T,this.update=t.update||this.update||T,this.render=t.render||this.render||T,this._resize_cb=t.resize||T,this._destroy_cb=t.destroy||T;var e=this;setTimeout((function(){e._boot()}),0)};b.prototype._boot=function(){for(var t=0;t<y.length;t++){var e=y[t],i=new e._class_(this);this.systems.push(i),i.update&&this.updatable.push(i),e.name&&(this[e.name]=i)}Tiny.RAF&&(this.raf=new Tiny.RAF(this)),this.boot.call(this.callbackContext);var s=this;setTimeout((function(){s.load?s._preload():s._create()}),0)},b.prototype._preload=function(){this.preload.call(this.callbackContext),this.state=1,this.load.start(this._create)},b.prototype._create=function(){this.emit('load'),this.create.call(this.callbackContext),this.raf&&this.raf.start(),this.state=2},b.prototype.pause=function(){if(this.raf&&this.raf.reset(),!this.paused){for(var t=0;t<this.systems.length;t++)this.systems[t].pause&&this.systems[t].pause();this.paused=!0}},b.prototype.resume=function(){if(this.raf&&this.raf.reset(),this.paused){for(var t=0;t<this.systems.length;t++)this.systems[t].resume&&this.systems[t].resume();this.paused=!1}},b.prototype._update=function(t,e){if(this.paused)this.pauseDuration+=e;else{e*=this.timeScale,this.update.call(this.callbackContext,t,e),this.emit('update',e);for(var i=0;i<this.updatable.length;i++)this.updatable[i].update(e)}this.render(),this.emit('postrender')},b.prototype.resize=function(t,e){this.width=t||this.width,this.height=e||this.height,this.state>0&&(this._resize_cb.call(this.callbackContext,this.width,this.height),this.emit('resize',t,e));var i=this;setTimeout((function(){i.input&&i.input.updateBounds()}),0)},b.prototype.destroy=function(t){for(var e=0;e<this.systems.length;e++)this.systems[e].destroy&&this.systems[e].destroy(t);this.paused=!0,t&&this.load.clearCache(),this.raf&&this.raf.stop(),this._destroy_cb.call(this.callbackContext),Tiny.app===this&&(Tiny.app=null)};var C=function(){return(new Date).getTime()};void 0!==self.performance&&void 0!==self.performance.now?C=self.performance.now.bind(self.performance):void 0!==Date.now&&(C=Date.now);var S=function(t,e){void 0===e&&(e=!1),this.game=t,this.isRunning=!1,this.forceSetTimeOut=e;for(var i=['ms','moz','webkit','o'],s=0;s<i.length&&!window.requestAnimationFrame;s++)window.requestAnimationFrame=window[i[s]+'RequestAnimationFrame'],window.cancelAnimationFrame=window[i[s]+'CancelAnimationFrame']||window[i[s]+'CancelRequestAnimationFrame'];m=!1,v=null,w=null,x=0,_=0};S.prototype={start:function(){x=C(),this.isRunning=!0;var t=this;!window.requestAnimationFrame||this.forceSetTimeOut?(m=!0,v=function(){return t.updateSetTimeout()},w=window.setTimeout(v,0)):(m=!1,v=function(){return t.updateRAF()},w=window.requestAnimationFrame(v))},updateRAF:function(){_=C(),this.isRunning&&(this.game._update(Math.floor(_),_-x),w=window.requestAnimationFrame(v)),x=_},updateSetTimeout:function(){_=C(),this.isRunning&&(this.game._update(Math.floor(_),_-x),w=window.setTimeout(v,S.timeToCall)),x=_},reset:function(){x=C()},stop:function(){m?clearTimeout(w):window.cancelAnimationFrame(w),this.isRunning=!1}},S.timeToCall=15;var M=function(t,e){this.resolution=1,this.width=100,this.height=100,this.scaleMode=e||0,this.loaded=!1,this.source=t,this._UID=++r,this.premultipliedAlpha=!0,this._glTextures=[],this.mipmap=!1,this._dirty=[!0,!0,!0,!0],t&&((t.complete||t.getContext)&&t.width&&t.height?this.onLoad():t.onload=this.onLoad.bind(this),this.imageUrl=null,this._powerOf2=!1)};M.prototype.constructor=M,M.prototype.onLoad=function(t){this.loaded=!0,this.width=this.source.naturalWidth||this.source.width,this.height=this.source.naturalHeight||this.source.height,this.dirty(),this.onload&&this.onload()},M.prototype.destroy=function(){this.imageUrl?(delete BaseTextureCache[this.imageUrl],delete PIXI.TextureCache[this.imageUrl],this.imageUrl=null,navigator.isCocoonJS||(this.source.src='')):this.source&&this.source._pixiId&&delete BaseTextureCache[this.source._pixiId],this.source=null,this.unloadFromGPU()},M.prototype.dirty=function(){for(var t=0;t<this._glTextures.length;t++)this._dirty[t]=!0},M.prototype.unloadFromGPU=function(){this.dirty();for(var t=this._glTextures.length-1;t>=0;t--){var e=this._glTextures[t],i=Tiny.glContexts[t];i&&e&&i.deleteTexture(e)}this._glTextures.length=0,this.dirty()};var E,R={image:{},texture:{}},k=function(t){s.mixin(this),t.cache=R,this.game=t,this.list=[]};k.prototype={clearCache:function(){for(var t in R.texture)R.texture[t].destroy();for(var t in R)R[t]={}},all:function(t){this.list=this.list.concat(t)},image:function(t,e){this.list.push({src:e,key:t,type:'image'})},spritesheet:function(t,e,i,s,r,n){var h={src:e,key:t,type:'spritesheet'};'number'==typeof i?(h.width=i,h.height=s,h.total=r,h.duration=n):i.length>0&&(h.data=i),this.list.push(h)},atlas:function(t,e,i){this.list.push({src:e,key:t,data:i,type:'atlas'})},start:function(t){var e=this,i=e.game,s=e.list,r=s.length;function n(){var t=s.shift(),e=k[t.type];e?e(t,h):h()}function h(h,o){e.emit('progress',1-s.length/r),0!=s.length?n():(e.emit('complete'),t.call(i))}0!=r?n():t.call(i)}},k.atlas=function(t,e){var i=t.key;k.image(t,(function(t,s){for(var r=0;r<t.data.length;r++){var n=i+'.'+t.data[r].name,h=new Tiny.Texture(s,t.data[r]);h.key=i,R.texture[n]=h}e()}))},k.spritesheet=function(t,e){var i=t.key;k.image(t,(function(t,s){var r,n,h;if(t.data){var o=t.data;r=o.length-1;for(var a=0;a<=r;a++)n=i+'.'+a,(h=new Tiny.Texture(s,{name:a,x:Math.floor(o[a].x),y:Math.floor(o[a].y),width:Math.floor(o[a].width),height:Math.floor(o[a].height),duration:o[a].duration})).key=i,h.lastFrame=r,R.texture[n]=h}else{var l=s.width,u=s.height,c=t.width,d=t.height;c||(c=Math.floor(l/(t.cols||1))),d||(d=Math.floor(u/(t.rows||1)));var p=Math.floor(l/c)*Math.floor(u/d);if(0===p)return e();t.total&&(p=Math.min(p,t.total));var f=0,y=0;r=p-1;for(a=0;a<p;a++)n=i+'.'+a,(h=new Tiny.Texture(s,{name:a,x:f,y,width:c,height:d,duration:t.duration})).key=i,h.lastFrame=r,R.texture[n]=h,(f+=c)+c>l&&(f=0,y+=d)}e()}))},k.image=function(t,e){const i=new Image;i.addEventListener('load',(function(){var s=new M(i);R.image[t.key]=s,e(t,s)})),i.src=t.src},g('load',k);var B=function(t){this.game=t;var e=this.domElement=t.inputView;this.bounds={x:0,y:0,width:0,height:0},this.candidates=[],this.list=[],this.lastMove=null,this.isDown=!1,this.downHandler=this.downHandler.bind(this),this.moveHandler=this.moveHandler.bind(this),this.upHandler=this.upHandler.bind(this),e.addEventListener('touchstart',this.downHandler),e.addEventListener('touchmove',this.moveHandler),e.addEventListener('touchend',this.upHandler),e.addEventListener('touchcancel',this.upHandler),e.addEventListener('mousedown',this.downHandler),e.addEventListener('mousemove',this.moveHandler),e.addEventListener('mouseup',this.upHandler),s.mixin(this);for(var i=0;i<B.systems.length;i++)B.systems[i].init.call(this);this.updateBounds()};B.prototype={add:function(t,e){t.inputEnabled=!0,(e=e||{}).system=this,t.input=e,s.mixin(t.input),this.list.push(t)},remove:function(t){var e=this.list.indexOf(t);if(e>-1){var i=this.list[e];return i.input=null,i.inputEnabled=!1,this.list.splice(e,1),i}},inputHandler:function(t,e){var i=this.getCoords(e);if(null!==i){if('move'!=t){this.candidates.length=0;for(var s=0;s<B.systems.length;s++)B.systems[s].preHandle.call(this,i.x,i.y);for(var r,n=0;n<this.list.length;n++)(r=this.list[n]).inputEnabled&&r.parent&&(r.input.checkBounds?r.input.checkBounds.call(this,r,i.x,i.y):B.checkBounds.call(this,r,i.x,i.y))&&this.candidates.push(r);for(s=this.candidates.length-1;s>=0;s--){if((r=this.candidates[s]).input['last_'+t]={x:i.x,y:i.y},r.input.emit(t,{x:i.x,y:i.y}),'up'==t){var h=r.input.last_down;h&&o.distance(h.x,h.y,i.x,i.y)<30&&r.input.emit('click',{x:i.x,y:i.y})}if(!r.input.transparent)break}}this.emit(t,{x:i.x,y:i.y})}},moveHandler:function(t){this.lastMove=t,this.inputHandler('move',t)},upHandler:function(t){this.isDown=!1,this.inputHandler('up',this.lastMove)},downHandler:function(t){this.isDown=!0,this.lastMove=t,this.inputHandler('down',t)},clickHandler:function(t){this.inputHandler('click',t)},getCoords:function(t){var e=null;return'undefined'!=typeof TouchEvent&&t instanceof TouchEvent?(E=!0,t.touches.length>0?e={x:t.touches[0].clientX,y:t.touches[0].clientY}:t.clientX&&t.clientY&&(e={x:t.clientX,y:t.clientY})):e={x:t.clientX,y:t.clientY},E&&t instanceof MouseEvent||null===e?null:e={x:e.x-this.bounds.x,y:e.y-this.bounds.y}},updateBounds:function(){var t=this.bounds,e=this.domElement.getBoundingClientRect();t.x=e.left,t.y=e.top,t.width=e.width,t.height=e.height},destroy:function(){var t=this.domElement;t.removeEventListener('touchstart',this.downHandler),t.removeEventListener('touchmove',this.moveHandler),t.removeEventListener('touchend',this.upHandler),t.removeEventListener('touchcancel',this.upHandler),t.removeEventListener('mousedown',this.downHandler),t.removeEventListener('mousemove',this.moveHandler),t.removeEventListener('mouseup',this.upHandler)}},B.checkBounds=function(t,e,i){if(t.worldVisible&&t.getBounds().contains(e,i))return!0},B.systems=[],g('input',B);var A=function(){},P=function(t,e,i,s,r,n,h,o,a){this.game=i,this.cb=s||A,this.ctx=r||this,this.delay=null==n?1e3:n,this.loop=h,this.count=o||0,this.repeat=this.count>0,this.running=!!t,this._lastFrame=0,this.autoRemove=e,this.onComplete=a||A};P.prototype={start:function(){this.running=!0},pause:function(){this.running=!1},stop:function(){this.running=!1,this._lastFrame=0},update:function(t){this.running&&(this._lastFrame+=t,this._lastFrame>=this.delay&&(this.cb.call(this.ctx),this._lastFrame=0,this.repeat?(this.count--,0===this.count&&(this.running=!1,this.autoRemove&&this.game.timer.remove(this),this.onComplete())):this.loop||(this.running=!1,this.autoRemove&&this.game.timer.remove(this))))}};var I=function(t){this.game=t,this.list=[],this.autoStart=!0,this.autoRemove=!0};I.prototype={update:function(t){for(var e=0;e<this.list.length;e++)this.list[e].update(t)},removeAll:function(){for(var t=0;t<this.list.length;t++)this.list[t].stop();this.list=[]},remove:function(t){var e=this.list.indexOf(t);e>-1&&(t.stop(),this.list.splice(e,1))},add:function(t,e,i,s,r){s=null!=s?s:this.autoStart,r=null!=r?r:this.autoRemove;var n=new P(s,r,this.game,e,i,t);return this.list.push(n),n},loop:function(t,e,i,s,r){s=null!=s?s:this.autoStart,r=null!=r?r:this.autoRemove;var n=new P(s,r,this.game,e,i,t,!0);return this.list.push(n),n},repeat:function(t,e,i,s,r,n,h){r=null!=r?r:this.autoStart,n=null!=n?n:this.autoRemove;var o=new P(r,n,this.game,i,s,t,!1,e,h);return this.list.push(o),o},destroy:function(){this.removeAll()}},g('timer',I);var O=function(){this._tweens={},this._tweensAddedDuringUpdate={}};O.prototype={getAll:function(){return Object.keys(this._tweens).map(function(t){return this._tweens[t]}.bind(this))},removeAll:function(){this._tweens={}},add:function(t){var e=t.getId();this._tweens[e]=t,this._tweensAddedDuringUpdate[e]=t},remove:function(t){var e=t.getId();delete this._tweens[e],delete this._tweensAddedDuringUpdate[e]},update:function(t,e){var i=Object.keys(this._tweens);if(0===i.length)return!1;for(;i.length>0;){this._tweensAddedDuringUpdate={};for(var s=0;s<i.length;s++){var r=this._tweens[i[s]];r&&!1===r.update(t)&&(r._isPlaying=!1,e||delete this._tweens[i[s]])}i=Object.keys(this._tweensAddedDuringUpdate)}return!0}};var F=new O;F.Group=O,F._nextId=0,F.nextId=function(){return F._nextId++};var L=function(t,e){this._isPaused=!1,this._object=t,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._repeatDelayTime=void 0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._time=0,this._easingFunction=U.Linear.None,this._interpolationFunction=j.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onRepeatCallback=null,this._onCompleteCallback=null,this._onStopCallback=null,this._group=e||F,this._id=F.nextId()};L.prototype={getId:function(){return this._id},isPlaying:function(){return this._isPlaying},isPaused:function(){return this._isPaused},to:function(t,e){return this._valuesEnd=Object.create(t),void 0!==e&&(this._duration=e),this},duration:function(t){return this._duration=t,this},start:function(t){for(var e in this._group.add(this),this._isPlaying=!0,this._isPaused=!1,this._time=0,this._onStartCallbackFired=!1,this._startTime=this._delayTime,this._valuesEnd){if(this._valuesEnd[e]instanceof Array){if(0===this._valuesEnd[e].length)continue;this._valuesEnd[e]=[this._object[e]].concat(this._valuesEnd[e])}void 0!==this._object[e]&&(1!=t&&void 0!==this._valuesStart[e]||(this._valuesStart[e]=this._object[e]),this._valuesStart[e]instanceof Array==!1&&(this._valuesStart[e]*=1),this._valuesStartRepeat[e]=this._valuesStart[e]||0)}return this},stop:function(){return this._isPlaying?(this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,null!==this._onStopCallback&&this._onStopCallback(this._object),this.stopChainedTweens(),this):this},end:function(){return this.update(1/0),this},pause:function(){return this._isPaused||!this._isPlaying||(this._isPaused=!0,this._group.remove(this)),this},resume:function(){return this._isPaused&&this._isPlaying?(this._isPaused=!1,this._group.add(this),this):this},stopChainedTweens:function(){for(var t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].stop()},group:function(t){return this._group=t,this},delay:function(t){return this._delayTime=t,this},repeat:function(t){return this._repeat=t,this},repeatDelay:function(t){return this._repeatDelayTime=t,this},yoyo:function(t){return this._yoyo=t,this},easing:function(t){return this._easingFunction=t,this},interpolation:function(t){return this._interpolationFunction=t,this},chain:function(){return this._chainedTweens=arguments,this},onStart:function(t){return this._onStartCallback=t,this},onUpdate:function(t){return this._onUpdateCallback=t,this},onRepeat:function(t){return this._onRepeatCallback=t,this},onComplete:function(t){return this._onCompleteCallback=t,this},onStop:function(t){return this._onStopCallback=t,this},update:function(t){var e,i,s;if(this._time+=t,this._time<this._startTime)return!0;for(e in!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),i=(this._time-this._startTime)/this._duration,i=0===this._duration||i>1?1:i,s=this._easingFunction(i),this._valuesEnd)if(void 0!==this._valuesStart[e]){var r=this._valuesStart[e]||0,n=this._valuesEnd[e];n instanceof Array?this._object[e]=this._interpolationFunction(n,s):('string'==typeof n&&(n='+'===n.charAt(0)||'-'===n.charAt(0)?r+parseFloat(n):parseFloat(n)),'number'==typeof n&&(this._object[e]=r+(n-r)*s))}if(null!==this._onUpdateCallback&&this._onUpdateCallback(this._object,i),1===i){if(this._time=0,this._repeat>0){for(e in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat){if('string'==typeof this._valuesEnd[e]&&(this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(this._valuesEnd[e])),this._yoyo){var h=this._valuesStartRepeat[e];this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=h}this._valuesStart[e]=this._valuesStartRepeat[e]}return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=this._repeatDelayTime:this._startTime=this._delayTime,null!==this._onRepeatCallback&&this._onRepeatCallback(this._object),!0}null!==this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var o=0,a=this._chainedTweens.length;o<a;o++)this._chainedTweens[o].start();return!1}return!0}};var D,U={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-U.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*U.Bounce.In(2*t):.5*U.Bounce.Out(2*t-1)+.5}}},j={Linear:function(t,e){var i=t.length-1,s=i*e,r=Math.floor(s),n=j.Utils.Linear;return e<0?n(t[0],t[1],s):e>1?n(t[i],t[i-1],i-s):n(t[r],t[r+1>i?i:r+1],s-r)},Bezier:function(t,e){for(var i=0,s=t.length-1,r=Math.pow,n=j.Utils.Bernstein,h=0;h<=s;h++)i+=r(1-e,s-h)*r(e,h)*t[h]*n(s,h);return i},CatmullRom:function(t,e){var i=t.length-1,s=i*e,r=Math.floor(s),n=j.Utils.CatmullRom;return t[0]===t[i]?(e<0&&(r=Math.floor(s=i*(1+e))),n(t[(r-1+i)%i],t[r],t[(r+1)%i],t[(r+2)%i],s-r)):e<0?t[0]-(n(t[0],t[0],t[1],t[1],-s)-t[0]):e>1?t[i]-(n(t[i],t[i],t[i-1],t[i-1],s-i)-t[i]):n(t[r?r-1:0],t[r],t[i<r+1?i:r+1],t[i<r+2?i:r+2],s-r)},Utils:{Linear:function(t,e,i){return(e-t)*i+t},Bernstein:function(t,e){var i=j.Utils.Factorial;return i(t)/i(e)/i(t-e)},Factorial:(D=[1],function(t){var e=1;if(D[t])return D[t];for(var i=t;i>1;i--)e*=i;return D[t]=e,e}),CatmullRom:function(t,e,i,s,r){var n=.5*(i-t),h=.5*(s-e),o=r*r;return(2*e-2*i+n+h)*(r*o)+(-3*e+3*i-2*n-h)*o+n*r+e}}},N=function(t){this.game=t,this.bufferList=[],this.group=new O};N.prototype={remove:function(t){this.group.remove(t)},add:function(t){return new L(t,this.group)},pause:function(){for(var t in this.bufferList.length=0,this.group._tweens)this.bufferList.push(this.group._tweens[t]),this.group._tweens[t].pause()},resume(){for(var t=0;t<this.bufferList.length;t++)this.bufferList[t].resume();this.bufferList.length=0},update:function(t){this.group.update(t)},destroy:function(){this.bufferList.length=0,this.group.removeAll(),this.group=null}},g('tweens',N),Tiny.App=b,Tiny.RAF=S,Tiny.registerSystem=g,Tiny.systems=y,Tiny.TweenManager=N,Tiny.Cache=R,Tiny.Loader=k,Tiny.Easing=U,Tiny.Interpolation=j,Tiny.Input=B,Tiny.Timer=P;var H=function(t,e,i,s){this.x=t||0,this.y=e||0,this.width=i||0,this.height=s||0,this.type=f.RECT};H.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;var i=this.x;if(t>=i&&t<=i+this.width){var s=this.y;if(e>=s&&e<=s+this.height)return!0}return!1},H.prototype.constructor=H;var G=new H(0,0,0,0),W=2*Math.PI,z=function(){this.position=new l(0,0),this.scale=new l(1,1),this.pivot=new l(0,0),this.rotation=0,this.alpha=1,this.visible=!0,this.renderable=!1,this.parent=null,this.worldAlpha=1,this.worldTransform=new u,this._sr=0,this._cr=1,this._cacheAsBitmap=!1};z.prototype.constructor=z,z.prototype.destroy=function(){this.parent&&this.parent.remove(this),this.parent=null,this.worldTransform=null,this.visible=!1,this.renderable=!1,this._destroyCachedSprite()},Object.defineProperty(z.prototype,'worldVisible',{get:function(){var t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}}),Object.defineProperty(z.prototype,'cacheAsBitmap',{get:function(){return this._cacheAsBitmap},set:function(t){this._cacheAsBitmap!==t&&(t?this._generateCachedSprite():this._destroyCachedSprite(),this._cacheAsBitmap=t)}}),z.prototype.updateTransform=function(){if(this.parent){var t,e,i,s,r,n,h=this.parent.worldTransform,o=this.worldTransform;this.rotation%W?(this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),t=this._cr*this.scale.x,e=this._sr*this.scale.x,i=-this._sr*this.scale.y,s=this._cr*this.scale.y,r=this.position.x,n=this.position.y,(this.pivot.x||this.pivot.y)&&(r-=this.pivot.x*t+this.pivot.y*i,n-=this.pivot.x*e+this.pivot.y*s),o.a=t*h.a+e*h.c,o.b=t*h.b+e*h.d,o.c=i*h.a+s*h.c,o.d=i*h.b+s*h.d,o.tx=r*h.a+n*h.c+h.tx,o.ty=r*h.b+n*h.d+h.ty):(t=this.scale.x,s=this.scale.y,r=this.position.x-this.pivot.x*t,n=this.position.y-this.pivot.y*s,o.a=t*h.a,o.b=t*h.b,o.c=s*h.c,o.d=s*h.d,o.tx=r*h.a+n*h.c+h.tx,o.ty=r*h.b+n*h.d+h.ty),this.worldAlpha=this.alpha*this.parent.worldAlpha}},z.prototype.displayObjectUpdateTransform=z.prototype.updateTransform,z.prototype.getBounds=function(t){return G},z.prototype.getLocalBounds=function(){return this.getBounds(c)},z.prototype.generateTexture=function(t,e){var i=this.getLocalBounds(),s=new Tiny.RenderTexture(0|i.width,0|i.height,e,t);return z._tempMatrix.tx=-i.x,z._tempMatrix.ty=-i.y,s.render(this,z._tempMatrix),s},z.prototype.updateCache=function(){this._generateCachedSprite()},z.prototype.toGlobal=function(t){return this.displayObjectUpdateTransform(),this.worldTransform.apply(t)},z.prototype.toLocal=function(t,e){return e&&(t=e.toGlobal(t)),this.displayObjectUpdateTransform(),this.worldTransform.applyInverse(t)},z.prototype._renderCachedSprite=function(t){this._cachedSprite.worldAlpha=this.worldAlpha,t.gl?Tiny.Sprite.prototype.render.call(this._cachedSprite,t):Tiny.Sprite.prototype.renderCanvas.call(this._cachedSprite,t)},z.prototype._generateCachedSprite=function(){this._cachedSprite=null,this._cacheAsBitmap=!1;var t=this.getLocalBounds(),e=new Tiny.RenderTexture(0|t.width,0|t.height);this._cachedSprite=new Tiny.Sprite(e),this._cachedSprite.worldTransform=this.worldTransform;var i=this._filters;this._filters=null,this._cachedSprite.filters=i,z._tempMatrix.tx=-t.x,z._tempMatrix.ty=-t.y,this._cachedSprite.texture.render(this,z._tempMatrix,!0),this._cachedSprite.anchor.x=-t.x/t.width,this._cachedSprite.anchor.y=-t.y/t.height,this._cacheAsBitmap=!0},z.prototype._destroyCachedSprite=function(){this._cachedSprite&&(this._cachedSprite.texture.destroy(!0),this._cachedSprite=null)},z.prototype.render=function(t){},Object.defineProperty(z.prototype,'x',{get:function(){return this.position.x},set:function(t){this.position.x=t}}),Object.defineProperty(z.prototype,'y',{get:function(){return this.position.y},set:function(t){this.position.y=t}}),z._tempMatrix=new u;var q=function(){z.call(this),this.children=[],this._bounds=new H(0,0,1,1),this._currentBounds=null,this._mask=null};(q.prototype=Object.create(z.prototype)).constructor=q,Object.defineProperty(q.prototype,'width',{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(t){var e=this.getLocalBounds().width;this.scale.x=0!==e?t/e:1,this._width=t}}),Object.defineProperty(q.prototype,'height',{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(t){var e=this.getLocalBounds().height;this.scale.y=0!==e?t/e:1,this._height=t}}),Object.defineProperty(q.prototype,'mask',{get:function(){return this._mask},set:function(t){this._mask&&(this._mask.isMask=!1),this._mask=t,this._mask&&(this._mask.isMask=!0)}}),q.prototype.destroy=function(){for(var t=this.children.length;t--;)this.children[t].destroy();this.children=[],z.prototype.destroy.call(this),this._bounds=null,this._currentBounds=null,this._mask=null,this.input&&this.input.system.remove(this)},q.prototype.add=function(t){return this.addChildAt(t,this.children.length)},q.prototype.addChildAt=function(t,e){if(e>=0&&e<=this.children.length)return t.parent&&t.parent.remove(t),t.parent=this,this.game&&(t.game=this.game),this.children.splice(e,0,t),t;throw new Error(t+'addChildAt: The index '+e+' supplied is out of bounds '+this.children.length)},q.prototype.swapChildren=function(t,e){if(t!==e){var i=this.getChildIndex(t),s=this.getChildIndex(e);if(i<0||s<0)throw new Error('swapChildren: Both the supplied Objects must be a child of the caller.');this.children[i]=e,this.children[s]=t}},q.prototype.getChildIndex=function(t){var e=this.children.indexOf(t);if(-1===e)throw new Error('The supplied Object must be a child of the caller');return e},q.prototype.setChildIndex=function(t,e){if(e<0||e>=this.children.length)throw new Error('The supplied index is out of bounds');var i=this.getChildIndex(t);this.children.splice(i,1),this.children.splice(e,0,t)},q.prototype.getChildAt=function(t){if(t<0||t>=this.children.length)throw new Error('getChildAt: Supplied index '+t+' does not exist in the child list, or the supplied Object must be a child of the caller');return this.children[t]},q.prototype.remove=function(t){var e=this.children.indexOf(t);if(-1!==e)return this.removeChildAt(e)},q.prototype.removeChildAt=function(t){var e=this.getChildAt(t);return e.parent=void 0,this.children.splice(t,1),e},q.prototype.updateTransform=function(){if(this.visible&&(this.displayObjectUpdateTransform(),!this._cacheAsBitmap))for(var t=0,e=this.children.length;t<e;t++)this.children[t].updateTransform()},q.prototype.displayObjectContainerUpdateTransform=q.prototype.updateTransform,q.prototype.getBounds=function(){if(0===this.children.length)return G;if(this._cachedSprite)return this._cachedSprite.getBounds();for(var t,e,i,s=1/0,r=1/0,n=-1/0,h=-1/0,o=!1,a=0,l=this.children.length;a<l;a++){this.children[a].visible&&(o=!0,s=s<(t=this.children[a].getBounds()).x?s:t.x,r=r<t.y?r:t.y,n=n>(e=t.width+t.x)?n:e,h=h>(i=t.height+t.y)?h:i)}if(!o)return G;var u=this._bounds;return u.x=s,u.y=r,u.width=n-s,u.height=h-r,u},q.prototype.getLocalBounds=function(){var t=this.worldTransform;this.worldTransform=c;for(var e=0,i=this.children.length;e<i;e++)this.children[e].updateTransform();var s=this.getBounds();return this.worldTransform=t,s},q.prototype.render=function(t){var e,i;if(this.visible&&!(this.alpha<=0))if(this._cacheAsBitmap)this._renderCachedSprite(t);else if(this._mask||this._filters){for(this._filters&&(t.spriteBatch.flush(),t.filterManager.pushFilter(this._filterBlock)),this._mask&&(t.spriteBatch.stop(),t.maskManager.pushMask(this.mask,t),t.spriteBatch.start()),e=0,i=this.children.length;e<i;e++)this.children[e].render(t);t.spriteBatch.stop(),this._mask&&t.maskManager.popMask(this._mask,t),this._filters&&t.filterManager.popFilter(),t.spriteBatch.start()}else for(e=0,i=this.children.length;e<i;e++)this.children[e].render(t)};var X=function(t){q.call(this),this.worldTransform=new u,this.game=t};(X.prototype=Object.create(q.prototype)).constructor=X,X.prototype.updateTransform=function(){this.worldAlpha=1;for(var t=0,e=this.children.length;t<e;t++)this.children[t].updateTransform()};var Y=function(){this.x0=0,this.y0=0,this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.x3=0,this.y3=0};Tiny.TextureCacheIdGenerator=0;var V=function(t,e,i,s){if(this.noFrame=!1,e||(this.noFrame=!0,e=new H(0,0,1,1)),'string'==typeof t){var r=t;if(!(t=R.image[r]))throw new Error('Cache Error: image '+r+' does`t found in cache');R.texture[r]=this,this.key=r}else t instanceof V?t=t.base:t instanceof M||(t=new M(t));this.base=t,this.frame=e,this.trim=s,this.valid=!1,this._uvs=null,this.width=0,this.height=0,this.crop=i||new H(0,0,1,1),t.loaded?this.onBaseLoaded():t.onload=this.onBaseLoaded.bind(this)};V.prototype.constructor=V,V.prototype.onBaseLoaded=function(){var t=this.base;this.noFrame&&(this.frame=new H(0,0,t.width,t.height)),this.setFrame(this.frame)},V.prototype.addToCache=function(t,e){this.key=this.key||t,this.frame.name=this.frame.name||e,this.frame.name&&(t+='.'+this.frame.name),R.texture[t]=this},V.prototype.destroy=function(t){t&&this.base.destroy(),this.key&&delete R.texture[this.key],this.valid=!1},V.prototype.setFrame=function(t){this.noFrame=!1,this.frame=t,this.width=t.width,this.height=t.height,this.crop.x=t.x,this.crop.y=t.y,this.crop.width=t.width,this.crop.height=t.height,this.trim||!(t.x+t.width>this.base.width||t.y+t.height>this.base.height)?(this.valid=t&&t.width&&t.height&&this.base.source&&this.base.loaded,this.trim&&(this.width=this.trim.width,this.height=this.trim.height,this.frame.width=this.trim.width,this.frame.height=this.trim.height),this.valid&&this._updateUvs()):this.valid=!1},V.prototype._updateUvs=function(){this._uvs||(this._uvs=new Y);var t=this.crop,e=this.base.width,i=this.base.height;this._uvs.x0=t.x/e,this._uvs.y0=t.y/i,this._uvs.x1=(t.x+t.width)/e,this._uvs.y1=t.y/i,this._uvs.x2=(t.x+t.width)/e,this._uvs.y2=(t.y+t.height)/i,this._uvs.x3=t.x/e,this._uvs.y3=(t.y+t.height)/i};var J=function(t,e){q.call(this),this.anchor=new l,this.setTexture(t,e,!1),this._width=0,this._height=0,this.tint=new a,this.blendMode=d.NORMAL,this.texture.loaded&&this.onTextureUpdate(),this.renderable=!0};(J.prototype=Object.create(q.prototype)).constructor=J,Object.defineProperty(J.prototype,'frameName',{get:function(){return this.texture.frame.name},set:function(t){this.texture.frame.name&&this.setTexture(R.texture[this.texture.key+'.'+t])}}),Object.defineProperty(J.prototype,'width',{get:function(){return this.scale.x*this.texture.frame.width},set:function(t){this.scale.x=t/this.texture.frame.width,this._width=t}}),Object.defineProperty(J.prototype,'height',{get:function(){return this.scale.y*this.texture.frame.height},set:function(t){this.scale.y=t/this.texture.frame.height,this._height=t}}),J.prototype.setTexture=function(t,e,i){if('string'==typeof t){var s=t;null!=e&&(s=s+'.'+e),(t=R.texture[s])||(t=new V(s))}return this.texture!==t&&(this.texture=t,this.cachedTint='#ffffff',!0===i&&this.onTextureUpdate(),!0)},J.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width),this._height&&(this.scale.y=this._height/this.texture.frame.height)},J.prototype.getBounds=function(t){var e=this.texture.frame.width/this.texture.base.resolution,i=this.texture.frame.height/this.texture.base.resolution,s=e*(1-this.anchor.x),r=e*-this.anchor.x,n=i*(1-this.anchor.y),h=i*-this.anchor.y,o=t||this.worldTransform,a=o.a,l=o.b,u=o.c,c=o.d,d=o.tx,p=o.ty,f=-1/0,y=-1/0,g=1/0,m=1/0;if(0===l&&0===u)a<0?(g=a*s+d,f=a*r+d):(g=a*r+d,f=a*s+d),c<0?(m=c*n+p,y=c*h+p):(m=c*h+p,y=c*n+p);else{var v=a*r+u*h+d,w=c*h+l*r+p,x=a*s+u*h+d,_=c*h+l*s+p,T=a*s+u*n+d,b=c*n+l*s+p,C=a*r+u*n+d,S=c*n+l*r+p;g=C<(g=T<(g=x<(g=v<g?v:g)?x:g)?T:g)?C:g,m=S<(m=b<(m=_<(m=w<m?w:m)?_:m)?b:m)?S:m,f=C>(f=T>(f=x>(f=v>f?v:f)?x:f)?T:f)?C:f,y=S>(y=b>(y=_>(y=w>y?w:y)?_:y)?b:y)?S:y}var M=this._bounds;return M.x=g,M.width=f-g,M.y=m,M.height=y-m,this._currentBounds=M,M},J.prototype.render=function(t){var e,i;if(this.visible&&!(this.alpha<=0))if(this._mask||this._filters){var s=t.spriteBatch;for(this._filters&&(s.flush(),t.filterManager.pushFilter(this._filterBlock)),this._mask&&(s.stop(),t.maskManager.pushMask(this.mask,t),s.start()),s.render(this),e=0,i=this.children.length;e<i;e++)this.children[e].render(t);s.stop(),this._mask&&t.maskManager.popMask(this._mask,t),this._filters&&t.filterManager.popFilter(),s.start()}else for(t.spriteBatch.render(this),e=0,i=this.children.length;e<i;e++)this.children[e].render(t)};var Q=function(t,e){this.canvas=document.createElement('canvas'),this.context=this.canvas.getContext('2d'),this.resolution=1,J.call(this,new V(this.canvas)),this.setText(t),this.setStyle(e)};(Q.prototype=Object.create(J.prototype)).constructor=Q,Object.defineProperty(Q.prototype,'width',{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.x*this.texture.frame.width},set:function(t){this.scale.x=t/this.texture.frame.width,this._width=t}}),Object.defineProperty(Q.prototype,'height',{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.y*this.texture.frame.height},set:function(t){this.scale.y=t/this.texture.frame.height,this._height=t}}),Q.prototype.setStyle=function(t){(t=t||{}).font=t.font||'bold 20pt Arial',t.fill=t.fill||'black',t.align=t.align||'left',t.stroke=t.stroke||'black',t.strokeThickness=t.strokeThickness||0,t.wordWrap=t.wordWrap||!1,t.lineSpacing=t.lineSpacing||0,t.wordWrapWidth=void 0!==t.wordWrapWidth?t.wordWrapWidth:100,t.dropShadow=t.dropShadow||!1,t.dropShadowAngle=void 0!==t.dropShadowAngle?t.dropShadowAngle:Math.PI/6,t.dropShadowDistance=void 0!==t.dropShadowDistance?t.dropShadowDistance:4,t.dropShadowColor=t.dropShadowColor||'black',this.style=t,this.dirty=!0},Q.prototype.setText=function(t){this.text=t.toString()||' ',this.dirty=!0},Q.prototype.updateText=function(){this.texture.base.resolution=this.resolution,this.context.font=this.style.font;var t=this.text;this.style.wordWrap&&(t=this.wordWrap(this.text));for(var e=t.split(/(?:\r\n|\r|\n)/),i=[],s=0,r=this.determineFontProperties(this.style.font),n=0;n<e.length;n++){var h=this.context.measureText(e[n]).width;i[n]=h,s=Math.max(s,h)}var o=s+this.style.strokeThickness;this.style.dropShadow&&(o+=this.style.dropShadowDistance),this.canvas.width=(o+this.context.lineWidth)*this.resolution;var a,l,u=r.fontSize+this.style.strokeThickness+this.style.lineSpacing,c=u*e.length;if(this.style.dropShadow&&(c+=this.style.dropShadowDistance),this.canvas.height=(c-this.style.lineSpacing)*this.resolution,this.context.scale(this.resolution,this.resolution),navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.lineWidth=this.style.strokeThickness,this.context.textBaseline='alphabetic',this.context.miterLimit=2,this.style.dropShadow){this.context.fillStyle=this.style.dropShadowColor;var d=Math.sin(this.style.dropShadowAngle)*this.style.dropShadowDistance,p=Math.cos(this.style.dropShadowAngle)*this.style.dropShadowDistance;for(n=0;n<e.length;n++)a=this.style.strokeThickness/2,l=this.style.strokeThickness/2+n*u+r.ascent,'right'===this.style.align?a+=s-i[n]:'center'===this.style.align&&(a+=(s-i[n])/2),this.style.fill&&this.context.fillText(e[n],a+d,l+p)}for(this.context.fillStyle=this.style.fill,n=0;n<e.length;n++)a=this.style.strokeThickness/2,l=this.style.strokeThickness/2+n*u+r.ascent,'right'===this.style.align?a+=s-i[n]:'center'===this.style.align&&(a+=(s-i[n])/2),this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(e[n],a,l),this.style.fill&&this.context.fillText(e[n],a,l);this.updateTexture()},Q.prototype.updateTexture=function(){this.texture.width=this.canvas.width,this.texture.height=this.canvas.height,this.texture.crop.width=this.texture.frame.width=this.canvas.width,this.texture.crop.height=this.texture.frame.height=this.canvas.height,this._width=this.canvas.width,this._height=this.canvas.height,this.texture.base.dirty()},Q.prototype.render=function(t){(this.dirty||this.resolution!==t.resolution)&&(this.resolution=t.resolution,this.updateText(),this.dirty=!1),J.prototype.render.call(this,t)},Q.prototype.determineFontProperties=function(t){var e=Q.fontPropertiesCache[t];if(!e){e={};var i=Q.fontPropertiesCanvas,s=Q.fontPropertiesContext;s.font=t;var r=Math.ceil(s.measureText('|MÉq').width),n=Math.ceil(s.measureText('|MÉq').width),h=2*n;n=1.4*n|0,i.width=r,i.height=h,s.fillStyle='#f00',s.fillRect(0,0,r,h),s.font=t,s.textBaseline='alphabetic',s.fillStyle='#000',s.fillText('|MÉq',0,n);var o,a,l=s.getImageData(0,0,r,h).data,u=l.length,c=4*r,d=0,p=!1;for(o=0;o<n;o++){for(a=0;a<c;a+=4)if(255!==l[d+a]){p=!0;break}if(p)break;d+=c}for(e.ascent=n-o,d=u-c,p=!1,o=h;o>n;o--){for(a=0;a<c;a+=4)if(255!==l[d+a]){p=!0;break}if(p)break;d-=c}e.descent=o-n,e.descent+=6,e.fontSize=e.ascent+e.descent,Q.fontPropertiesCache[t]=e}return e},Q.prototype.wordWrap=function(t){for(var e='',i=t.split('\n'),s=0;s<i.length;s++){for(var r=this.style.wordWrapWidth,n=i[s].split(' '),h=0;h<n.length;h++){var o=this.context.measureText(n[h]).width,a=o+this.context.measureText(' ').width;0===h||a>r?(h>0&&(e+='\n'),e+=n[h],r=this.style.wordWrapWidth-o):(r-=a,e+=' '+n[h])}s<i.length-1&&(e+='\n')}return e},Q.prototype.getBounds=function(t){return this.dirty&&(this.updateText(),this.dirty=!1),J.prototype.getBounds.call(this,t)},Q.prototype.destroy=function(){this.context=null,this.canvas=null,this.texture.destroy(),J.prototype.destroy.call(this)},Q.fontPropertiesCache={},Q.fontPropertiesCanvas=document.createElement('canvas'),Q.fontPropertiesContext=Q.fontPropertiesCanvas.getContext('2d');var K=function(t,e,i){this.x=t||0,this.y=e||0,this.radius=i||0,this.type=f.CIRC};(K.prototype={contains:function(t,e){if(this.radius<=0)return!1;var i=this.x-t,s=this.y-e;return(i*=i)+(s*=s)<=this.radius*this.radius},getBounds:function(){return new PIXI.Rectangle(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)}}).constructor=K;var Z=function(t){if(t instanceof Array||(t=Array.prototype.slice.call(arguments)),'number'!=typeof t[0]){for(var e=[],i=0,s=t.length;i<s;i++)e.push(t[i].x,t[i].y);t=e}this.closed=!0,this.points=t,this.type=f.POLY};(Z.prototype={toNumberArray:function(t){void 0===t&&(t=[]);for(var e=0;e<this.points.length;e++)'number'==typeof this.points[e]?(t.push(this.points[e]),t.push(this.points[e+1]),e++):(t.push(this.points[e].x),t.push(this.points[e].y));return t},flatten:function(){return this.points=this.toNumberArray(),this},contains:function(t,e){for(var i=!1,s=this.points.length/2,r=0,n=s-1;r<s;n=r++){var h=this.points[2*r],o=this.points[2*r+1],a=this.points[2*n],l=this.points[2*n+1];o>e!=l>e&&t<(a-h)*(e-o)/(l-o)+h&&(i=!i)}return i}}).constructor=Z;var $=function(t,e,i,s,r){this.x=t||0,this.y=e||0,this.width=i||0,this.height=s||0,this.radius=r||0,this.type=f.RREC};$.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;var i=this.x;if(t>=i&&t<=i+this.width){var s=this.y;if(e>=s&&e<=s+this.height)return!0}return!1},$.prototype.constructor=$;var tt=function(t,e,i,s,r){this.lineWidth=t,this.lineColor=e,this._lineTint=e,this.fillColor=i,this._fillTint=i,this.fill=s,this.shape=r,this.type=r.type};tt.prototype.constructor=tt;var et=function(){q.call(this),this.renderable=!0,this.lineWidth=0,this.lineColor=new a,this.graphicsData=[],this.tint=new a,this.blendMode=d.NORMAL,this.currentPath=null,this._webGL=[],this.isMask=!1,this.boundsPadding=0,this._localBounds=new H(0,0,1,1),this.dirty=!0,this.webGLDirty=!1,this.cachedSpriteDirty=!1};(et.prototype=Object.create(q.prototype)).constructor=et,Object.defineProperty(et.prototype,'cacheAsBitmap',{get:function(){return this._cacheAsBitmap},set:function(t){this._cacheAsBitmap=t,this._cacheAsBitmap?this._generateCachedSprite():(this.destroyCachedSprite(),this.dirty=!0)}}),Object.assign(et.prototype,{lineStyle:function(t,e,i){if(this.lineWidth=t||0,this.lineColor=new a(e||0),void 0!==i&&(this.lineColor.a=i),this.currentPath){if(this.currentPath.shape.points.length)return this.drawShape(new Z(this.currentPath.shape.points.slice(-2))),this;this.currentPath.lineWidth=this.lineWidth,this.currentPath.lineColor=this.lineColor}return this},moveTo:function(t,e){return this.drawShape(new Z([t,e])),this},lineTo:function(t,e){return this.currentPath||this.moveTo(0,0),this.currentPath.shape.points.push(t,e),this.dirty=!0,this},quadraticCurveTo:function(t,e,i,s){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var r,n,h=this.currentPath.shape.points;0===h.length&&this.moveTo(0,0);for(var o=h[h.length-2],a=h[h.length-1],l=0,u=1;u<=20;u++)r=o+(t-o)*(l=u/20),n=a+(e-a)*l,h.push(r+(t+(i-t)*l-r)*l,n+(e+(s-e)*l-n)*l);return this.dirty=!0,this},bezierCurveTo:function(t,e,i,s,r,n){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);for(var h,o,a,l,u,c=this.currentPath.shape.points,d=c[c.length-2],p=c[c.length-1],f=0,y=1;y<=20;y++)a=(o=(h=1-(f=y/20))*h)*h,u=(l=f*f)*f,c.push(a*d+3*o*f*t+3*h*l*i+u*r,a*p+3*o*f*e+3*h*l*s+u*n);return this.dirty=!0,this},arcTo:function(t,e,i,s,r){this.currentPath?0===this.currentPath.shape.points.length&&this.currentPath.shape.points.push(t,e):this.moveTo(t,e);var n=this.currentPath.shape.points,h=n[n.length-2],o=n[n.length-1]-e,a=h-t,l=s-e,u=i-t,c=Math.abs(o*u-a*l);if(c<1e-8||0===r)n[n.length-2]===t&&n[n.length-1]===e||n.push(t,e);else{var d=o*o+a*a,p=l*l+u*u,f=o*l+a*u,y=r*Math.sqrt(d)/c,g=r*Math.sqrt(p)/c,m=y*f/d,v=g*f/p,w=y*u+g*a,x=y*l+g*o,_=a*(g+m),T=o*(g+m),b=u*(y+v),C=l*(y+v),S=Math.atan2(T-x,_-w),M=Math.atan2(C-x,b-w);this.arc(w+t,x+e,r,S,M,a*l>u*o)}return this.dirty=!0,this},arc:function(t,e,i,s,r,n){if(s===r)return this;!(n=n||!1)&&r<=s?r+=2*Math.PI:n&&s<=r&&(s+=2*Math.PI);var h=n?-1*(s-r):r-s,o=Math.abs(h)/(2*Math.PI)*40;if(0===h)return this;var a=t+Math.cos(s)*i,l=e+Math.sin(s)*i;n&&this.filling?this.moveTo(t,e):this.moveTo(a,l);for(var u=this.currentPath.shape.points,c=h/(2*o),d=2*c,p=Math.cos(c),f=Math.sin(c),y=o-1,g=y%1/y,m=0;m<=y;m++){var v=c+s+d*(m+g*m),w=Math.cos(v),x=-Math.sin(v);u.push((p*w+f*x)*i+t,(p*-x+f*w)*i+e)}return this.dirty=!0,this},beginFill:function(t,e){return this.filling=!0,this.fillColor=new a(t||0),void 0!==e&&(this.fillColor.a=e),this.currentPath&&this.currentPath.shape.points.length<=2&&(this.currentPath.fill=this.filling,this.currentPath.fillColor=this.fillColor),this},endFill:function(){return this.filling=!1,this.fillColor=null,this},drawRect:function(t,e,i,s){return this.drawShape(new H(t,e,i,s)),this},drawRoundedRect:function(t,e,i,s,r){return this.drawShape(new $(t,e,i,s,r)),this},drawCircle:function(t,e,i){return this.drawShape(new K(t,e,i)),this},drawPolygon:function(t){return t instanceof Array||(t=Array.prototype.slice.call(arguments)),this.drawShape(new Z(t)),this},clear:function(){return this.lineWidth=0,this.filling=!1,this.dirty=!0,this.clearDirty=!0,this.graphicsData=[],this},render:function(t){if(!1!==this.visible&&0!==this.alpha&&!0!==this.isMask){if(this._cacheAsBitmap)return(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1),this._cachedSprite.worldAlpha=this.worldAlpha,void J.prototype.render.call(this._cachedSprite,t);if(t.spriteBatch.stop(),t.blendModeManager.setBlendMode(this.blendMode),this._mask&&t.maskManager.pushMask(this._mask,t),this._filters&&t.filterManager.pushFilter(this._filterBlock),this.blendMode!==t.spriteBatch.currentBlendMode){t.spriteBatch.currentBlendMode=this.blendMode;var e=t.blendModes[t.spriteBatch.currentBlendMode];t.spriteBatch.gl.blendFunc(e[0],e[1])}if(this.webGLDirty&&(this.dirty=!0,this.webGLDirty=!1),Tiny.WebGLGraphics.renderGraphics(this,t),this.children.length){t.spriteBatch.start();for(var i=0,s=this.children.length;i<s;i++)this.children[i].render(t);t.spriteBatch.stop()}this._filters&&t.filterManager.popFilter(),this._mask&&t.maskManager.popMask(this.mask,t),t.drawCount++,t.spriteBatch.start()}},getBounds:function(t){if(this.isMask)return G;this.dirty&&(this.updateLocalBounds(),this.webGLDirty=!0,this.cachedSpriteDirty=!0,this.dirty=!1);var e=this._localBounds,i=e.x,s=e.width+e.x,r=e.y,n=e.height+e.y,h=t||this.worldTransform,o=h.a,a=h.b,l=h.c,u=h.d,c=h.tx,d=h.ty,p=o*s+l*n+c,f=u*n+a*s+d,y=o*i+l*n+c,g=u*n+a*i+d,m=o*i+l*r+c,v=u*r+a*i+d,w=o*s+l*r+c,x=u*r+a*s+d,_=p,T=f,b=p,C=f;return b=w<(b=m<(b=y<b?y:b)?m:b)?w:b,C=x<(C=v<(C=g<C?g:C)?v:C)?x:C,_=w>(_=m>(_=y>_?y:_)?m:_)?w:_,T=x>(T=v>(T=g>T?g:T)?v:T)?x:T,this._bounds.x=b,this._bounds.width=_-b,this._bounds.y=C,this._bounds.height=T-C,this._bounds},updateLocalBounds:function(){var t=1/0,e=-1/0,i=1/0,s=-1/0;if(this.graphicsData.length)for(var r,n,h,o,a,l,u=0;u<this.graphicsData.length;u++){var c=this.graphicsData[u],d=c.type,p=c.lineWidth;if(r=c.shape,d===f.RECT||d===f.RREC||d===f.ELIP)h=r.x-p/2,o=r.y-p/2,t=h<t?h:t,e=h+(a=r.width+p)>e?h+a:e,i=o<i?o:i,s=o+(l=r.height+p)>s?o+l:s;else if(d===f.CIRC)h=r.x,o=r.y,t=h-(a=r.radius+p/2)<t?h-a:t,e=h+a>e?h+a:e,i=o-(l=r.radius+p/2)<i?o-l:i,s=o+l>s?o+l:s;else{n=r.points;for(var y=0;y<n.length;y+=2)t=(h=n[y])-p<t?h-p:t,e=h+p>e?h+p:e,i=(o=n[y+1])-p<i?o-p:i,s=o+p>s?o+p:s}}else t=0,e=0,i=0,s=0;var g=this.boundsPadding;this._localBounds.x=t-g,this._localBounds.width=e-t+2*g,this._localBounds.y=i-g,this._localBounds.height=s-i+2*g},drawShape:function(t){this.currentPath&&this.currentPath.shape.points.length<=2&&this.graphicsData.pop(),this.currentPath=null,t.type===f.POLY&&t.flatten();var e=new tt(this.lineWidth,this.lineColor,this.fillColor,this.filling,t);return this.graphicsData.push(e),e.type===f.POLY&&(e.shape.closed=this.filling,this.currentPath=e),this.dirty=!0,e}});var it=function(t,e,i,s){this.gl=t,this.frameBuffer=t.createFramebuffer(),this.texture=t.createTexture(),s=s||0,t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,s===p.LINEAR?t.LINEAR:t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,s===p.LINEAR?t.LINEAR:t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer),t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,0),this.renderBuffer=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this.renderBuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.renderBuffer),this.resize(e,i)};it.prototype.constructor=it,it.prototype.clear=function(){var t=this.gl;t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT)},it.prototype.resize=function(t,e){if(this.width!==t||this.height!==e){this.width=t,this.height=e;var i=this.gl;i.bindTexture(i.TEXTURE_2D,this.texture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,e,0,i.RGBA,i.UNSIGNED_BYTE,null),i.bindRenderbuffer(i.RENDERBUFFER,this.renderBuffer),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t,e)}},it.prototype.destroy=function(){var t=this.gl;t.deleteFramebuffer(this.frameBuffer),t.deleteTexture(this.texture),this.frameBuffer=null,this.texture=null};var st,rt=function(e,i,s,r,n){this.width=e||100,this.height=i||100,r=r||1;var h=Math.max(1,r),o=new M;if(o.width=this.width*h,o.height=this.height*h,o.resolution=r,o.scaleMode=n||0,o.loaded=!0,window.rt=this,this.renderer=s||Tiny.defaultRenderer,this.renderer.gl){var a=this.renderer.gl;o._dirty[a.id]=!1,this.textureBuffer=new it(a,this.width*r,this.height*r,o.scaleMode),o._glTextures[a.id]=this.textureBuffer.texture,this.projection=new l(this.width*h*.5,-this.height*h*.5)}else this.render=this.renderCanvas,this.textureBuffer=new t(this.width*r,this.height*r),o.source=this.textureBuffer.canvas;V.call(this,o,new H(0,0,Math.floor(this.width*r),Math.floor(this.height*r))),this.valid=!0,this._updateUvs()};function nt(t){var e=document.createElement('canvas');e.width=6,e.height=1;var i=e.getContext('2d');return i.fillStyle=t,i.fillRect(0,0,6,1),e}function ht(){if(void 0!==st)return st;var t=nt('#ff00ff'),e=nt('#ffff00'),i=document.createElement('canvas');i.width=6,i.height=1;var s=i.getContext('2d');s.globalCompositeOperation='multiply',s.drawImage(t,0,0),s.drawImage(e,2,0);var r=s.getImageData(2,0,1,1);if(r){var n=r.data;st=255===n[0]&&0===n[1]&&0===n[2]}else st=!1;return st}(rt.prototype=Object.create(V.prototype)).constructor=rt,rt.prototype.resize=function(t,e,i){t===this.width&&e===this.height||(this.valid=t>0&&e>0,this.width=t,this.height=e,this.frame.width=this.crop.width=t*this.base.resolution,this.frame.height=this.crop.height=e*this.base.resolution,i&&(this.base.width=this.width*this.base.resolution,this.base.height=this.height*this.base.resolution),this.renderer.gl&&(this.projection.x=this.width/2,this.projection.y=-this.height/2),this.valid&&this.textureBuffer.resize(this.width,this.height))},rt.prototype.clear=function(){this.valid&&(this.renderer.gl&&this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer),this.textureBuffer.clear())},rt.prototype.render=function(t,e,i){if(this.valid){var s=t.worldTransform;s.identity(),s.translate(0,2*this.projection.y),e&&s.append(e),s.scale(1,-1),t.worldAlpha=1;for(var r=t.children,n=0,h=r.length;n<h;n++)r[n].updateTransform();var o=this.renderer.gl;o.viewport(0,0,this.width*this.base.resolution,this.height*this.base.resolution),o.bindFramebuffer(o.FRAMEBUFFER,this.textureBuffer.frameBuffer),i&&this.textureBuffer.clear(),this.renderer.spriteBatch.dirty=!0;var a=this.renderer.resolution;this.renderer.resolution=this.base.resolution,this.renderer.renderObject(t,this.projection,this.textureBuffer.frameBuffer),this.renderer.resolution=a,this.renderer.spriteBatch.dirty=!0,s.identity()}},rt.prototype.getImage=function(){var t=new Image;return t.src=this.getBase64(),t},rt.prototype.getBase64=function(){return this.getCanvas().toDataURL()},rt.prototype.getCanvas=function(){if(this.renderer.gl){var e=this.renderer.gl,i=this.textureBuffer.width,s=this.textureBuffer.height,r=new Uint8Array(4*i*s);e.bindFramebuffer(e.FRAMEBUFFER,this.textureBuffer.frameBuffer),e.readPixels(0,0,i,s,e.RGBA,e.UNSIGNED_BYTE,r),e.bindFramebuffer(e.FRAMEBUFFER,null);var n=new t(i,s),h=n.context.getImageData(0,0,i,s);return h.data.set(r),n.context.putImageData(h,0,0),n.canvas}return this.textureBuffer.canvas},Tiny.BaseObject2D=z,Tiny.Object2D=q,Tiny.Scene=X,Tiny.Sprite=J,Tiny.Text=Q,Tiny.Graphics=et,Tiny.TextureUvs=Y,Tiny.Texture=V,Tiny.RenderTexture=rt,Tiny.Rectangle=H;var ot=function(t,e,i){i=i||{},this.resolution=null!=i.resolution?i.resolution:1,this._resolution=this.resolution,this.clearBeforeRender=null==i.clearBeforeRender||i.clearBeforeRender,this.transparent=null!=i.transparent&&i.transparent,this.autoResize=i.autoResize||!1,Tiny.defaultRenderer||(Tiny.defaultRenderer=this);var s=this.domElement=i.domElement||document.createElement('canvas');this.context=s.getContext('2d',{alpha:this.transparent}),this._context=this.context,this.resize(t||800,e||600),this.setClearColor(16777215),Tiny.CanvasMaskManager&&(this.maskManager=new Tiny.CanvasMaskManager),this.roundPixels=!1,'imageSmoothingEnabled'in this.context?this.smoothProperty='imageSmoothingEnabled':'webkitImageSmoothingEnabled'in this.context?this.smoothProperty='webkitImageSmoothingEnabled':'mozImageSmoothingEnabled'in this.context?this.smoothProperty='mozImageSmoothingEnabled':'oImageSmoothingEnabled'in this.context?this.smoothProperty='oImageSmoothingEnabled':'msImageSmoothingEnabled'in this.context&&(this.smoothProperty='msImageSmoothingEnabled');var r=[],n=Tiny;r[n.NORMAL]='source-over',r[n.ADD]='lighter';var h=ht();r[n.MULTIPLY]=h?'multiply':'source-over',r[n.SCREEN]=h?'screen':'source-over',r[n.OVERLAY]=h?'overlay':'source-over',r[n.DARKEN]=h?'darken':'source-over',r[n.LIGHTEN]=h?'lighten':'source-over',r[n.COLOR_DODGE]=h?'color-dodge':'source-over',r[n.COLOR_BURN]=h?'color-burn':'source-over',r[n.HARD_LIGHT]=h?'hard-light':'source-over',r[n.SOFT_LIGHT]=h?'soft-light':'source-over',r[n.DIFFERENCE]=h?'difference':'source-over',r[n.EXCLUSION]=h?'exclusion':'source-over',r[n.HUE]=h?'hue':'source-over',r[n.SATURATION]=h?'saturation':'source-over',r[n.COLOR]=h?'color':'source-over',r[n.LUMINOSITY]=h?'luminosity':'source-over',this.blendModes=r};ot.prototype.constructor=ot,ot.prototype.setClearColor=function(t){this.clearColor=new Tiny.Color(t).toStyle()},ot.prototype.render=function(t){t.updateTransform(),this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1,this.currentBlendMode=Tiny.NORMAL,this.context.globalCompositeOperation=this.blendModes[Tiny.NORMAL],navigator.isCocoonJS&&this.domElement.screencanvas&&(this.context.fillStyle='black',this.context.clear()),this.clearBeforeRender&&(this.transparent?this.context.clearRect(0,0,this.width*this._resolution,this.height*this._resolution):(this.context.fillStyle=this.clearColor,this.context.fillRect(0,0,this.width*this._resolution,this.height*this._resolution))),this.renderObject(t)},ot.prototype.destroy=function(t){void 0===t&&(t=!0),t&&this.domElement.parentNode&&this.domElement.parentNode.removeChild(this.domElement),this.domElement=null,this.context=null,this.maskManager=null,Tiny.defaultRenderer===this&&(Tiny.defaultRenderer=null)},ot.prototype.resize=function(t,e){this.width=t,this.height=e;var i=this.domElement;i.width=Math.floor(this.width*this._resolution),i.height=Math.floor(this.height*this._resolution),this.autoResize&&(i.style.width=t+'px',i.style.height=e+'px')},ot.prototype.setPixelRatio=function(t){this._resolution=this.resolution=t;var e=this.domElement;e.width=Math.floor(this.width*this._resolution),e.height=Math.floor(this.height*this._resolution)},ot.prototype.renderObject=function(t,e){this.context=e||this._context,this.resolution=this._resolution,t.renderCanvas(this)};var at=function(){var t=new Tiny.CanvasBuffer(2,1,{willReadFrequently:!0});t.context.fillStyle='rgba(10, 20, 30, 0.5)',t.context.fillRect(0,0,1,1);var e=t.context.getImageData(0,0,1,1);t.context.putImageData(e,1,0);var i=t.context.getImageData(1,0,1,1);return i.data[0]===e.data[0]&&i.data[1]===e.data[1]&&i.data[2]===e.data[2]&&i.data[3]===e.data[3]}(),lt=function(){};lt.getTintedTexture=function(t,e){var i=e.int,s=t.texture;if(s._tintCache||(s._tintCache={}),s._tintCache[i])return s._tintCache[i];var r=lt.canvas||document.createElement('canvas');(lt.tintMethod(s,e,r),lt.convertTintToImage)?(new Image).src=r.toDataURL():lt.canvas=null;return lt.cacheTint&&(s._tintCache[i]=r),r},lt.tintWithMultiply=function(t,e,i){var s=i.getContext('2d'),r=t.crop;i.width=r.width,i.height=r.height,s.fillStyle=e.toStyle(),s.fillRect(0,0,r.width,r.height),s.globalCompositeOperation='multiply',s.drawImage(t.base.source,r.x,r.y,r.width,r.height,0,0,r.width,r.height),s.globalCompositeOperation='destination-atop',s.drawImage(t.base.source,r.x,r.y,r.width,r.height,0,0,r.width,r.height)},lt.tintWithPerPixel=function(t,e,i){var s=i.getContext('2d'),r=t.crop;i.width=r.width,i.height=r.height,s.globalCompositeOperation='copy',s.drawImage(t.base.source,r.x,r.y,r.width,r.height,0,0,r.width,r.height);for(var n=s.getImageData(0,0,r.width,r.height),h=n.data,o=0;o<h.length;o+=4)if(h[o+0]*=e.r,h[o+1]*=e.g,h[o+2]*=e.b,!at){var a=h[o+3];h[o+0]/=255/a,h[o+1]/=255/a,h[o+2]/=255/a}s.putImageData(n,0,0)},lt.convertTintToImage=!1,lt.cacheTint=!0,lt.tintMethod=ht()?lt.tintWithMultiply:lt.tintWithPerPixel;i(178);Tiny.CanvasRenderer=ot,Tiny.CanvasTinter=lt,Tiny.autoDetectRenderer=function(t,e,i){return function(){try{var t=document.createElement('canvas');return!!window.WebGLRenderingContext&&(t.getContext('webgl')||t.getContext('experimental-webgl'))}catch(t){return!1}}()?new Tiny.Renderer(t,e,i):new Tiny.CanvasRenderer(t,e,i)};var ut=function(){};ut.renderGraphics=function(t,e){var i=t.worldAlpha;t.dirty&&(this.updateGraphicsTint(t),t.dirty=!1);for(var s=0;s<t.graphicsData.length;s++){var r=t.graphicsData[s],n=r.shape,h=r._fillTint,o=r._lineTint;if(e.lineWidth=r.lineWidth,r.type===Tiny.POLY){e.beginPath();var a=n.points;e.moveTo(a[0],a[1]);for(var l=1;l<a.length/2;l++)e.lineTo(a[2*l],a[2*l+1]);n.closed&&e.lineTo(a[0],a[1]),a[0]===a[a.length-2]&&a[1]===a[a.length-1]&&e.closePath(),r.fill&&(e.globalAlpha=h.a*i,e.fillStyle=h.toStyle(),e.fill()),r.lineWidth&&(e.globalAlpha=o.a*i,e.strokeStyle=o.toStyle(),e.stroke())}else if(r.type===Tiny.RECT)r.fillColor&&(e.globalAlpha=h.a*i,e.fillStyle=h.toStyle(),e.fillRect(n.x,n.y,n.width,n.height)),r.lineWidth&&(e.globalAlpha=o.a*i,e.strokeStyle=o.toStyle(),e.strokeRect(n.x,n.y,n.width,n.height));else if(r.type===Tiny.CIRC)e.beginPath(),e.arc(n.x,n.y,n.radius,0,2*Math.PI),e.closePath(),r.fill&&(e.globalAlpha=h.a*i,e.fillStyle=h.toStyle(),e.fill()),r.lineWidth&&(e.globalAlpha=o.a*i,e.strokeStyle=o.toStyle(),e.stroke());else if(r.type===Tiny.ELIP){var u=2*n.width,c=2*n.height,d=n.x-u/2,p=n.y-c/2;e.beginPath();var f=.5522848,y=u/2*f,g=c/2*f,m=d+u,v=p+c,w=d+u/2,x=p+c/2;e.moveTo(d,x),e.bezierCurveTo(d,x-g,w-y,p,w,p),e.bezierCurveTo(w+y,p,m,x-g,m,x),e.bezierCurveTo(m,x+g,w+y,v,w,v),e.bezierCurveTo(w-y,v,d,x+g,d,x),e.closePath(),r.fill&&(e.globalAlpha=h.a*i,e.fillStyle=h.toStyle(),e.fill()),r.lineWidth&&(e.globalAlpha=o.a*i,e.strokeStyle=o.toStyle(),e.stroke())}else if(r.type===Tiny.RREC){var _=n.x,T=n.y,b=n.width,C=n.height,S=n.radius,M=Math.min(b,C)/2|0;S=S>M?M:S,e.beginPath(),e.moveTo(_,T+S),e.lineTo(_,T+C-S),e.quadraticCurveTo(_,T+C,_+S,T+C),e.lineTo(_+b-S,T+C),e.quadraticCurveTo(_+b,T+C,_+b,T+C-S),e.lineTo(_+b,T+S),e.quadraticCurveTo(_+b,T,_+b-S,T),e.lineTo(_+S,T),e.quadraticCurveTo(_,T,_,T+S),e.closePath(),r.fillColor&&(e.globalAlpha=h.a*i,e.fillStyle=h.toStyle(),e.fill()),r.lineWidth&&(e.globalAlpha=o.a*i,e.strokeStyle=o.toStyle(),e.stroke())}}},ut.renderGraphicsMask=function(t,e){var i=t.graphicsData.length;if(0!==i){e.beginPath();for(var s=0;s<i;s++){var r=t.graphicsData[s],n=r.shape;if(r.type===Tiny.POLY){var h=n.points;e.moveTo(h[0],h[1]);for(var o=1;o<h.length/2;o++)e.lineTo(h[2*o],h[2*o+1]);h[0]===h[h.length-2]&&h[1]===h[h.length-1]&&e.closePath()}else if(r.type===Tiny.RECT)e.rect(n.x,n.y,n.width,n.height),e.closePath();else if(r.type===Tiny.CIRC)e.arc(n.x,n.y,n.radius,0,2*Math.PI),e.closePath();else if(r.type===Tiny.ELIP){var a=2*n.width,l=2*n.height,u=n.x-a/2,c=n.y-l/2,d=.5522848,p=a/2*d,f=l/2*d,y=u+a,g=c+l,m=u+a/2,v=c+l/2;e.moveTo(u,v),e.bezierCurveTo(u,v-f,m-p,c,m,c),e.bezierCurveTo(m+p,c,y,v-f,y,v),e.bezierCurveTo(y,v+f,m+p,g,m,g),e.bezierCurveTo(m-p,g,u,v+f,u,v),e.closePath()}else if(r.type===Tiny.RREC){var w=n.x,x=n.y,_=n.width,T=n.height,b=n.radius,C=Math.min(_,T)/2|0;b=b>C?C:b,e.moveTo(w,x+b),e.lineTo(w,x+T-b),e.quadraticCurveTo(w,x+T,w+b,x+T),e.lineTo(w+_-b,x+T),e.quadraticCurveTo(w+_,x+T,w+_,x+T-b),e.lineTo(w+_,x+b),e.quadraticCurveTo(w+_,x,w+_-b,x),e.lineTo(w+b,x),e.quadraticCurveTo(w,x,w,x+b),e.closePath()}}}},ut.updateGraphicsTint=function(t){if(16777215!==t.tint.int)for(var e=0;e<t.graphicsData.length;e++){var i=t.graphicsData[e];i._fillTint=new Tiny.Color(i.fillColor).multiply(t.tint),i._lineTint=new Tiny.Color(i.lineColor).multiply(t.tint)}};var ct=function(){};ct.prototype.constructor=ct,ct.prototype.pushMask=function(t,e){var i=e.context;i.save();var s=t.alpha,r=t.worldTransform,n=e.resolution;i.setTransform(r.a*n,r.b*n,r.c*n,r.d*n,r.tx*n,r.ty*n),Tiny.CanvasGraphics.renderGraphicsMask(t,i),i.clip(),t.worldAlpha=s},ct.prototype.popMask=function(t){t.context.restore()};i(538);Tiny.CanvasGraphics=ut,Tiny.CanvasMaskManager=ct}()}();