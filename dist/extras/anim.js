!function(){"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(e,r){for(var n=0;n<r.length;n++){var i=r[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(o=i.key,a=void 0,a=function(e,r){if("object"!==t(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,r||"default");if("object"!==t(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}(o,"string"),"symbol"===t(a)?a:String(a)),i)}var o,a}var r=function(){},n=0,i=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.uuid=n++,this.key=i.key,this.system=i.system,this.parent=e,this.valid=!1,this.duration=i.duration||1e3,this._time=0,this.running=!1,this.repeat=i.repeat||0,this._reverse=i.reverse||!1,this.yoyo=i.yoyo||!1,this.repeatDelay=i.repeatDelay||0,this._delay=0,this.onStart=i.onStart||r,this.onStop=i.onStop||r,this.onComplete=i.onComplete||r,this.onRepeat=i.onRepeat||r,i.delay&&(this._delay=-i.delay),this._onStartFired=!1}var i,o,a;return i=t,(o=[{key:"setValue",value:function(){}},{key:"reverse",value:function(){this._reverse=!this._reverse}},{key:"start",value:function(){this.running||(this.running=!0,this.system&&this.system.addAnim(this))}},{key:"pause",value:function(){this.running&&(this.running=!1,this.system&&this.system.removeAnim(this))}},{key:"stop",value:function(){this.running=!1,this._time=0,this.setValue(0),this.system&&this.system.removeAnim(this),this.onStop(this.parent)}},{key:"update",value:function(t){if(!this.parent.worldTransform||!this.valid)return!1;if(this.running){if(this._delay<0)return this._delay+=t,!0;if(this._onStartFired||(this._onStartFired=!0,this.onStart(this.parent)),this._time+=t,this._time>this.duration){if(!(this.repeat>0||-1==this.repeat))return this.onComplete(this.parent),this._time=this.duration,this.running=!1,!1;do{this._time-=this.duration}while(this._time>this.duration);this.repeat>0&&this.repeat--,this.repeatDelay&&(this._delay=-this.repeatDelay),this.yoyo&&this.reverse(),this.onRepeat(this.parent)}var e=this._time/this.duration;this._reverse&&(e=1-e),this.setValue(e)}return!0}}])&&e(i.prototype,o),a&&e(i,a),Object.defineProperty(i,"prototype",{writable:!1}),t}();function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(i=n.key,a=void 0,a=function(t,e){if("object"!==o(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(i,"string"),"symbol"===o(a)?a:String(a)),n)}var i,a}function s(){return s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=c(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},s.apply(this,arguments)}function u(t,e){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},u(t,e)}function f(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=c(t);if(e){var i=c(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(t,e){if(e&&("object"===o(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,r)}}function c(t){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},c(t)}var l,y,h=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&u(t,e)}(o,t);var e,r,n,i=f(o);function o(t,e){var r;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(r=i.call(this,t,e)).frames=[],r.currentIndex=0;var n=e.data;if('string'==typeof n&&(n={key:n}),Array.isArray(n))r.frames=n;else if(n.key){var a=Tiny.Cache.texture[n.key+'.0'];if(a)for(var s=n.from||0,u=n.to||a.lastFrame,f=s;f<=u;f++)r.frames.push(a.key+'.'+f)}return r.frames.length>0&&(e.fps&&(r.duration=1e3/e.fps*r.frames.length),r.valid=!0),r}return e=o,(r=[{key:"reverse",value:function(){s(c(o.prototype),"reverse",this).call(this),this.repeatDelay||(this._time+=this.duration/this.frames.length)}},{key:"setValue",value:function(t){var e=this.frames.length*t|0;if(e>this.frames.length-1&&(e=this.frames.length-1),e!=this.currentIndex){this.currentIndex=e;var r=this.frames[e],n=Tiny.Cache.texture[r];this.parent.setTexture(n)}}}])&&a(e.prototype,r),n&&a(e,n),Object.defineProperty(e,"prototype",{writable:!1}),o}(i);function p(t){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},p(t)}function m(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(i=n.key,o=void 0,o=function(t,e){if("object"!==p(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==p(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(i,"string"),"symbol"===p(o)?o:String(o)),n)}var i,o}function v(t,e){return v=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},v(t,e)}function b(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=d(t);if(e){var i=d(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(t,e){if(e&&("object"===p(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,r)}}function d(t){return d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},d(t)}i.spritesheet=h;var g=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&v(t,e)}(o,t);var e,r,n,i=b(o);function o(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(r=i.call(this,t,e)).setFrames(e.data),e.duration||(r.duration=r._duration),r}return e=o,(r=[{key:"setFrames",value:function(t){var e=this.parent;this.setPose();var r=e.anim.data;e.anim.pose=e.anim.pose||{};var n=e.anim.pose;if(r&&t){var i=t.values,o=t.times,a=o[o.length-1];if(a){if(this._duration=1e3*a,e.anim.cache[this.key])return this.frames=e.anim.cache[this.key],void(this.valid=!0);this.frames=[];for(var s={},u=0;u<o.length;u++){var f,c=o[u],l=i[u],y=c/a,h=[];if(f=0===u?y:y-this.frames[u-1].trigger,this.frames.push({trigger:y,paths:h,prevDelta:f}),l&&0!==l.length)for(var m=0;m<l.length;m++){var v,b,d=l[m],g=d.name,_=e;if(g?_=r[g]:g='__default__',_)for(var w in d)if('name'!=w)if('object'==p(d[w]))for(var S in d[w])null==(b=s[g+w+S])&&(n[v=g+'.'+w]=n[v]||{},null==(b=n[v][S])&&(b=_[w][S],n[v][S]=b)),h.push({obj:_[w],name:S,val:d[w][S],prev:b}),s[g+w+S]=d[w][S];else null==(b=s[g+w])&&null==(b=n[v=g+'.'+w])&&(b=_[w],n[v]=b),h.push({obj:_,name:w,val:d[w],prev:b}),s[g+w]=d[w]}}0!==Object.keys(s).length&&(this.lastIndex=this._reverse?this.frames.length-1:0,this.valid=!0,e.anim.cache[this.key]=this.frames)}}}},{key:"setPose",value:function(t){var e=this.parent;t&&(e.anim.pose=t),t=e.anim.pose;var r=e.anim.data;for(var n in t){var i=n.split('.'),o=r[i[0]];o||(o=e);var a=i[1];if('object'==p(t[n]))for(var s in t[n])o[a][s]=t[n][s];else o[a]=t[n]}}},{key:"_setValue",value:function(t,e){if(0!=(y=t.paths.length))for(;y--;)(l=t.paths[y]).obj[l.name]=l.prev+(l.val-l.prev)*e}},{key:"setValue",value:function(t){for(var e=0,r=this.frames[e];r.trigger<t;)r=this.frames[++e];e!=this.lastIndex&&(this.lastIndex=e,this._reverse?this._setValue(this.frames[this.lastIndex],0):this._setValue(this.frames[this.lastIndex],1)),this._setValue(r,1-(r.trigger-t)/r.prevDelta)}}])&&m(e.prototype,r),n&&m(e,n),Object.defineProperty(e,"prototype",{writable:!1}),o}(i);function _(t){return _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_(t)}function w(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(i=n.key,o=void 0,o=function(t,e){if("object"!==_(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==_(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(i,"string"),"symbol"===_(o)?o:String(o)),n)}var i,o}i.keyframes=g;var S=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.game=e,this.anims={},this.cache={}}var e,r,n;return e=t,(r=[{key:"create",value:function(t){t.system=this,t.type=t.type||'spritesheet',this.cache[t.key]=t}},{key:"removeAnim",value:function(t){var e=t.uuid;delete this.anims[e]}},{key:"addAnim",value:function(t){var e=t.uuid;this.anims[e]=t}},{key:"add",value:function(t,e){var r=this;t.anim={cache:{},data:e||{},current:null,system:this},t.play=function(e){t.anim.current&&r.removeAnim(t.anim.current),'string'==typeof e&&(e={key:e});var n=r.cache[e.key],o=i[n.type];for(var a in n)void 0===e[a]&&(e[a]=n[a]);var s=new o(t,e);return t.anim.current=s,s.start(),s},t.resume=function(){t.anim.current&&t.anim.current.start()},t.pause=function(){t.anim.current&&t.anim.current.pause()},t.stop=function(){t.anim.current&&t.anim.current.stop()}}},{key:"update",value:function(t){var e=Object.keys(this.anims);if(0!==e.length){for(var r=0;r<e.length;r++){var n=this.anims[e[r]];n&&!1===n.update(t)&&delete this.anims[e[r]]}return!0}}},{key:"destroy",value:function(t){this.cache={},this.anims={}}}])&&w(e.prototype,r),n&&w(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();Tiny.registerSystem('anim',S),Tiny.Anim=i,Tiny.SpritesheetAnim=h,Tiny.KeyframesAnim=g}();