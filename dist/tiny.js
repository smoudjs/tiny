!function(){var t={847:function(){Date.now||(Date.now=function(){return(new Date).getTime()}),'undefined'==typeof Float32Array&&(window.Float32Array=Array,window.Uint16Array=Array),void 0===Object.assign&&(Object.assign=function(t){'use strict';if(null==t)throw new TypeError('Cannot convert undefined or null to object');for(var i=Object(t),e=1;e<arguments.length;e++){var r=arguments[e];if(null!=r)for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[s]=r[s])}return i})}},i={};function e(r){var s=i[r];if(void 0!==s)return s.exports;var n=i[r]={exports:{}};return t[r](n,n.exports,e),n.exports}!function(){"use strict";e(847);var t=function(t,i,e){this.width=t,this.height=i,this.canvas=document.createElement('canvas'),this.context=this.canvas.getContext('2d',e),this.canvas.width=t,this.canvas.height=i};function i(){this.a=[],this.n=0}t.prototype.constructor=t,t.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.width,this.height)},t.prototype.resize=function(t,i){this.width=this.canvas.width=t,this.height=this.canvas.height=i};var r={call:function(t){t&&(t=t.prototype||t,r.mixin(t))},mixin:function(t){const e={};function r(t,r,s,n){var h=e[t];h||(h=e[t]=new i),h.a.push(r,s||null,n||!1),h.n+=3}t.once=function(t,i,e){r(t,i,e,!0)},t.on=r,t.off=function(t,i,r){if(e[t]){var s=e[t].a;if(i)if(r)for(n=0;n<s.length;n+=3)s[n]==i&&s[n+1]==r&&(s.splice(n,3),n-=3);else for(var n=0;n<s.length;n+=3)s[n]==i&&(s.splice(n,3),n-=3);else s.length=0;0==s.length&&delete e[t]}},t.emit=function(t,i,r,s){var n=e[t];if(n){var h=n.a;n.n=0;for(var a,o,u=arguments.length,l=0;l<h.length-n.n;l+=3)a=h[l],o=h[l+1],h[l+2]&&(h.splice(l,3),l-=3),u<=1?a.call(o):2==u?a.call(o,i):3==u?a.call(o,i,r):a.call(o,i,r,s);0==h.length&&delete e[t]}}}},s=0;function n(){return++s}function h(t){return!(t&t-1||!t)}var a=Math.PI/180,o=180/Math.PI,u={distance:function(t,i,e,r){var s=t-e,n=i-r;return Math.sqrt(s*s+n*n)},clamp:function(t,i,e){return Math.max(i,Math.min(e,t))},degToRad:function(t){return t*a},radToDeg:function(t){return t*o},isPow2:h,getNextPow2:function(t){if(t>0&&0==(t&t-1))return t;for(var i=1;i<t;)i<<=1;return i}};function l(t,i,e){return this.r=1,this.g=1,this.b=1,this.a=1,this.int=16777215,void 0===i&&void 0===e?this.set(t):this.setRGB(t,i,e)}Object.assign(l.prototype,{set:function(t){return t&&'number'==typeof t.int?this.copy(t):'number'==typeof t?this.setHex(t):'string'==typeof t&&this.setStyle(t),this},refresh:function(){return this.int=(255*this.r<<16)+(255*this.g<<8)+(255*this.b|0),this},setHex:function(t){return t|=0,this.int=t,this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,i,e){return this.r=t,this.g=i,this.b=e,this.refresh()},setStyle:function(t){var i=t.length;if(4===i){var e=t.charAt(1),r=t.charAt(2),s=t.charAt(3);return this.setHex(+('0x'+e+e+r+r+s+s))}return 7===i?this.setHex(+t.replace('#','0x')):this},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this.refresh()},toStyle(){return'#'+('00000'+this.int.toString(16)).slice(-6)},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this.refresh()},toArray:function(t,i){return void 0===t&&(t=[]),void 0===i&&(i=0),t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,t}}),l.WHITE=new l;var c=function(t,i){this.x=t||0,this.y=i||0};c.prototype={set:function(t,i){return this.x=t||0,this.y=i||(0!==i?this.x:0),this},subVectors:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},copy:function(t){return this.x=t.x,this.y=t.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this}};var d=function(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0};d.prototype.fromArray=function(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]},d.prototype.toArray=function(t){this.array||(this.array=new Float32Array(9));var i=this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i},d.prototype.apply=function(t,i){i=i||new c;var e=t.x,r=t.y;return i.x=this.a*e+this.c*r+this.tx,i.y=this.b*e+this.d*r+this.ty,i},d.prototype.applyInverse=function(t,i){i=i||new c;var e=1/(this.a*this.d+this.c*-this.b),r=t.x,s=t.y;return i.x=this.d*e*r+-this.c*e*s+(this.ty*this.c-this.tx*this.d)*e,i.y=this.a*e*s+-this.b*e*r+(-this.ty*this.a+this.tx*this.b)*e,i},d.prototype.translate=function(t,i){return this.tx+=t,this.ty+=i,this},d.prototype.scale=function(t,i){return this.a*=t,this.d*=i,this.c*=t,this.b*=i,this.tx*=t,this.ty*=i,this},d.prototype.rotate=function(t){var i=Math.cos(t),e=Math.sin(t),r=this.a,s=this.c,n=this.tx;return this.a=r*i-this.b*e,this.b=r*e+this.b*i,this.c=s*i-this.d*e,this.d=s*e+this.d*i,this.tx=n*i-this.ty*e,this.ty=n*e+this.ty*i,this},d.prototype.append=function(t){var i=this.a,e=this.b,r=this.c,s=this.d;return this.a=t.a*i+t.b*r,this.b=t.a*e+t.b*s,this.c=t.c*i+t.d*r,this.d=t.c*e+t.d*s,this.tx=t.tx*i+t.ty*r+this.tx,this.ty=t.tx*e+t.ty*s+this.ty,this},d.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this};var f=new d;const p={NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},y={LINEAR:0,NEAREST:1},m={POLY:0,RECT:1,CIRC:2,ELIP:3,RREC:4};var x={VERSION:'3.0.3',CanvasBuffer:t,EventEmitter:r,Math:u,Mat3:d,Vec2:c,Color:l};Object.assign(x,p,y,m),window.Tiny=x;var g=[];function v(t,i){g.push({name:t,_class_:i})}var _,w,b,M,E,A=function(){},T=function(t){this.callbackContext=this,this.state=0,this.timeScale=1,this.width=0,this.height=0,this.systems=[],this.updatable=[],this.paused=!1,this.pauseDuration=0,this.inputView=document.body,Tiny.app||(Tiny.app=this),r.mixin(this),t=t||{},this.boot=t.boot||this.boot||A,this.preload=t.preload||this.preload||A,this.create=t.create||this.create||A,this.update=t.update||this.update||A,this.render=t.render||this.render||A,this._resize_cb=t.resize||A,this._destroy_cb=t.destroy||A;var i=this;setTimeout((function(){i._boot()}),0)};T.prototype._boot=function(){for(var t=0;t<g.length;t++){var i=g[t],e=new i._class_(this);this.systems.push(e),e.update&&this.updatable.push(e),i.name&&(this[i.name]=e)}Tiny.RAF&&(this.raf=new Tiny.RAF(this)),this.boot.call(this.callbackContext);var r=this;setTimeout((function(){r.load?r._preload():r._create()}),0)},T.prototype._preload=function(){this.preload.call(this.callbackContext),this.state=1,this.load.start(this._create)},T.prototype._create=function(){this.emit('load'),this.create.call(this.callbackContext),this.raf&&this.raf.start(),this.state=2},T.prototype.pause=function(){if(this.raf&&this.raf.reset(),!this.paused){for(var t=0;t<this.systems.length;t++)this.systems[t].pause&&this.systems[t].pause();this.paused=!0}},T.prototype.resume=function(){if(this.raf&&this.raf.reset(),this.paused){for(var t=0;t<this.systems.length;t++)this.systems[t].resume&&this.systems[t].resume();this.paused=!1}},T.prototype._update=function(t,i){if(this.paused)this.pauseDuration+=i;else{i*=this.timeScale,this.update.call(this.callbackContext,t,i),this.emit('update',i);for(var e=0;e<this.updatable.length;e++)this.updatable[e].update(i)}this.render(),this.emit('postrender')},T.prototype.resize=function(t,i){this.width=t||this.width,this.height=i||this.height,this.state>0&&(this._resize_cb.call(this.callbackContext,this.width,this.height),this.emit('resize',t,i));var e=this;setTimeout((function(){e.input&&e.input.updateBounds()}),0)},T.prototype.destroy=function(t){for(var i=0;i<this.systems.length;i++)this.systems[i].destroy&&this.systems[i].destroy(t);this.paused=!0,t&&this.load.clearCache(),this.raf&&this.raf.stop(),this._destroy_cb.call(this.callbackContext),Tiny.app===this&&(Tiny.app=null)};var R=function(){return(new Date).getTime()};void 0!==self.performance&&void 0!==self.performance.now?R=self.performance.now.bind(self.performance):void 0!==Date.now&&(R=Date.now);var S=function(t,i){void 0===i&&(i=!1),this.game=t,this.isRunning=!1,this.forceSetTimeOut=i;for(var e=['ms','moz','webkit','o'],r=0;r<e.length&&!window.requestAnimationFrame;r++)window.requestAnimationFrame=window[e[r]+'RequestAnimationFrame'],window.cancelAnimationFrame=window[e[r]+'CancelAnimationFrame']||window[e[r]+'CancelRequestAnimationFrame'];_=!1,w=null,b=null,M=0,E=0};S.prototype={start:function(){M=R(),this.isRunning=!0;var t=this;!window.requestAnimationFrame||this.forceSetTimeOut?(_=!0,w=function(){return t.updateSetTimeout()},b=window.setTimeout(w,0)):(_=!1,w=function(){return t.updateRAF()},b=window.requestAnimationFrame(w))},updateRAF:function(){E=R(),this.isRunning&&(this.game._update(Math.floor(E),E-M),b=window.requestAnimationFrame(w)),M=E},updateSetTimeout:function(){E=R(),this.isRunning&&(this.game._update(Math.floor(E),E-M),b=window.setTimeout(w,S.timeToCall)),M=E},reset:function(){M=R()},stop:function(){_?clearTimeout(b):window.cancelAnimationFrame(b),this.isRunning=!1}},S.timeToCall=15;var C={image:{},texture:{}},F=function(t){r.mixin(this),t.cache=C,this.game=t,this.list=[]};F.prototype={clearCache:function(){for(var t in C.texture)C.texture[t].destroy();for(var t in C)C[t]={}},all:function(t){this.list=this.list.concat(t)},start:function(t){var i=this,e=i.game,r=i.list,s=r.length;function n(){var t=r.shift(),i=F[t.type];i?i(t,h):h()}function h(h,a){i.emit('progress',1-r.length/s),0!=r.length?n():(i.emit('complete'),t.call(e))}0!=s?n():t.call(e)}},v('load',F);var B=function(t,i){this.resolution=1,this.width=100,this.height=100,this.scaleMode=i||0,this.valid=!1,this.source=t,this._UID=n(),this.premultipliedAlpha=!0,this._glTextures=[],this.mipmap=!1,this._dirty=[!0,!0,!0,!0],t&&((t.complete||t.getContext)&&t.width&&t.height?this.onLoad():t.onload=this.onLoad.bind(this),this.imageUrl=null,this._powerOf2=!1)};B.prototype.constructor=B,B.prototype.onLoad=function(t){this.valid=!0,this.width=this.source.naturalWidth||this.source.width,this.height=this.source.naturalHeight||this.source.height,this.dirty(),this.onload&&this.onload()},B.prototype.destroy=function(){this.imageUrl?(delete BaseTextureCache[this.imageUrl],delete PIXI.TextureCache[this.imageUrl],this.imageUrl=null,navigator.isCocoonJS||(this.source.src='')):this.source&&this.source._pixiId&&delete BaseTextureCache[this.source._pixiId],this.source=null,this.unloadFromGPU()},B.prototype.dirty=function(){for(var t=0;t<this._glTextures.length;t++)this._dirty[t]=!0},B.prototype.unloadFromGPU=function(){this.dirty();for(var t=this._glTextures.length-1;t>=0;t--){var i=this._glTextures[t],e=Tiny.glContexts[t];e&&i&&e.deleteTexture(i)}this._glTextures.length=0,this.dirty()};var L=function(t,i){var e=new Image;e.addEventListener('load',(function(){var r=new B(e);C.image[t.key]=r,i(t,r)})),e.src=t.src};F.image=L,F.prototype.image=function(t,i){this.list.push({src:i,key:t,type:'image'})};var z=function(t,i,e,r){this.x=t||0,this.y=i||0,this.width=e||0,this.height=r||0,this.type=m.RECT};z.prototype.contains=function(t,i){if(this.width<=0||this.height<=0)return!1;var e=this.x;if(t>=e&&t<=e+this.width){var r=this.y;if(i>=r&&i<=r+this.height)return!0}return!1},z.prototype.constructor=z;var U=new z(0,0,0,0),P=function(){this.x0=0,this.y0=0,this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.x3=0,this.y3=0},O=function(t,i,e,r){if(this.noFrame=!1,i||(this.noFrame=!0,i=new z(0,0,1,1)),'string'==typeof t){var s=t;if(!(t=C.image[s]))throw new Error('Cache Error: image '+s+' does`t found in cache');C.texture[s]=this,this.key=s}else t instanceof O?t=t.base:t instanceof B||(t=new B(t));this.base=t,this.frame=i,this.trim=r,this.valid=!1,this._uvs=null,this.width=0,this.height=0,this.crop=e||new z(0,0,1,1),t.valid?this.onBaseUpdate():t.onload=this.onBaseUpdate.bind(this)};O.prototype.constructor=O,O.prototype.onBaseUpdate=function(){var t=this.base;this.noFrame&&(this.frame=new z(0,0,t.width,t.height)),this.setFrame(this.frame)},O.prototype.addToCache=function(t,i){this.key=this.key||t,this.frame.name=this.frame.name||i,this.frame.name&&(t+='.'+this.frame.name),C.texture[t]=this},O.prototype.destroy=function(t){t&&this.base.destroy(),this.key&&delete C.texture[this.key],this.valid=!1},O.prototype.setFrame=function(t){this.noFrame=!1,this.frame=t,this.width=t.width,this.height=t.height,this.crop.x=t.x,this.crop.y=t.y,this.crop.width=t.width,this.crop.height=t.height,this.trim||!(t.x+t.width>this.base.width||t.y+t.height>this.base.height)?(this.valid=t&&t.width&&t.height&&this.base.valid,this.trim&&(this.width=this.trim.width,this.height=this.trim.height,this.frame.width=this.trim.width,this.frame.height=this.trim.height),this.valid&&this._updateUvs()):this.valid=!1},O.prototype._updateUvs=function(){this._uvs||(this._uvs=new P);var t=this.crop,i=this.base.width,e=this.base.height;this._uvs.x0=t.x/i,this._uvs.y0=t.y/e,this._uvs.x1=(t.x+t.width)/i,this._uvs.y1=t.y/e,this._uvs.x2=(t.x+t.width)/i,this._uvs.y2=(t.y+t.height)/e,this._uvs.x3=t.x/i,this._uvs.y3=(t.y+t.height)/e};F.atlas=function(t,i){var e=t.key;L(t,(function(t,r){for(var s=0;s<t.data.length;s++){var n=e+'.'+t.data[s].name,h=new O(r,t.data[s]);h.key=e,C.texture[n]=h}i()}))},F.prototype.atlas=function(t,i,e){this.list.push({src:i,key:t,data:e,type:'atlas'})};var I;F.spritesheet=function(t,i){var e=t.key;L(t,(function(t,r){var s,n,h;if(t.data){var a=t.data;s=a.length-1;for(var o=0;o<=s;o++)n=e+'.'+o,(h=new O(r,{name:o,x:Math.floor(a[o].x),y:Math.floor(a[o].y),width:Math.floor(a[o].width),height:Math.floor(a[o].height),duration:a[o].duration})).key=e,h.lastFrame=s,C.texture[n]=h}else{var u=r.width,l=r.height,c=t.width,d=t.height;c||(c=Math.floor(u/(t.cols||1))),d||(d=Math.floor(l/(t.rows||1)));var f=Math.floor(u/c)*Math.floor(l/d);if(0===f)return i();t.total&&(f=Math.min(f,t.total));var p=0,y=0;s=f-1;for(o=0;o<f;o++)n=e+'.'+o,(h=new O(r,{name:o,x:p,y,width:c,height:d,duration:t.duration})).key=e,h.lastFrame=s,C.texture[n]=h,(p+=c)+c>u&&(p=0,y+=d)}i()}))},F.prototype.spritesheet=function(t,i,e,r,s,n){var h={src:i,key:t,type:'spritesheet'};'number'==typeof e?(h.width=e,h.height=r,h.total=s,h.duration=n):e.length>0&&(h.data=e),this.list.push(h)};var D=function(t){this.game=t;var i=this.domElement=t.inputView;this.bounds={x:0,y:0,width:0,height:0},this.candidates=[],this.list=[],this.lastMove=null,this.isDown=!1,this.downHandler=this.downHandler.bind(this),this.moveHandler=this.moveHandler.bind(this),this.upHandler=this.upHandler.bind(this),i.addEventListener('touchstart',this.downHandler),i.addEventListener('touchmove',this.moveHandler),i.addEventListener('touchend',this.upHandler),i.addEventListener('touchcancel',this.upHandler),i.addEventListener('mousedown',this.downHandler),i.addEventListener('mousemove',this.moveHandler),i.addEventListener('mouseup',this.upHandler),r.mixin(this);for(var e=0;e<D.systems.length;e++)D.systems[e].init.call(this);this.updateBounds()};D.prototype={add:function(t,i){t.inputEnabled=!0,(i=i||{}).system=this,t.input=i,r.mixin(t.input),this.list.push(t)},remove:function(t){var i=this.list.indexOf(t);if(i>-1){var e=this.list[i];return e.input=null,e.inputEnabled=!1,this.list.splice(i,1),e}},inputHandler:function(t,i){var e=this.getCoords(i);if(null!==e){if('move'!=t){this.candidates.length=0;for(var r=0;r<D.systems.length;r++)D.systems[r].preHandle.call(this,e.x,e.y);for(var s,n=0;n<this.list.length;n++)(s=this.list[n]).inputEnabled&&s.parent&&(s.input.checkBounds?s.input.checkBounds.call(this,s,e.x,e.y):D.checkBounds.call(this,s,e.x,e.y))&&this.candidates.push(s);for(r=this.candidates.length-1;r>=0;r--){if((s=this.candidates[r]).input['last_'+t]={x:e.x,y:e.y},s.input.emit(t,{x:e.x,y:e.y}),'up'==t){var h=s.input.last_down;h&&u.distance(h.x,h.y,e.x,e.y)<30&&s.input.emit('click',{x:e.x,y:e.y})}if(!s.input.transparent)break}}this.emit(t,{x:e.x,y:e.y})}},moveHandler:function(t){this.lastMove=t,this.inputHandler('move',t)},upHandler:function(t){this.isDown=!1,this.inputHandler('up',this.lastMove)},downHandler:function(t){this.isDown=!0,this.lastMove=t,this.inputHandler('down',t)},clickHandler:function(t){this.inputHandler('click',t)},getCoords:function(t){var i=null;return'undefined'!=typeof TouchEvent&&t instanceof TouchEvent?(I=!0,t.touches.length>0?i={x:t.touches[0].clientX,y:t.touches[0].clientY}:t.clientX&&t.clientY&&(i={x:t.clientX,y:t.clientY})):i={x:t.clientX,y:t.clientY},I&&t instanceof MouseEvent||null===i?null:i={x:i.x-this.bounds.x,y:i.y-this.bounds.y}},updateBounds:function(){var t=this.bounds,i=this.domElement.getBoundingClientRect();t.x=i.left,t.y=i.top,t.width=i.width,t.height=i.height},destroy:function(){var t=this.domElement;t.removeEventListener('touchstart',this.downHandler),t.removeEventListener('touchmove',this.moveHandler),t.removeEventListener('touchend',this.upHandler),t.removeEventListener('touchcancel',this.upHandler),t.removeEventListener('mousedown',this.downHandler),t.removeEventListener('mousemove',this.moveHandler),t.removeEventListener('mouseup',this.upHandler)}},D.checkBounds=function(t,i,e){if(t.worldVisible&&t.getBounds().contains(i,e))return!0},D.systems=[],v('input',D);var N=function(){},k=function(t,i,e,r,s,n,h,a,o){this.game=e,this.cb=r||N,this.ctx=s||this,this.delay=null==n?1e3:n,this.loop=h,this.count=a||0,this.repeat=this.count>0,this.running=!!t,this._lastFrame=0,this.autoRemove=i,this.onComplete=o||N};k.prototype={start:function(){this.running=!0},pause:function(){this.running=!1},stop:function(){this.running=!1,this._lastFrame=0},update:function(t){this.running&&(this._lastFrame+=t,this._lastFrame>=this.delay&&(this.cb.call(this.ctx),this._lastFrame=0,this.repeat?(this.count--,0===this.count&&(this.running=!1,this.autoRemove&&this.game.timer.remove(this),this.onComplete())):this.loop||(this.running=!1,this.autoRemove&&this.game.timer.remove(this))))}};var j=function(t){this.game=t,this.list=[],this.autoStart=!0,this.autoRemove=!0};j.prototype={update:function(t){for(var i=0;i<this.list.length;i++)this.list[i].update(t)},removeAll:function(){for(var t=0;t<this.list.length;t++)this.list[t].stop();this.list=[]},remove:function(t){var i=this.list.indexOf(t);i>-1&&(t.stop(),this.list.splice(i,1))},add:function(t,i,e,r,s){r=null!=r?r:this.autoStart,s=null!=s?s:this.autoRemove;var n=new k(r,s,this.game,i,e,t);return this.list.push(n),n},loop:function(t,i,e,r,s){r=null!=r?r:this.autoStart,s=null!=s?s:this.autoRemove;var n=new k(r,s,this.game,i,e,t,!0);return this.list.push(n),n},repeat:function(t,i,e,r,s,n,h){s=null!=s?s:this.autoStart,n=null!=n?n:this.autoRemove;var a=new k(s,n,this.game,e,r,t,!1,i,h);return this.list.push(a),a},destroy:function(){this.removeAll()}},v('timer',j);var V=function(){this._tweens={},this._tweensAddedDuringUpdate={}};V.prototype={getAll:function(){return Object.keys(this._tweens).map(function(t){return this._tweens[t]}.bind(this))},removeAll:function(){this._tweens={}},add:function(t){var i=t.getId();this._tweens[i]=t,this._tweensAddedDuringUpdate[i]=t},remove:function(t){var i=t.getId();delete this._tweens[i],delete this._tweensAddedDuringUpdate[i]},update:function(t,i){var e=Object.keys(this._tweens);if(0===e.length)return!1;for(;e.length>0;){this._tweensAddedDuringUpdate={};for(var r=0;r<e.length;r++){var s=this._tweens[e[r]];s&&!1===s.update(t)&&(s._isPlaying=!1,i||delete this._tweens[e[r]])}e=Object.keys(this._tweensAddedDuringUpdate)}return!0}};var G=new V;G.Group=V,G._nextId=0,G.nextId=function(){return G._nextId++};var Y=function(t,i){this._isPaused=!1,this._object=t,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._repeatDelayTime=void 0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._time=0,this._easingFunction=W.Linear.None,this._interpolationFunction=H.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onRepeatCallback=null,this._onCompleteCallback=null,this._onStopCallback=null,this._group=i||G,this._id=G.nextId()};Y.prototype={getId:function(){return this._id},isPlaying:function(){return this._isPlaying},isPaused:function(){return this._isPaused},to:function(t,i){return this._valuesEnd=Object.create(t),void 0!==i&&(this._duration=i),this},duration:function(t){return this._duration=t,this},start:function(t){for(var i in this._group.add(this),this._isPlaying=!0,this._isPaused=!1,this._time=0,this._onStartCallbackFired=!1,this._startTime=this._delayTime,this._valuesEnd){if(this._valuesEnd[i]instanceof Array){if(0===this._valuesEnd[i].length)continue;this._valuesEnd[i]=[this._object[i]].concat(this._valuesEnd[i])}void 0!==this._object[i]&&(1!=t&&void 0!==this._valuesStart[i]||(this._valuesStart[i]=this._object[i]),this._valuesStart[i]instanceof Array==!1&&(this._valuesStart[i]*=1),this._valuesStartRepeat[i]=this._valuesStart[i]||0)}return this},stop:function(){return this._isPlaying?(this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,null!==this._onStopCallback&&this._onStopCallback(this._object),this.stopChainedTweens(),this):this},end:function(){return this.update(1/0),this},pause:function(){return this._isPaused||!this._isPlaying||(this._isPaused=!0,this._group.remove(this)),this},resume:function(){return this._isPaused&&this._isPlaying?(this._isPaused=!1,this._group.add(this),this):this},stopChainedTweens:function(){for(var t=0,i=this._chainedTweens.length;t<i;t++)this._chainedTweens[t].stop()},group:function(t){return this._group=t,this},delay:function(t){return this._delayTime=t,this},repeat:function(t){return this._repeat=t,this},repeatDelay:function(t){return this._repeatDelayTime=t,this},yoyo:function(t){return this._yoyo=t,this},easing:function(t){return this._easingFunction=t,this},interpolation:function(t){return this._interpolationFunction=t,this},chain:function(){return this._chainedTweens=arguments,this},onStart:function(t){return this._onStartCallback=t,this},onUpdate:function(t){return this._onUpdateCallback=t,this},onRepeat:function(t){return this._onRepeatCallback=t,this},onComplete:function(t){return this._onCompleteCallback=t,this},onStop:function(t){return this._onStopCallback=t,this},update:function(t){var i,e,r;if(this._time+=t,this._time<this._startTime)return!0;for(i in!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),e=(this._time-this._startTime)/this._duration,e=0===this._duration||e>1?1:e,r=this._easingFunction(e),this._valuesEnd)if(void 0!==this._valuesStart[i]){var s=this._valuesStart[i]||0,n=this._valuesEnd[i];n instanceof Array?this._object[i]=this._interpolationFunction(n,r):('string'==typeof n&&(n='+'===n.charAt(0)||'-'===n.charAt(0)?s+parseFloat(n):parseFloat(n)),'number'==typeof n&&(this._object[i]=s+(n-s)*r))}if(null!==this._onUpdateCallback&&this._onUpdateCallback(this._object,e),1===e){if(this._time=0,this._repeat>0){for(i in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat){if('string'==typeof this._valuesEnd[i]&&(this._valuesStartRepeat[i]=this._valuesStartRepeat[i]+parseFloat(this._valuesEnd[i])),this._yoyo){var h=this._valuesStartRepeat[i];this._valuesStartRepeat[i]=this._valuesEnd[i],this._valuesEnd[i]=h}this._valuesStart[i]=this._valuesStartRepeat[i]}return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=this._repeatDelayTime:this._startTime=this._delayTime,null!==this._onRepeatCallback&&this._onRepeatCallback(this._object),!0}null!==this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var a=0,o=this._chainedTweens.length;a<o;a++)this._chainedTweens[a].start();return!1}return!0}};var X,W={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}},Back:{In:function(t){var i=1.70158;return t*t*((i+1)*t-i)},Out:function(t){var i=1.70158;return--t*t*((i+1)*t+i)+1},InOut:function(t){var i=2.5949095;return(t*=2)<1?t*t*((i+1)*t-i)*.5:.5*((t-=2)*t*((i+1)*t+i)+2)}},Bounce:{In:function(t){return 1-W.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*W.Bounce.In(2*t):.5*W.Bounce.Out(2*t-1)+.5}}},H={Linear:function(t,i){var e=t.length-1,r=e*i,s=Math.floor(r),n=H.Utils.Linear;return i<0?n(t[0],t[1],r):i>1?n(t[e],t[e-1],e-r):n(t[s],t[s+1>e?e:s+1],r-s)},Bezier:function(t,i){for(var e=0,r=t.length-1,s=Math.pow,n=H.Utils.Bernstein,h=0;h<=r;h++)e+=s(1-i,r-h)*s(i,h)*t[h]*n(r,h);return e},CatmullRom:function(t,i){var e=t.length-1,r=e*i,s=Math.floor(r),n=H.Utils.CatmullRom;return t[0]===t[e]?(i<0&&(s=Math.floor(r=e*(1+i))),n(t[(s-1+e)%e],t[s],t[(s+1)%e],t[(s+2)%e],r-s)):i<0?t[0]-(n(t[0],t[0],t[1],t[1],-r)-t[0]):i>1?t[e]-(n(t[e],t[e],t[e-1],t[e-1],r-e)-t[e]):n(t[s?s-1:0],t[s],t[e<s+1?e:s+1],t[e<s+2?e:s+2],r-s)},Utils:{Linear:function(t,i,e){return(i-t)*e+t},Bernstein:function(t,i){var e=H.Utils.Factorial;return e(t)/e(i)/e(t-i)},Factorial:(X=[1],function(t){var i=1;if(X[t])return X[t];for(var e=t;e>1;e--)i*=e;return X[t]=i,i}),CatmullRom:function(t,i,e,r,s){var n=.5*(e-t),h=.5*(r-i),a=s*s;return(2*i-2*e+n+h)*(s*a)+(-3*i+3*e-2*n-h)*a+n*s+i}}},q=function(t){this.game=t,this.bufferList=[],this.group=new V};q.prototype={remove:function(t){this.group.remove(t)},add:function(t){return new Y(t,this.group)},pause:function(){for(var t in this.bufferList.length=0,this.group._tweens)this.bufferList.push(this.group._tweens[t]),this.group._tweens[t].pause()},resume(){for(var t=0;t<this.bufferList.length;t++)this.bufferList[t].resume();this.bufferList.length=0},update:function(t){this.group.update(t)},destroy:function(){this.bufferList.length=0,this.group.removeAll(),this.group=null}},v('tweens',q),Tiny.App=T,Tiny.RAF=S,Tiny.registerSystem=v,Tiny.systems=g,Tiny.TweenManager=q,Tiny.Cache=C,Tiny.Loader=F,Tiny.Easing=W,Tiny.Interpolation=H,Tiny.Input=D,Tiny.Timer=k;var Z=function(){this.stencilStack=[],this.reverse=!0,this.count=0};Z.prototype.setContext=function(t){this.gl=t},Z.prototype.pushStencil=function(t,i,e){var r=this.gl;this.bindGraphics(t,i,e),0===this.stencilStack.length&&(r.enable(r.STENCIL_TEST),r.clear(r.STENCIL_BUFFER_BIT),this.reverse=!0,this.count=0),this.stencilStack.push(i);var s=this.count;r.colorMask(!1,!1,!1,!1),r.stencilFunc(r.ALWAYS,0,255),r.stencilOp(r.KEEP,r.KEEP,r.INVERT),1===i.mode?(r.drawElements(r.TRIANGLE_FAN,i.indices.length-4,r.UNSIGNED_SHORT,0),this.reverse?(r.stencilFunc(r.EQUAL,255-s,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)):(r.stencilFunc(r.EQUAL,s,255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,2*(i.indices.length-4)),this.reverse?r.stencilFunc(r.EQUAL,255-(s+1),255):r.stencilFunc(r.EQUAL,s+1,255),this.reverse=!this.reverse):(this.reverse?(r.stencilFunc(r.EQUAL,s,255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)):(r.stencilFunc(r.EQUAL,255-s,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)),r.drawElements(r.TRIANGLE_STRIP,i.indices.length,r.UNSIGNED_SHORT,0),this.reverse?r.stencilFunc(r.EQUAL,s+1,255):r.stencilFunc(r.EQUAL,255-(s+1),255)),r.colorMask(!0,!0,!0,!0),r.stencilOp(r.KEEP,r.KEEP,r.KEEP),this.count++},Z.prototype.bindGraphics=function(t,i,e){this._currentGraphics=t;var r,s=this.gl,n=e.projection,h=e.offset;1===i.mode?(r=e.shaderManager.complexPrimitiveShader,e.shaderManager.setShader(r),s.uniform1f(r.flipY,e.flipY),s.uniformMatrix3fv(r.translationMatrix,!1,t.worldTransform.toArray(!0)),s.uniform2f(r.projectionVector,n.x,-n.y),s.uniform2f(r.offsetVector,-h.x,-h.y),s.uniform3fv(r.tintColor,t.tint.toArray()),s.uniform3fv(r.color,i.color),s.uniform1f(r.alpha,t.worldAlpha*i.alpha),s.bindBuffer(s.ARRAY_BUFFER,i.buffer),s.vertexAttribPointer(r.aVertexPosition,2,s.FLOAT,!1,8,0),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,i.indexBuffer)):(r=e.shaderManager.primitiveShader,e.shaderManager.setShader(r),s.uniformMatrix3fv(r.translationMatrix,!1,t.worldTransform.toArray(!0)),s.uniform1f(r.flipY,e.flipY),s.uniform2f(r.projectionVector,n.x,-n.y),s.uniform2f(r.offsetVector,-h.x,-h.y),s.uniform3fv(r.tintColor,t.tint.toArray()),s.uniform1f(r.alpha,t.worldAlpha),s.bindBuffer(s.ARRAY_BUFFER,i.buffer),s.vertexAttribPointer(r.aVertexPosition,2,s.FLOAT,!1,24,0),s.vertexAttribPointer(r.colorAttribute,4,s.FLOAT,!1,24,8),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,i.indexBuffer))},Z.prototype.popStencil=function(t,i,e){var r=this.gl;if(this.stencilStack.pop(),this.count--,0===this.stencilStack.length)r.disable(r.STENCIL_TEST);else{var s=this.count;this.bindGraphics(t,i,e),r.colorMask(!1,!1,!1,!1),1===i.mode?(this.reverse=!this.reverse,this.reverse?(r.stencilFunc(r.EQUAL,255-(s+1),255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)):(r.stencilFunc(r.EQUAL,s+1,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,2*(i.indices.length-4)),r.stencilFunc(r.ALWAYS,0,255),r.stencilOp(r.KEEP,r.KEEP,r.INVERT),r.drawElements(r.TRIANGLE_FAN,i.indices.length-4,r.UNSIGNED_SHORT,0),this.reverse?r.stencilFunc(r.EQUAL,s,255):r.stencilFunc(r.EQUAL,255-s,255)):(this.reverse?(r.stencilFunc(r.EQUAL,s+1,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)):(r.stencilFunc(r.EQUAL,255-(s+1),255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)),r.drawElements(r.TRIANGLE_STRIP,i.indices.length,r.UNSIGNED_SHORT,0),this.reverse?r.stencilFunc(r.EQUAL,s,255):r.stencilFunc(r.EQUAL,255-s,255)),r.colorMask(!0,!0,!0,!0),r.stencilOp(r.KEEP,r.KEEP,r.KEEP)}},Z.prototype.destroy=function(){this.stencilStack=null,this.gl=null};var K=function(t,i){this.passes=[this],this.shaders=[],this.dirty=!0,this.padding=0,this.uniforms=i||{},this.fragmentSrc=t||[]};K.prototype.constructor=K,K.prototype.syncUniforms=function(){for(var t=0,i=this.shaders.length;t<i;t++)this.shaders[t].dirty=!0};var Q=function(t,i,e){var r=i.join('\n'),s=t.createShader(e);return t.shaderSource(s,r),t.compileShader(s),t.getShaderParameter(s,t.COMPILE_STATUS)?s:(window.console.log(t.getShaderInfoLog(s)),null)},$=function(t,i,e){var r=function(t,i){return Q(t,i,t.FRAGMENT_SHADER)}(t,e),s=function(t,i){return Q(t,i,t.VERTEX_SHADER)}(t,i),n=t.createProgram();return t.attachShader(n,s),t.attachShader(n,r),t.linkProgram(n),t.getProgramParameter(n,t.LINK_STATUS)||window.console.log('Could not initialise shaders'),n},J=function(t){this._UID=n(),this.gl=t,this.program=null,this.fragmentSrc=['precision lowp float;','varying vec2 vTextureCoord;','varying vec4 vColor;','uniform sampler2D uSampler;','void main(void) {','   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;','}'],this.textureCount=0,this.firstRun=!0,this.dirty=!0,this.attributes=[],this.init()};J.prototype.constructor=J,J.prototype.init=function(){var t=this.gl,i=$(t,this.vertexSrc||J.defaultVertexSrc,this.fragmentSrc);for(var e in t.useProgram(i),this.uSampler=t.getUniformLocation(i,'uSampler'),this.projectionVector=t.getUniformLocation(i,'projectionVector'),this.offsetVector=t.getUniformLocation(i,'offsetVector'),this.dimensions=t.getUniformLocation(i,'dimensions'),this.aVertexPosition=t.getAttribLocation(i,'aVertexPosition'),this.aTextureCoord=t.getAttribLocation(i,'aTextureCoord'),this.colorAttribute=t.getAttribLocation(i,'aColor'),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute],this.uniforms)this.uniforms[e].uniformLocation=t.getUniformLocation(i,e);this.initUniforms(),this.program=i},J.prototype.initUniforms=function(){this.textureCount=1;var t,i=this.gl;for(var e in this.uniforms){var r=(t=this.uniforms[e]).type;'sampler2D'===r?(t._init=!1,null!==t.value&&this.initSampler2D(t)):'mat2'===r||'mat3'===r||'mat4'===r?(t.glMatrix=!0,t.glValueLength=1,'mat2'===r?t.glFunc=i.uniformMatrix2fv:'mat3'===r?t.glFunc=i.uniformMatrix3fv:'mat4'===r&&(t.glFunc=i.uniformMatrix4fv)):(t.glFunc=i['uniform'+r],t.glValueLength='2f'===r||'2i'===r?2:'3f'===r||'3i'===r?3:'4f'===r||'4i'===r?4:1)}},J.prototype.initSampler2D=function(t){if(t.value&&t.value.base&&t.value.base.valid){var i=this.gl;if(i.activeTexture(i['TEXTURE'+this.textureCount]),i.bindTexture(i.TEXTURE_2D,t.value.base._glTextures[i.id]),t.textureData){var e=t.textureData,r=e.magFilter?e.magFilter:i.LINEAR,s=e.minFilter?e.minFilter:i.LINEAR,n=e.wrapS?e.wrapS:i.CLAMP_TO_EDGE,h=e.wrapT?e.wrapT:i.CLAMP_TO_EDGE,a=e.luminance?i.LUMINANCE:i.RGBA;if(e.repeat&&(n=i.REPEAT,h=i.REPEAT),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!!e.flipY),e.width){var o=e.width?e.width:512,u=e.height?e.height:2,l=e.border?e.border:0;i.texImage2D(i.TEXTURE_2D,0,a,o,u,l,a,i.UNSIGNED_BYTE,null)}else i.texImage2D(i.TEXTURE_2D,0,a,i.RGBA,i.UNSIGNED_BYTE,t.value.base.source);i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,r),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,s),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,h)}i.uniform1i(t.uniformLocation,this.textureCount),t._init=!0,this.textureCount++}},J.prototype.syncUniforms=function(){var t;this.textureCount=1;var i=this.gl;for(var e in this.uniforms)1===(t=this.uniforms[e]).glValueLength?!0===t.glMatrix?t.glFunc.call(i,t.uniformLocation,t.transpose,t.value):t.glFunc.call(i,t.uniformLocation,t.value):2===t.glValueLength?t.glFunc.call(i,t.uniformLocation,t.value.x,t.value.y):3===t.glValueLength?t.glFunc.call(i,t.uniformLocation,t.value.x,t.value.y,t.value.z):4===t.glValueLength?t.glFunc.call(i,t.uniformLocation,t.value.x,t.value.y,t.value.z,t.value.w):'sampler2D'===t.type&&(t._init?(i.activeTexture(i['TEXTURE'+this.textureCount]),t.value.base._dirty[i.id]?Tiny.instances[i.id].updateTexture(t.value.base):i.bindTexture(i.TEXTURE_2D,t.value.base._glTextures[i.id]),i.uniform1i(t.uniformLocation,this.textureCount),this.textureCount++):this.initSampler2D(t))},J.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},J.defaultVertexSrc=['attribute vec2 aVertexPosition;','attribute vec2 aTextureCoord;','attribute vec4 aColor;','uniform vec2 projectionVector;','uniform vec2 offsetVector;','varying vec2 vTextureCoord;','varying vec4 vColor;','const vec2 center = vec2(-1.0, 1.0);','void main(void) {','   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);','   vTextureCoord = aTextureCoord;','   vColor = vec4(aColor.rgb * aColor.a, aColor.a);','}'];var tt=function(t){this.renderer=t,this.vertSize=5,this.size=2e3;var i=4*this.size*4*this.vertSize,e=6*this.size;this.vertices=new ArrayBuffer(i),this.positions=new Float32Array(this.vertices),this.colors=new Uint32Array(this.vertices),this.indices=new Uint16Array(e),this.lastIndexCount=0;for(var r=0,s=0;r<e;r+=6,s+=4)this.indices[r+0]=s+0,this.indices[r+1]=s+1,this.indices[r+2]=s+2,this.indices[r+3]=s+0,this.indices[r+4]=s+2,this.indices[r+5]=s+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.dirty=!0,this.textures=[],this.blendModes=[],this.shaders=[],this.sprites=[],this.defaultShader=new K(['precision lowp float;','varying vec2 vTextureCoord;','varying vec4 vColor;','uniform sampler2D uSampler;','void main(void) {','   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;','}'])};tt.prototype.setContext=function(t){this.gl=t,this.vertexBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW),this.currentBlendMode=99999;var i=new J(t);i.fragmentSrc=this.defaultShader.fragmentSrc,i.uniforms={},i.init(),this.defaultShader.shaders[t.id]=i},tt.prototype.begin=function(t){this.shader=t.shaderManager.defaultShader,this.start()},tt.prototype.render=function(t){var i=t.texture;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=i.base);var e=i._uvs;if(e){var r,s,n,h,a=t.anchor.x,o=t.anchor.y;if(i.trim){var u=i.trim;r=(s=u.x-a*u.width)+i.crop.width,n=(h=u.y-o*u.height)+i.crop.height}else r=i.frame.width*(1-a),s=i.frame.width*-a,n=i.frame.height*(1-o),h=i.frame.height*-o;var l=4*this.currentBatchSize*this.vertSize,c=i.base.resolution,d=t.worldTransform,f=d.a/c,p=d.b/c,y=d.c/c,m=d.d/c,x=d.tx,g=d.ty,v=this.colors,_=this.positions;this.renderer.roundPixels?(_[l]=f*s+y*h+x|0,_[l+1]=m*h+p*s+g|0,_[l+5]=f*r+y*h+x|0,_[l+6]=m*h+p*r+g|0,_[l+10]=f*r+y*n+x|0,_[l+11]=m*n+p*r+g|0,_[l+15]=f*s+y*n+x|0,_[l+16]=m*n+p*s+g|0):(_[l]=f*s+y*h+x,_[l+1]=m*h+p*s+g,_[l+5]=f*r+y*h+x,_[l+6]=m*h+p*r+g,_[l+10]=f*r+y*n+x,_[l+11]=m*n+p*r+g,_[l+15]=f*s+y*n+x,_[l+16]=m*n+p*s+g),_[l+2]=e.x0,_[l+3]=e.y0,_[l+7]=e.x1,_[l+8]=e.y1,_[l+12]=e.x2,_[l+13]=e.y2,_[l+17]=e.x3,_[l+18]=e.y3;var w=t.tint.int;v[l+4]=v[l+9]=v[l+14]=v[l+19]=(w>>16)+(65280&w)+((255&w)<<16)+(255*t.worldAlpha<<24),this.sprites[this.currentBatchSize++]=t}},tt.prototype.flush=function(){if(0!==this.currentBatchSize){var t,i,e,r,s=this.gl;if(this.dirty){this.dirty=!1,s.activeTexture(s.TEXTURE0),s.bindBuffer(s.ARRAY_BUFFER,this.vertexBuffer),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t=this.defaultShader.shaders[s.id];var n=4*this.vertSize;s.vertexAttribPointer(t.aVertexPosition,2,s.FLOAT,!1,n,0),s.vertexAttribPointer(t.aTextureCoord,2,s.FLOAT,!1,n,8),s.vertexAttribPointer(t.colorAttribute,4,s.UNSIGNED_BYTE,!0,n,16)}if(this.currentBatchSize>.5*this.size)s.bufferSubData(s.ARRAY_BUFFER,0,this.vertices);else{var h=this.positions.subarray(0,4*this.currentBatchSize*this.vertSize);s.bufferSubData(s.ARRAY_BUFFER,0,h)}for(var a,o=0,u=0,l=null,c=this.renderer.blendModeManager.currentBlendMode,d=null,f=!1,p=!1,y=0,m=this.currentBatchSize;y<m;y++){if(i=(a=this.sprites[y]).texture.base,f=c!==(e=a.blendMode),p=d!==(r=a.shader||this.defaultShader),(l!==i||f||p)&&(this.renderBatch(l,o,u),u=y,o=0,l=i,f&&(c=e,this.renderer.blendModeManager.setBlendMode(c)),p)){(t=(d=r).shaders[s.id])||((t=new J(s)).fragmentSrc=d.fragmentSrc,t.uniforms=d.uniforms,t.init(),d.shaders[s.id]=t),this.renderer.shaderManager.setShader(t),t.dirty&&t.syncUniforms();var x=this.renderer.projection;s.uniform2f(t.projectionVector,x.x,x.y);var g=this.renderer.offset;s.uniform2f(t.offsetVector,g.x,g.y)}o++}this.renderBatch(l,o,u),this.currentBatchSize=0}},tt.prototype.renderBatch=function(t,i,e){if(0!==i){var r=this.gl;t._dirty[r.id]?this.renderer.updateTexture(t):r.bindTexture(r.TEXTURE_2D,t._glTextures[r.id]),r.drawElements(r.TRIANGLES,6*i,r.UNSIGNED_SHORT,6*e*2),this.renderer.drawCount++}},tt.prototype.stop=function(){this.flush(),this.dirty=!0},tt.prototype.start=function(){this.dirty=!0},tt.prototype.destroy=function(){this.vertices=null,this.indices=null,this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteBuffer(this.indexBuffer),this.currentBaseTexture=null,this.gl=null};var it=function(t){this._UID=n(),this.gl=t,this.program=null,this.fragmentSrc=['precision mediump float;','varying vec4 vColor;','void main(void) {','   gl_FragColor = vColor;','}'],this.vertexSrc=['attribute vec2 aVertexPosition;','attribute vec4 aColor;','uniform mat3 translationMatrix;','uniform vec2 projectionVector;','uniform vec2 offsetVector;','uniform float alpha;','uniform float flipY;','uniform vec3 tint;','varying vec4 vColor;','void main(void) {','   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);','   v -= offsetVector.xyx;','   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);','   vColor = aColor * vec4(tint * alpha, alpha);','}'],this.init()};it.prototype.constructor=it,it.prototype.init=function(){var t=this.gl,i=$(t,this.vertexSrc,this.fragmentSrc);t.useProgram(i),this.projectionVector=t.getUniformLocation(i,'projectionVector'),this.offsetVector=t.getUniformLocation(i,'offsetVector'),this.tintColor=t.getUniformLocation(i,'tint'),this.flipY=t.getUniformLocation(i,'flipY'),this.aVertexPosition=t.getAttribLocation(i,'aVertexPosition'),this.colorAttribute=t.getAttribLocation(i,'aColor'),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=t.getUniformLocation(i,'translationMatrix'),this.alpha=t.getUniformLocation(i,'alpha'),this.program=i},it.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null};var et=function(t){this._UID=n(),this.gl=t,this.program=null,this.fragmentSrc=['precision mediump float;','varying vec4 vColor;','void main(void) {','   gl_FragColor = vColor;','}'],this.vertexSrc=['attribute vec2 aVertexPosition;','uniform mat3 translationMatrix;','uniform vec2 projectionVector;','uniform vec2 offsetVector;','uniform vec3 tint;','uniform float alpha;','uniform vec3 color;','uniform float flipY;','varying vec4 vColor;','void main(void) {','   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);','   v -= offsetVector.xyx;','   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);','   vColor = vec4(color * alpha * tint, alpha);','}'],this.init()};et.prototype.constructor=et,et.prototype.init=function(){var t=this.gl,i=$(t,this.vertexSrc,this.fragmentSrc);t.useProgram(i),this.projectionVector=t.getUniformLocation(i,'projectionVector'),this.offsetVector=t.getUniformLocation(i,'offsetVector'),this.tintColor=t.getUniformLocation(i,'tint'),this.color=t.getUniformLocation(i,'color'),this.flipY=t.getUniformLocation(i,'flipY'),this.aVertexPosition=t.getAttribLocation(i,'aVertexPosition'),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=t.getUniformLocation(i,'translationMatrix'),this.alpha=t.getUniformLocation(i,'alpha'),this.program=i},et.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null};var rt=function(){this.maxAttibs=10,this.attribState=[],this.tempAttribState=[];for(var t=0;t<this.maxAttibs;t++)this.attribState[t]=!1;this.stack=[]};rt.prototype.constructor=rt,rt.prototype.setContext=function(t){this.gl=t,this.primitiveShader=new it(t),this.complexPrimitiveShader=new et(t),this.defaultShader=new J(t),this.setShader(this.defaultShader)},rt.prototype.setAttribs=function(t){var i;for(i=0;i<this.tempAttribState.length;i++)this.tempAttribState[i]=!1;for(i=0;i<t.length;i++){var e=t[i];this.tempAttribState[e]=!0}var r=this.gl;for(i=0;i<this.attribState.length;i++)this.attribState[i]!==this.tempAttribState[i]&&(this.attribState[i]=this.tempAttribState[i],this.tempAttribState[i]?r.enableVertexAttribArray(i):r.disableVertexAttribArray(i))},rt.prototype.setShader=function(t){return this._currentId!==t._UID&&(this._currentId=t._UID,this.currentShader=t,this.gl.useProgram(t.program),this.setAttribs(t.attributes),!0)},rt.prototype.destroy=function(){this.attribState=null,this.tempAttribState=null,this.primitiveShader.destroy(),this.complexPrimitiveShader.destroy(),this.defaultShader.destroy(),this.gl=null};var st=function(){};st.prototype.constructor=st,st.prototype.setContext=function(t){this.gl=t},st.prototype.pushMask=function(t,i){var e=i.gl;t.dirty&&Tiny.WebGLGraphics.updateGraphics(t,e),t._webGL[e.id].data.length&&i.stencilManager.pushStencil(t,t._webGL[e.id].data[0],i)},st.prototype.popMask=function(t,i){var e=this.gl;i.stencilManager.popStencil(t,t._webGL[e.id].data[0],i)},st.prototype.destroy=function(){this.gl=null};var nt=function(t){this.renderer=t,this.filterStack=[],this.offsetX=0,this.offsetY=0};nt.prototype.constructor=nt,nt.prototype.setContext=function(t){this.gl=t,this.texturePool=[],this.initShaderBuffers()},nt.prototype.begin=function(t,i){this.defaultShader=t.shaderManager.defaultShader;var e=t.projection;this.width=2*e.x,this.height=2*-e.y,this.buffer=i},nt.prototype.pushFilter=function(t){var i=this.gl,e=this.renderer.projection,r=this.renderer.offset;t._filterArea=t.target.filterArea||t.target.getBounds(),this.filterStack.push(t);var s=t.filterPasses[0];this.offsetX+=t._filterArea.x,this.offsetY+=t._filterArea.y;var n=this.texturePool.pop();n?n.resize(this.width,this.height):n=new PIXI.FilterTexture(this.gl,this.width,this.height),i.bindTexture(i.TEXTURE_2D,n.texture);var h=t._filterArea,a=s.padding;h.x-=a,h.y-=a,h.width+=2*a,h.height+=2*a,h.x<0&&(h.x=0),h.width>this.width&&(h.width=this.width),h.y<0&&(h.y=0),h.height>this.height&&(h.height=this.height),i.bindFramebuffer(i.FRAMEBUFFER,n.frameBuffer),i.viewport(0,0,h.width,h.height),e.x=h.width/2,e.y=-h.height/2,r.x=-h.x,r.y=-h.y,i.colorMask(!0,!0,!0,!0),i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT),t._glFilterTexture=n},nt.prototype.popFilter=function(){var t=this.gl,i=this.filterStack.pop(),e=i._filterArea,r=i._glFilterTexture,s=this.renderer.projection,n=this.renderer.offset;if(i.filterPasses.length>1){t.viewport(0,0,e.width,e.height),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=0,this.vertexArray[1]=e.height,this.vertexArray[2]=e.width,this.vertexArray[3]=e.height,this.vertexArray[4]=0,this.vertexArray[5]=0,this.vertexArray[6]=e.width,this.vertexArray[7]=0,t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=e.width/this.width,this.uvArray[5]=e.height/this.height,this.uvArray[6]=e.width/this.width,this.uvArray[7]=e.height/this.height,t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray);var h=r,a=this.texturePool.pop();a||(a=new PIXI.FilterTexture(this.gl,this.width,this.height)),a.resize(this.width,this.height),t.bindFramebuffer(t.FRAMEBUFFER,a.frameBuffer),t.clear(t.COLOR_BUFFER_BIT),t.disable(t.BLEND);for(var o=0;o<i.filterPasses.length-1;o++){var u=i.filterPasses[o];t.bindFramebuffer(t.FRAMEBUFFER,a.frameBuffer),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,h.texture),this.applyFilterPass(u,e,e.width,e.height);var l=h;h=a,a=l}t.enable(t.BLEND),r=h,this.texturePool.push(a)}var c=i.filterPasses[i.filterPasses.length-1];this.offsetX-=e.x,this.offsetY-=e.y;var d=this.width,f=this.height,p=0,y=0,m=this.buffer;if(0===this.filterStack.length)t.colorMask(!0,!0,!0,!0);else{var x=this.filterStack[this.filterStack.length-1];d=(e=x._filterArea).width,f=e.height,p=e.x,y=e.y,m=x._glFilterTexture.frameBuffer}s.x=d/2,s.y=-f/2,n.x=p,n.y=y;var g=(e=i._filterArea).x-p,v=e.y-y;t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=g,this.vertexArray[1]=v+e.height,this.vertexArray[2]=g+e.width,this.vertexArray[3]=v+e.height,this.vertexArray[4]=g,this.vertexArray[5]=v,this.vertexArray[6]=g+e.width,this.vertexArray[7]=v,t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=e.width/this.width,this.uvArray[5]=e.height/this.height,this.uvArray[6]=e.width/this.width,this.uvArray[7]=e.height/this.height,t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray),t.viewport(0,0,d*this.renderer.resolution,f*this.renderer.resolution),t.bindFramebuffer(t.FRAMEBUFFER,m),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,r.texture),this.applyFilterPass(c,e,d,f),this.texturePool.push(r),i._glFilterTexture=null},nt.prototype.applyFilterPass=function(t,i,e,r){var s=this.gl,n=t.shaders[s.id];n||((n=new PIXI.PixiShader(s)).fragmentSrc=t.fragmentSrc,n.uniforms=t.uniforms,n.init(),t.shaders[s.id]=n),this.renderer.shaderManager.setShader(n),s.uniform2f(n.projectionVector,e/2,-r/2),s.uniform2f(n.offsetVector,0,0),t.uniforms.dimensions&&(t.uniforms.dimensions.value[0]=this.width,t.uniforms.dimensions.value[1]=this.height,t.uniforms.dimensions.value[2]=this.vertexArray[0],t.uniforms.dimensions.value[3]=this.vertexArray[5]),n.syncUniforms(),s.bindBuffer(s.ARRAY_BUFFER,this.vertexBuffer),s.vertexAttribPointer(n.aVertexPosition,2,s.FLOAT,!1,0,0),s.bindBuffer(s.ARRAY_BUFFER,this.uvBuffer),s.vertexAttribPointer(n.aTextureCoord,2,s.FLOAT,!1,0,0),s.bindBuffer(s.ARRAY_BUFFER,this.colorBuffer),s.vertexAttribPointer(n.colorAttribute,2,s.FLOAT,!1,0,0),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,this.indexBuffer),s.drawElements(s.TRIANGLES,6,s.UNSIGNED_SHORT,0),this.renderer.drawCount++},nt.prototype.initShaderBuffers=function(){var t=this.gl;this.vertexBuffer=t.createBuffer(),this.uvBuffer=t.createBuffer(),this.colorBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),this.vertexArray=new Float32Array([0,0,1,0,0,1,1,1]),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertexArray,t.STATIC_DRAW),this.uvArray=new Float32Array([0,0,1,0,0,1,1,1]),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),t.bufferData(t.ARRAY_BUFFER,this.uvArray,t.STATIC_DRAW),this.colorArray=new Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]),t.bindBuffer(t.ARRAY_BUFFER,this.colorBuffer),t.bufferData(t.ARRAY_BUFFER,this.colorArray,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),t.STATIC_DRAW)},nt.prototype.destroy=function(){var t=this.gl;this.filterStack=null,this.offsetX=0,this.offsetY=0;for(var i=0;i<this.texturePool.length;i++)this.texturePool[i].destroy();this.texturePool=null,t.deleteBuffer(this.vertexBuffer),t.deleteBuffer(this.uvBuffer),t.deleteBuffer(this.colorBuffer),t.deleteBuffer(this.indexBuffer)};var ht=function(t){this.currentBlendMode=99999,this.renderer=t};ht.prototype.constructor=ht,ht.prototype.setContext=function(t){this.gl=t},ht.prototype.setBlendMode=function(t){if(this.currentBlendMode===t)return!1;this.currentBlendMode=t;var i=this.renderer.blendModes[this.currentBlendMode];return this.gl.blendFunc(i[0],i[1]),!0},ht.prototype.destroy=function(){this.gl=null},Tiny.glContexts=[],Tiny.instances=[];var at=function(t,i,e){e=Object.assign({},{view:null,transparent:!1,antialias:!1,preserveDrawingBuffer:!1,resolution:1,clearBeforeRender:!0,autoResize:!1},e),Tiny.defaultRenderer||(Tiny.defaultRenderer=this),this.resolution=this._resolution=e.resolution,this.transparent=e.transparent,this.autoResize=e.autoResize||!1,this.preserveDrawingBuffer=e.preserveDrawingBuffer,this.clearBeforeRender=e.clearBeforeRender,this.width=t||800,this.height=i||600,this.view=e.view||document.createElement('canvas'),this.domElement=this.view,this.contextLostBound=this.handleContextLost.bind(this),this.contextRestoredBound=this.handleContextRestored.bind(this),this.view.addEventListener('webglcontextlost',this.contextLostBound,!1),this.view.addEventListener('webglcontextrestored',this.contextRestoredBound,!1),this._contextOptions={alpha:this.transparent,antialias:e.antialias,premultipliedAlpha:this.transparent&&'notMultiplied'!==this.transparent,stencil:!0,preserveDrawingBuffer:e.preserveDrawingBuffer},this.projection=new c,this._projection=new c,this.offset=new c(0,0),this.clearColor=new l,this.shaderManager=new rt,this.spriteBatch=new tt(this),this.maskManager=new st,this.filterManager=new nt(this),this.stencilManager=new Z,this.blendModeManager=new ht(this),this.initContext()};function ot(t,i,e){e=e||2;var r,s,n,h,a,o,u,l=i&&i.length,c=l?i[0]*e:t.length,d=ut(t,0,c,e,!0),f=[];if(!d||d.next===d.prev)return f;if(l&&(d=function(t,i,e,r){var s,n,h,a=[];for(s=0,n=i.length;s<n;s++)(h=ut(t,i[s]*r,s<n-1?i[s+1]*r:t.length,r,!1))===h.next&&(h.steiner=!0),a.push(_t(h));for(a.sort(mt),s=0;s<a.length;s++)e=xt(a[s],e);return e}(t,i,d,e)),t.length>80*e){r=n=t[0],s=h=t[1];for(var p=e;p<c;p+=e)(a=t[p])<r&&(r=a),(o=t[p+1])<s&&(s=o),a>n&&(n=a),o>h&&(h=o);u=0!==(u=Math.max(n-r,h-s))?32767/u:0}return ct(d,f,e,r,s,u,0),f}function ut(t,i,e,r,s){var n,h;if(s===function(t,i,e,r){for(var s=0,n=i,h=e-r;n<e;n+=r)s+=(t[h]-t[n])*(t[n+1]+t[h+1]),h=n;return s}(t,i,e,r)>0)for(n=i;n<e;n+=r)h=Ft(n,t[n],t[n+1],h);else for(n=e-r;n>=i;n-=r)h=Ft(n,t[n],t[n+1],h);return h&&Et(h,h.next)&&(Bt(h),h=h.next),h}function lt(t,i){if(!t)return t;i||(i=t);var e,r=t;do{if(e=!1,r.steiner||!Et(r,r.next)&&0!==Mt(r.prev,r,r.next))r=r.next;else{if(Bt(r),(r=i=r.prev)===r.next)break;e=!0}}while(e||r!==i);return i}function ct(t,i,e,r,s,n,h){if(t){!h&&n&&function(t,i,e,r){var s=t;do{0===s.z&&(s.z=vt(s.x,s.y,i,e,r)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next}while(s!==t);s.prevZ.nextZ=null,s.prevZ=null,function(t){var i,e,r,s,n,h,a,o,u=1;do{for(e=t,t=null,n=null,h=0;e;){for(h++,r=e,a=0,i=0;i<u&&(a++,r=r.nextZ);i++);for(o=u;a>0||o>0&&r;)0!==a&&(0===o||!r||e.z<=r.z)?(s=e,e=e.nextZ,a--):(s=r,r=r.nextZ,o--),n?n.nextZ=s:t=s,s.prevZ=n,n=s;e=r}n.nextZ=null,u*=2}while(h>1)}(s)}(t,r,s,n);for(var a,o,u=t;t.prev!==t.next;)if(a=t.prev,o=t.next,n?ft(t,r,s,n):dt(t))i.push(a.i/e|0),i.push(t.i/e|0),i.push(o.i/e|0),Bt(t),t=o.next,u=o.next;else if((t=o)===u){h?1===h?ct(t=pt(lt(t),i,e),i,e,r,s,n,2):2===h&&yt(t,i,e,r,s,n):ct(lt(t),i,e,r,s,n,1);break}}}function dt(t){var i=t.prev,e=t,r=t.next;if(Mt(i,e,r)>=0)return!1;for(var s=i.x,n=e.x,h=r.x,a=i.y,o=e.y,u=r.y,l=s<n?s<h?s:h:n<h?n:h,c=a<o?a<u?a:u:o<u?o:u,d=s>n?s>h?s:h:n>h?n:h,f=a>o?a>u?a:u:o>u?o:u,p=r.next;p!==i;){if(p.x>=l&&p.x<=d&&p.y>=c&&p.y<=f&&wt(s,a,n,o,h,u,p.x,p.y)&&Mt(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function ft(t,i,e,r){var s=t.prev,n=t,h=t.next;if(Mt(s,n,h)>=0)return!1;for(var a=s.x,o=n.x,u=h.x,l=s.y,c=n.y,d=h.y,f=a<o?a<u?a:u:o<u?o:u,p=l<c?l<d?l:d:c<d?c:d,y=a>o?a>u?a:u:o>u?o:u,m=l>c?l>d?l:d:c>d?c:d,x=vt(f,p,i,e,r),g=vt(y,m,i,e,r),v=t.prevZ,_=t.nextZ;v&&v.z>=x&&_&&_.z<=g;){if(v.x>=f&&v.x<=y&&v.y>=p&&v.y<=m&&v!==s&&v!==h&&wt(a,l,o,c,u,d,v.x,v.y)&&Mt(v.prev,v,v.next)>=0)return!1;if(v=v.prevZ,_.x>=f&&_.x<=y&&_.y>=p&&_.y<=m&&_!==s&&_!==h&&wt(a,l,o,c,u,d,_.x,_.y)&&Mt(_.prev,_,_.next)>=0)return!1;_=_.nextZ}for(;v&&v.z>=x;){if(v.x>=f&&v.x<=y&&v.y>=p&&v.y<=m&&v!==s&&v!==h&&wt(a,l,o,c,u,d,v.x,v.y)&&Mt(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;_&&_.z<=g;){if(_.x>=f&&_.x<=y&&_.y>=p&&_.y<=m&&_!==s&&_!==h&&wt(a,l,o,c,u,d,_.x,_.y)&&Mt(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function pt(t,i,e){var r=t;do{var s=r.prev,n=r.next.next;!Et(s,n)&&At(s,r,r.next,n)&&St(s,n)&&St(n,s)&&(i.push(s.i/e|0),i.push(r.i/e|0),i.push(n.i/e|0),Bt(r),Bt(r.next),r=t=n),r=r.next}while(r!==t);return lt(r)}function yt(t,i,e,r,s,n){var h=t;do{for(var a=h.next.next;a!==h.prev;){if(h.i!==a.i&&bt(h,a)){var o=Ct(h,a);return h=lt(h,h.next),o=lt(o,o.next),ct(h,i,e,r,s,n,0),void ct(o,i,e,r,s,n,0)}a=a.next}h=h.next}while(h!==t)}function mt(t,i){return t.x-i.x}function xt(t,i){var e=function(t,i){var e,r=i,s=t.x,n=t.y,h=-1/0;do{if(n<=r.y&&n>=r.next.y&&r.next.y!==r.y){var a=r.x+(n-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=s&&a>h&&(h=a,e=r.x<r.next.x?r:r.next,a===s))return e}r=r.next}while(r!==i);if(!e)return null;var o,u=e,l=e.x,c=e.y,d=1/0;r=e;do{s>=r.x&&r.x>=l&&s!==r.x&&wt(n<c?s:h,n,l,c,n<c?h:s,n,r.x,r.y)&&(o=Math.abs(n-r.y)/(s-r.x),St(r,t)&&(o<d||o===d&&(r.x>e.x||r.x===e.x&&gt(e,r)))&&(e=r,d=o)),r=r.next}while(r!==u);return e}(t,i);if(!e)return i;var r=Ct(e,t);return lt(r,r.next),lt(e,e.next)}function gt(t,i){return Mt(t.prev,t,i.prev)<0&&Mt(i.next,t,t.next)<0}function vt(t,i,e,r,s){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-e)*s|0)|t<<8))|t<<4))|t<<2))|t<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*s|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function _t(t){var i=t,e=t;do{(i.x<e.x||i.x===e.x&&i.y<e.y)&&(e=i),i=i.next}while(i!==t);return e}function wt(t,i,e,r,s,n,h,a){return(s-h)*(i-a)>=(t-h)*(n-a)&&(t-h)*(r-a)>=(e-h)*(i-a)&&(e-h)*(n-a)>=(s-h)*(r-a)}function bt(t,i){return t.next.i!==i.i&&t.prev.i!==i.i&&!function(t,i){var e=t;do{if(e.i!==t.i&&e.next.i!==t.i&&e.i!==i.i&&e.next.i!==i.i&&At(e,e.next,t,i))return!0;e=e.next}while(e!==t);return!1}(t,i)&&(St(t,i)&&St(i,t)&&function(t,i){var e=t,r=!1,s=(t.x+i.x)/2,n=(t.y+i.y)/2;do{e.y>n!=e.next.y>n&&e.next.y!==e.y&&s<(e.next.x-e.x)*(n-e.y)/(e.next.y-e.y)+e.x&&(r=!r),e=e.next}while(e!==t);return r}(t,i)&&(Mt(t.prev,t,i.prev)||Mt(t,i.prev,i))||Et(t,i)&&Mt(t.prev,t,t.next)>0&&Mt(i.prev,i,i.next)>0)}function Mt(t,i,e){return(i.y-t.y)*(e.x-i.x)-(i.x-t.x)*(e.y-i.y)}function Et(t,i){return t.x===i.x&&t.y===i.y}function At(t,i,e,r){var s=Rt(Mt(t,i,e)),n=Rt(Mt(t,i,r)),h=Rt(Mt(e,r,t)),a=Rt(Mt(e,r,i));return s!==n&&h!==a||(!(0!==s||!Tt(t,e,i))||(!(0!==n||!Tt(t,r,i))||(!(0!==h||!Tt(e,t,r))||!(0!==a||!Tt(e,i,r)))))}function Tt(t,i,e){return i.x<=Math.max(t.x,e.x)&&i.x>=Math.min(t.x,e.x)&&i.y<=Math.max(t.y,e.y)&&i.y>=Math.min(t.y,e.y)}function Rt(t){return t>0?1:t<0?-1:0}function St(t,i){return Mt(t.prev,t,t.next)<0?Mt(t,i,t.next)>=0&&Mt(t,t.prev,i)>=0:Mt(t,i,t.prev)<0||Mt(t,t.next,i)<0}function Ct(t,i){var e=new Lt(t.i,t.x,t.y),r=new Lt(i.i,i.x,i.y),s=t.next,n=i.prev;return t.next=i,i.prev=t,e.next=s,s.prev=e,r.next=e,e.prev=r,n.next=r,r.prev=n,r}function Ft(t,i,e,r){var s=new Lt(t,i,e);return r?(s.next=r.next,s.prev=r,r.next.prev=s,r.next=s):(s.prev=s,s.next=s),s}function Bt(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Lt(t,i,e){this.i=t,this.x=i,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}at.prototype.constructor=at,at.prototype.initContext=function(){var t=this.view.getContext('webgl',this._contextOptions)||this.view.getContext('experimental-webgl',this._contextOptions);if(this.gl=t,!t)throw new Error('This browser does not support webGL. Try using the canvas renderer');if(this.glContextId=t.id=at.glContextId++,Tiny.glContexts[this.glContextId]=t,Tiny.instances[this.glContextId]=this,t.disable(t.DEPTH_TEST),t.disable(t.CULL_FACE),t.enable(t.BLEND),!this.blendModes){var i={};i[p.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],i[p.ADD]=[t.ONE,t.DST_ALPHA],i[p.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA],i[p.SCREEN]=[t.ONE,t.ONE_MINUS_SRC_COLOR],i[p.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],i[p.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],i[p.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],i[p.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],i[p.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],i[p.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],i[p.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],i[p.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],i[p.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],i[p.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],i[p.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],i[p.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],i[p.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],this.blendModes=i}this.shaderManager.setContext(t),this.spriteBatch.setContext(t),this.maskManager.setContext(t),this.filterManager.setContext(t),this.blendModeManager.setContext(t),this.stencilManager.setContext(t),this.resize(this.width,this.height)},at.prototype.setClearColor=function(t){this.clearColor=new l(t),this.gl.clearColor(this.clearColor.r,this.clearColor.g,this.clearColor.b,this.clearColor.a)},at.prototype.render=function(t){if(!this.contextLost){t.updateTransform();var i=this.gl;i.viewport(0,0,this._width,this._height),i.bindFramebuffer(i.FRAMEBUFFER,null),this.clearBeforeRender&&(this.transparent&&i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT)),this.renderObject(t,this._projection)}},at.prototype.renderObject=function(t,i,e){this.blendModeManager.setBlendMode(p.NORMAL),this.drawCount=0,this.flipY=e?-1:1,this.projection=i||this._projection,this.spriteBatch.begin(this),this.filterManager.begin(this,e),t.render(this),this.spriteBatch.flush()},at.prototype.resize=function(t,i){this.width=t,this.height=i,this._width=t=Math.floor(t*this._resolution),this._height=i=Math.floor(i*this._resolution);var e=this.view;e.width=t,e.height=i,this.autoResize&&(e.style.width=this.width+'px',e.style.height=this.height+'px'),this.gl.viewport(0,0,t,i),this._projection.x=this.width/2,this._projection.y=-this.height/2},at.prototype.setPixelRatio=function(t){this._resolution=this.resolution=t,this.resize(this.width,this.height)},at.prototype.updateTexture=function(t){if(t.valid){var i=this.gl;return t._glTextures[i.id]||(t._glTextures[i.id]=i.createTexture()),i.bindTexture(i.TEXTURE_2D,t._glTextures[i.id]),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultipliedAlpha),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t.source),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,t.scaleMode===y.LINEAR?i.LINEAR:i.NEAREST),t.mipmap&&h(t.width)&&h(t.height)?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,t.scaleMode===y.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST),i.generateMipmap(i.TEXTURE_2D)):i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,t.scaleMode===y.LINEAR?i.LINEAR:i.NEAREST),t._powerOf2?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.REPEAT)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE)),t._dirty[i.id]=!1,t._glTextures[i.id]}},at.prototype.handleContextLost=function(t){t.preventDefault(),this.contextLost=!0},at.prototype.handleContextRestored=function(){for(var t in this.initContext(),C.image)C.image[t]._glTextures=[];this.contextLost=!1},at.prototype.destroy=function(t){this.view.removeEventListener('webglcontextlost',this.contextLostBound),this.view.removeEventListener('webglcontextrestored',this.contextRestoredBound),Tiny.glContexts[this.glContextId]=null,this.projection=null,this.offset=null,this.shaderManager.destroy(),this.spriteBatch.destroy(),this.maskManager.destroy(),this.filterManager.destroy(),this.shaderManager=null,this.spriteBatch=null,this.maskManager=null,this.filterManager=null,this.gl=null,!1!==t&&this.domElement.parentNode&&this.domElement.parentNode.removeChild(this.domElement)},at.glContextId=0;var zt=function(){};zt.renderGraphics=function(t,i){var e,r=i.gl,s=i.projection,n=i.offset,h=i.shaderManager.primitiveShader;t.dirty&&zt.updateGraphics(t,r);for(var a=t._webGL[r.id],o=0;o<a.data.length;o++)e=a.data[o],1===a.data[o].mode?(i.stencilManager.pushStencil(t,e,i),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,2*(e.indices.length-4)),i.stencilManager.popStencil(t,e,i)):(i.shaderManager.setShader(h),h=i.shaderManager.primitiveShader,r.uniformMatrix3fv(h.translationMatrix,!1,t.worldTransform.toArray(!0)),r.uniform1f(h.flipY,1),r.uniform2f(h.projectionVector,s.x,-s.y),r.uniform2f(h.offsetVector,-n.x,-n.y),r.uniform3fv(h.tintColor,t.tint.toArray()),r.uniform1f(h.alpha,t.worldAlpha),r.bindBuffer(r.ARRAY_BUFFER,e.buffer),r.vertexAttribPointer(h.aVertexPosition,2,r.FLOAT,!1,24,0),r.vertexAttribPointer(h.colorAttribute,4,r.FLOAT,!1,24,8),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e.indexBuffer),r.drawElements(r.TRIANGLE_STRIP,e.indices.length,r.UNSIGNED_SHORT,0))},zt.updateGraphics=function(t,i){var e,r,s=t._webGL[i.id];if(s||(s=t._webGL[i.id]={lastIndex:0,data:[],gl:i}),t.dirty=!1,t.clearDirty){for(t.clearDirty=!1,e=0;e<s.data.length;e++){var n=s.data[e];n.reset(),zt.graphicsDataPool.push(n)}s.data=[],s.lastIndex=0}for(e=s.lastIndex;e<t.graphicsData.length;e++){var h=t.graphicsData[e];h.type===m.POLY?(h.points=h.shape.points.slice(),h.shape.closed&&(h.points[0]===h.points[h.points.length-2]&&h.points[1]===h.points[h.points.length-1]||h.points.push(h.points[0],h.points[1])),h.fill&&h.points.length>=6&&(r=zt.switchMode(s,0),zt.buildPoly(h,r)),h.lineWidth>0&&(r=zt.switchMode(s,0),zt.buildLine(h,r))):(r=zt.switchMode(s,0),h.type===m.RECT?zt.buildRectangle(h,r):h.type===m.CIRC||h.type===m.ELIP?zt.buildCircle(h,r):h.type===m.RREC&&zt.buildRoundedRectangle(h,r)),s.lastIndex++}for(e=0;e<s.data.length;e++)(r=s.data[e]).dirty&&r.upload()},zt.switchMode=function(t,i){var e;return t.data.length&&(e=t.data[t.data.length-1]).mode===i&&1!==i||((e=zt.graphicsDataPool.pop()||new Ut(t.gl)).mode=i,t.data.push(e)),e.dirty=!0,e},zt.buildRectangle=function(t,i){var e=t.shape,r=e.x,s=e.y,n=e.width,h=e.height;if(t.fill){var a=t.fillColor,o=a.a,u=a.r*o,l=a.g*o,c=a.b*o,d=i.points,f=i.indices,p=d.length/6;d.push(r,s),d.push(u,l,c,o),d.push(r+n,s),d.push(u,l,c,o),d.push(r,s+h),d.push(u,l,c,o),d.push(r+n,s+h),d.push(u,l,c,o),f.push(p,p,p+1,p+2,p+3,p+3)}if(t.lineWidth){var y=t.points;t.points=[r,s,r+n,s,r+n,s+h,r,s+h,r,s],zt.buildLine(t,i),t.points=y}},zt.buildRoundedRectangle=function(t,i){var e=t.shape,r=e.x,s=e.y,n=e.width,h=e.height,a=e.radius,o=[];if(o.push(r,s+a),o=(o=(o=(o=o.concat(zt.quadraticBezierCurve(r,s+h-a,r,s+h,r+a,s+h))).concat(zt.quadraticBezierCurve(r+n-a,s+h,r+n,s+h,r+n,s+h-a))).concat(zt.quadraticBezierCurve(r+n,s+a,r+n,s,r+n-a,s))).concat(zt.quadraticBezierCurve(r+a,s,r,s,r,s+a)),t.fill){var u=t.fillColor,l=u.a,c=u.r*l,d=u.g*l,f=u.b*l,p=i.points,y=i.indices,m=p.length/6,x=ot(o,null,2),g=0;for(g=0;g<x.length;g+=3)y.push(x[g]+m),y.push(x[g]+m),y.push(x[g+1]+m),y.push(x[g+2]+m),y.push(x[g+2]+m);for(g=0;g<o.length;g++)p.push(o[g],o[++g],c,d,f,l)}if(t.lineWidth){var v=t.points;t.points=o,zt.buildLine(t,i),t.points=v}},zt.quadraticBezierCurve=function(t,i,e,r,s,n){var h,a,o,u,l,c,d=[];function f(t,i,e){return t+(i-t)*e}for(var p=0,y=0;y<=20;y++)h=f(t,e,p=y/20),a=f(i,r,p),o=f(e,s,p),u=f(r,n,p),l=f(h,o,p),c=f(a,u,p),d.push(l,c);return d},zt.buildCircle=function(t,i){var e,r,s=t.shape,n=s.x,h=s.y;t.type===m.CIRC?(e=s.radius,r=s.radius):(e=s.width,r=s.height);var a=2*Math.PI/40,o=0;if(t.fill){var u=t.fillColor,l=u.a,c=u.r*l,d=u.g*l,f=u.b*l,p=i.points,y=i.indices,x=p.length/6;for(y.push(x),o=0;o<41;o++)p.push(n,h,c,d,f,l),p.push(n+Math.sin(a*o)*e,h+Math.cos(a*o)*r,c,d,f,l),y.push(x++,x++);y.push(x-1)}if(t.lineWidth){var g=t.points;for(t.points=[],o=0;o<41;o++)t.points.push(n+Math.sin(a*o)*e,h+Math.cos(a*o)*r);zt.buildLine(t,i),t.points=g}},zt.buildLine=function(t,i){var e=0,r=t.points;if(0!==r.length){if(t.lineWidth%2)for(e=0;e<r.length;e++)r[e]+=.5;var s=new c(r[0],r[1]),n=new c(r[r.length-2],r[r.length-1]);if(s.x===n.x&&s.y===n.y){(r=r.slice()).pop(),r.pop();var h=(n=new c(r[r.length-2],r[r.length-1])).x+.5*(s.x-n.x),a=n.y+.5*(s.y-n.y);r.unshift(h,a),r.push(h,a)}var o,u,l,d,f,p,y,m,x,g,v,_,w,b,M,E,A,T,R,S,C,F,B=i.points,L=i.indices,z=r.length/2,U=r.length,P=B.length/6,O=t.lineWidth/2,I=t.lineColor,D=I.a,N=I.r*D,k=I.g*D,j=I.b*D;for(l=r[0],d=r[1],f=r[2],x=-(d-(p=r[3])),g=l-f,x/=F=Math.sqrt(x*x+g*g),g/=F,x*=O,g*=O,B.push(l-x,d-g,N,k,j,D),B.push(l+x,d+g,N,k,j,D),e=1;e<z-1;e++)l=r[2*(e-1)],d=r[2*(e-1)+1],f=r[2*e],p=r[2*e+1],y=r[2*(e+1)],m=r[2*(e+1)+1],x=-(d-p),g=l-f,x/=F=Math.sqrt(x*x+g*g),g/=F,x*=O,g*=O,v=-(p-m),_=f-y,v/=F=Math.sqrt(v*v+_*_),_/=F,A=(-x+l)*(-g+p)-(-x+f)*(-g+d),S=(-(v*=O)+y)*(-(_*=O)+p)-(-v+f)*(-_+m),C=(M=-g+d-(-g+p))*(R=-v+f-(-v+y))-(T=-_+m-(-_+p))*(E=-x+f-(-x+l)),Math.abs(C)<.1?(C+=10.1,B.push(f-x,p-g,N,k,j,D),B.push(f+x,p+g,N,k,j,D)):((o=(E*S-R*A)/C)-f)*(o-f)+((u=(T*A-M*S)/C)-p)+(u-p)>19600?(w=x-v,b=g-_,w/=F=Math.sqrt(w*w+b*b),b/=F,w*=O,b*=O,B.push(f-w,p-b),B.push(N,k,j,D),B.push(f+w,p+b),B.push(N,k,j,D),B.push(f-w,p-b),B.push(N,k,j,D),U++):(B.push(o,u),B.push(N,k,j,D),B.push(f-(o-f),p-(u-p)),B.push(N,k,j,D));for(l=r[2*(z-2)],d=r[2*(z-2)+1],f=r[2*(z-1)],x=-(d-(p=r[2*(z-1)+1])),g=l-f,x/=F=Math.sqrt(x*x+g*g),g/=F,x*=O,g*=O,B.push(f-x,p-g),B.push(N,k,j,D),B.push(f+x,p+g),B.push(N,k,j,D),L.push(P),e=0;e<U;e++)L.push(P++);L.push(P-1)}},zt.buildPoly=function(t,i){var e=t.points;if(!(e.length<6)){var r=i.points,s=i.indices,n=e.length/2,h=t.fillColor,a=h.a,o=h.r*a,u=h.g*a,l=h.b*a,c=ot(e,null,2);if(!c)return!1;var d=r.length/6,f=0;for(f=0;f<c.length;f+=3)s.push(c[f]+d),s.push(c[f]+d),s.push(c[f+1]+d),s.push(c[f+2]+d),s.push(c[f+2]+d);for(f=0;f<n;f++)r.push(e[2*f],e[2*f+1],o,u,l,a);return!0}},zt.graphicsDataPool=[];var Ut=function(t){this.gl=t,this.color=[0,0,0],this.points=[],this.indices=[],this.buffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),this.mode=1,this.alpha=1,this.dirty=!0};Ut.prototype.reset=function(){this.points=[],this.indices=[]},Ut.prototype.upload=function(){var t=this.gl;this.glPoints=new Float32Array(this.points),t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.bufferData(t.ARRAY_BUFFER,this.glPoints,t.STATIC_DRAW),this.glIndicies=new Uint16Array(this.indices),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.glIndicies,t.STATIC_DRAW),this.dirty=!1},Tiny.SpriteBatch=tt,Tiny.WebGLGraphics=zt,Tiny.Renderer=at;var Pt=2*Math.PI,Ot=function(){this.position=new c(0,0),this.scale=new c(1,1),this.pivot=new c(0,0),this.rotation=0,this.alpha=1,this.visible=!0,this.renderable=!1,this.parent=null,this.worldAlpha=1,this.worldTransform=new d,this._sr=0,this._cr=1,this._cacheAsBitmap=!1};Ot.prototype.constructor=Ot,Ot.prototype.destroy=function(){this.parent&&this.parent.remove(this),this.parent=null,this.worldTransform=null,this.visible=!1,this.renderable=!1,this._destroyCachedSprite()},Object.defineProperty(Ot.prototype,'worldVisible',{get:function(){var t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}}),Object.defineProperty(Ot.prototype,'cacheAsBitmap',{get:function(){return this._cacheAsBitmap},set:function(t){this._cacheAsBitmap!==t&&(t?this._generateCachedSprite():this._destroyCachedSprite(),this._cacheAsBitmap=t)}}),Ot.prototype.updateTransform=function(){if(this.parent){var t,i,e,r,s,n,h=this.parent.worldTransform,a=this.worldTransform;this.rotation%Pt?(this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),t=this._cr*this.scale.x,i=this._sr*this.scale.x,e=-this._sr*this.scale.y,r=this._cr*this.scale.y,s=this.position.x,n=this.position.y,(this.pivot.x||this.pivot.y)&&(s-=this.pivot.x*t+this.pivot.y*e,n-=this.pivot.x*i+this.pivot.y*r),a.a=t*h.a+i*h.c,a.b=t*h.b+i*h.d,a.c=e*h.a+r*h.c,a.d=e*h.b+r*h.d,a.tx=s*h.a+n*h.c+h.tx,a.ty=s*h.b+n*h.d+h.ty):(t=this.scale.x,r=this.scale.y,s=this.position.x-this.pivot.x*t,n=this.position.y-this.pivot.y*r,a.a=t*h.a,a.b=t*h.b,a.c=r*h.c,a.d=r*h.d,a.tx=s*h.a+n*h.c+h.tx,a.ty=s*h.b+n*h.d+h.ty),this.worldAlpha=this.alpha*this.parent.worldAlpha}},Ot.prototype.displayObjectUpdateTransform=Ot.prototype.updateTransform,Ot.prototype.getBounds=function(t){return U},Ot.prototype.getLocalBounds=function(){return this.getBounds(f)},Ot.prototype.generateTexture=function(t,i){var e=this.getLocalBounds(),r=new Tiny.RenderTexture(0|e.width,0|e.height,i,t);return Ot._tempMatrix.tx=-e.x,Ot._tempMatrix.ty=-e.y,r.render(this,Ot._tempMatrix),r},Ot.prototype.updateCache=function(){this._generateCachedSprite()},Ot.prototype.toGlobal=function(t){return this.displayObjectUpdateTransform(),this.worldTransform.apply(t)},Ot.prototype.toLocal=function(t,i){return i&&(t=i.toGlobal(t)),this.displayObjectUpdateTransform(),this.worldTransform.applyInverse(t)},Ot.prototype._renderCachedSprite=function(t){this._cachedSprite.worldAlpha=this.worldAlpha,t.gl?Tiny.Sprite.prototype.render.call(this._cachedSprite,t):Tiny.Sprite.prototype.renderCanvas.call(this._cachedSprite,t)},Ot.prototype._generateCachedSprite=function(){this._cachedSprite=null,this._cacheAsBitmap=!1;var t=this.getLocalBounds(),i=new Tiny.RenderTexture(0|t.width,0|t.height);this._cachedSprite=new Tiny.Sprite(i),this._cachedSprite.worldTransform=this.worldTransform;var e=this._filters;this._filters=null,this._cachedSprite.filters=e,Ot._tempMatrix.tx=-t.x,Ot._tempMatrix.ty=-t.y,this._cachedSprite.texture.render(this,Ot._tempMatrix,!0),this._cachedSprite.anchor.x=-t.x/t.width,this._cachedSprite.anchor.y=-t.y/t.height,this._cacheAsBitmap=!0},Ot.prototype._destroyCachedSprite=function(){this._cachedSprite&&(this._cachedSprite.texture.destroy(!0),this._cachedSprite=null)},Ot.prototype.render=function(t){},Object.defineProperty(Ot.prototype,'x',{get:function(){return this.position.x},set:function(t){this.position.x=t}}),Object.defineProperty(Ot.prototype,'y',{get:function(){return this.position.y},set:function(t){this.position.y=t}}),Ot._tempMatrix=new d;var It=function(){Ot.call(this),this.children=[],this._bounds=new z(0,0,1,1),this._currentBounds=null,this._mask=null};(It.prototype=Object.create(Ot.prototype)).constructor=It,Object.defineProperty(It.prototype,'width',{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(t){var i=this.getLocalBounds().width;this.scale.x=0!==i?t/i:1,this._width=t}}),Object.defineProperty(It.prototype,'height',{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(t){var i=this.getLocalBounds().height;this.scale.y=0!==i?t/i:1,this._height=t}}),Object.defineProperty(It.prototype,'mask',{get:function(){return this._mask},set:function(t){this._mask&&(this._mask.isMask=!1),this._mask=t,this._mask&&(this._mask.isMask=!0)}}),It.prototype.destroy=function(){for(var t=this.children.length;t--;)this.children[t].destroy();this.children=[],Ot.prototype.destroy.call(this),this._bounds=null,this._currentBounds=null,this._mask=null,this.input&&this.input.system.remove(this)},It.prototype.add=function(t){return this.addChildAt(t,this.children.length)},It.prototype.addChildAt=function(t,i){if(i>=0&&i<=this.children.length)return t.parent&&t.parent.remove(t),t.parent=this,this.game&&(t.game=this.game),this.children.splice(i,0,t),t;throw new Error(t+'addChildAt: The index '+i+' supplied is out of bounds '+this.children.length)},It.prototype.swapChildren=function(t,i){if(t!==i){var e=this.getChildIndex(t),r=this.getChildIndex(i);if(e<0||r<0)throw new Error('swapChildren: Both the supplied Objects must be a child of the caller.');this.children[e]=i,this.children[r]=t}},It.prototype.getChildIndex=function(t){var i=this.children.indexOf(t);if(-1===i)throw new Error('The supplied Object must be a child of the caller');return i},It.prototype.setChildIndex=function(t,i){if(i<0||i>=this.children.length)throw new Error('The supplied index is out of bounds');var e=this.getChildIndex(t);this.children.splice(e,1),this.children.splice(i,0,t)},It.prototype.getChildAt=function(t){if(t<0||t>=this.children.length)throw new Error('getChildAt: Supplied index '+t+' does not exist in the child list, or the supplied Object must be a child of the caller');return this.children[t]},It.prototype.remove=function(t){var i=this.children.indexOf(t);if(-1!==i)return this.removeChildAt(i)},It.prototype.removeChildAt=function(t){var i=this.getChildAt(t);return i.parent=void 0,this.children.splice(t,1),i},It.prototype.updateTransform=function(){if(this.visible&&(this.displayObjectUpdateTransform(),!this._cacheAsBitmap))for(var t=0,i=this.children.length;t<i;t++)this.children[t].updateTransform()},It.prototype.displayObjectContainerUpdateTransform=It.prototype.updateTransform,It.prototype.getBounds=function(){if(0===this.children.length)return U;if(this._cachedSprite)return this._cachedSprite.getBounds();for(var t,i,e,r=1/0,s=1/0,n=-1/0,h=-1/0,a=!1,o=0,u=this.children.length;o<u;o++){this.children[o].visible&&(a=!0,r=r<(t=this.children[o].getBounds()).x?r:t.x,s=s<t.y?s:t.y,n=n>(i=t.width+t.x)?n:i,h=h>(e=t.height+t.y)?h:e)}if(!a)return U;var l=this._bounds;return l.x=r,l.y=s,l.width=n-r,l.height=h-s,l},It.prototype.getLocalBounds=function(){var t=this.worldTransform;this.worldTransform=f;for(var i=0,e=this.children.length;i<e;i++)this.children[i].updateTransform();var r=this.getBounds();return this.worldTransform=t,r},It.prototype.render=function(t){var i,e;if(this.visible&&!(this.alpha<=0))if(this._cacheAsBitmap)this._renderCachedSprite(t);else if(this._mask||this._filters){for(this._filters&&(t.spriteBatch.flush(),t.filterManager.pushFilter(this._filterBlock)),this._mask&&(t.spriteBatch.stop(),t.maskManager.pushMask(this.mask,t),t.spriteBatch.start()),i=0,e=this.children.length;i<e;i++)this.children[i].render(t);t.spriteBatch.stop(),this._mask&&t.maskManager.popMask(this._mask,t),this._filters&&t.filterManager.popFilter(),t.spriteBatch.start()}else for(i=0,e=this.children.length;i<e;i++)this.children[i].render(t)};var Dt=function(t){It.call(this),this.game=t};(Dt.prototype=Object.create(It.prototype)).constructor=Dt,Dt.prototype.updateTransform=function(){this.worldAlpha=1;for(var t=0,i=this.children.length;t<i;t++)this.children[t].updateTransform()};var Nt=function(t,i){It.call(this),this.anchor=new c,this.setTexture(t,i,!1),this._width=0,this._height=0,this.tint=new l,this.blendMode=p.NORMAL,this.texture.valid&&this.onTextureUpdate(),this.renderable=!0};(Nt.prototype=Object.create(It.prototype)).constructor=Nt,Object.defineProperty(Nt.prototype,'frameName',{get:function(){return this.texture.frame.name},set:function(t){this.texture.frame.name&&this.setTexture(C.texture[this.texture.key+'.'+t])}}),Object.defineProperty(Nt.prototype,'width',{get:function(){return this.scale.x*this.texture.frame.width},set:function(t){this.scale.x=t/this.texture.frame.width,this._width=t}}),Object.defineProperty(Nt.prototype,'height',{get:function(){return this.scale.y*this.texture.frame.height},set:function(t){this.scale.y=t/this.texture.frame.height,this._height=t}}),Nt.prototype.setTexture=function(t,i,e){if('string'==typeof t){var r=t;null!=i&&(r=r+'.'+i),(t=C.texture[r])||(t=new O(r))}return this.texture!==t&&(this.texture=t,this.cachedTint='#ffffff',!0===e&&this.onTextureUpdate(),!0)},Nt.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width),this._height&&(this.scale.y=this._height/this.texture.frame.height)},Nt.prototype.getBounds=function(t){var i=this.texture.frame.width/this.texture.base.resolution,e=this.texture.frame.height/this.texture.base.resolution,r=i*(1-this.anchor.x),s=i*-this.anchor.x,n=e*(1-this.anchor.y),h=e*-this.anchor.y,a=t||this.worldTransform,o=a.a,u=a.b,l=a.c,c=a.d,d=a.tx,f=a.ty,p=-1/0,y=-1/0,m=1/0,x=1/0;if(0===u&&0===l)o<0?(m=o*r+d,p=o*s+d):(m=o*s+d,p=o*r+d),c<0?(x=c*n+f,y=c*h+f):(x=c*h+f,y=c*n+f);else{var g=o*s+l*h+d,v=c*h+u*s+f,_=o*r+l*h+d,w=c*h+u*r+f,b=o*r+l*n+d,M=c*n+u*r+f,E=o*s+l*n+d,A=c*n+u*s+f;m=E<(m=b<(m=_<(m=g<m?g:m)?_:m)?b:m)?E:m,x=A<(x=M<(x=w<(x=v<x?v:x)?w:x)?M:x)?A:x,p=E>(p=b>(p=_>(p=g>p?g:p)?_:p)?b:p)?E:p,y=A>(y=M>(y=w>(y=v>y?v:y)?w:y)?M:y)?A:y}var T=this._bounds;return T.x=m,T.width=p-m,T.y=x,T.height=y-x,this._currentBounds=T,T},Nt.prototype.render=function(t){var i,e;if(this.visible&&!(this.alpha<=0))if(this._mask||this._filters){var r=t.spriteBatch;for(this._filters&&(r.flush(),t.filterManager.pushFilter(this._filterBlock)),this._mask&&(r.stop(),t.maskManager.pushMask(this.mask,t),r.start()),r.render(this),i=0,e=this.children.length;i<e;i++)this.children[i].render(t);r.stop(),this._mask&&t.maskManager.popMask(this._mask,t),this._filters&&t.filterManager.popFilter(),r.start()}else for(t.spriteBatch.render(this),i=0,e=this.children.length;i<e;i++)this.children[i].render(t)};var kt=function(t,i){this.canvas=document.createElement('canvas'),this.context=this.canvas.getContext('2d'),this.resolution=1,Nt.call(this,new O(this.canvas)),this.setText(t),this.setStyle(i)};(kt.prototype=Object.create(Nt.prototype)).constructor=kt,Object.defineProperty(kt.prototype,'width',{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.x*this.texture.frame.width},set:function(t){this.scale.x=t/this.texture.frame.width,this._width=t}}),Object.defineProperty(kt.prototype,'height',{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.y*this.texture.frame.height},set:function(t){this.scale.y=t/this.texture.frame.height,this._height=t}}),kt.prototype.setStyle=function(t){(t=t||{}).font=t.font||'bold 20pt Arial',t.fill=t.fill||'black',t.align=t.align||'left',t.stroke=t.stroke||'black',t.strokeThickness=t.strokeThickness||0,t.wordWrap=t.wordWrap||!1,t.lineSpacing=t.lineSpacing||0,t.wordWrapWidth=void 0!==t.wordWrapWidth?t.wordWrapWidth:100,t.dropShadow=t.dropShadow||!1,t.dropShadowAngle=void 0!==t.dropShadowAngle?t.dropShadowAngle:Math.PI/6,t.dropShadowDistance=void 0!==t.dropShadowDistance?t.dropShadowDistance:4,t.dropShadowColor=t.dropShadowColor||'black',this.style=t,this.dirty=!0},kt.prototype.setText=function(t){this.text=t.toString()||' ',this.dirty=!0},kt.prototype.updateText=function(){this.texture.base.resolution=this.resolution,this.context.font=this.style.font;var t=this.text;this.style.wordWrap&&(t=this.wordWrap(this.text));for(var i=t.split(/(?:\r\n|\r|\n)/),e=[],r=0,s=this.determineFontProperties(this.style.font),n=0;n<i.length;n++){var h=this.context.measureText(i[n]).width;e[n]=h,r=Math.max(r,h)}var a=r+this.style.strokeThickness;this.style.dropShadow&&(a+=this.style.dropShadowDistance),this.canvas.width=(a+this.context.lineWidth)*this.resolution;var o,u,l=s.fontSize+this.style.strokeThickness+this.style.lineSpacing,c=l*i.length;if(this.style.dropShadow&&(c+=this.style.dropShadowDistance),this.canvas.height=(c-this.style.lineSpacing)*this.resolution,this.context.scale(this.resolution,this.resolution),navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.lineWidth=this.style.strokeThickness,this.context.textBaseline='alphabetic',this.context.miterLimit=2,this.style.dropShadow){this.context.fillStyle=this.style.dropShadowColor;var d=Math.sin(this.style.dropShadowAngle)*this.style.dropShadowDistance,f=Math.cos(this.style.dropShadowAngle)*this.style.dropShadowDistance;for(n=0;n<i.length;n++)o=this.style.strokeThickness/2,u=this.style.strokeThickness/2+n*l+s.ascent,'right'===this.style.align?o+=r-e[n]:'center'===this.style.align&&(o+=(r-e[n])/2),this.style.fill&&this.context.fillText(i[n],o+d,u+f)}for(this.context.fillStyle=this.style.fill,n=0;n<i.length;n++)o=this.style.strokeThickness/2,u=this.style.strokeThickness/2+n*l+s.ascent,'right'===this.style.align?o+=r-e[n]:'center'===this.style.align&&(o+=(r-e[n])/2),this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(i[n],o,u),this.style.fill&&this.context.fillText(i[n],o,u);this.updateTexture()},kt.prototype.updateTexture=function(){this.texture.width=this.canvas.width,this.texture.height=this.canvas.height,this.texture.crop.width=this.texture.frame.width=this.canvas.width,this.texture.crop.height=this.texture.frame.height=this.canvas.height,this._width=this.canvas.width,this._height=this.canvas.height,this.texture.base.dirty()},kt.prototype.render=function(t){(this.dirty||this.resolution!==t.resolution)&&(this.resolution=t.resolution,this.updateText(),this.dirty=!1),Nt.prototype.render.call(this,t)},kt.prototype.determineFontProperties=function(t){var i=kt.fontPropertiesCache[t];if(!i){i={};var e=kt.fontPropertiesCanvas,r=kt.fontPropertiesContext;r.font=t;var s=Math.ceil(r.measureText('|MÉq').width),n=Math.ceil(r.measureText('|MÉq').width),h=2*n;n=1.4*n|0,e.width=s,e.height=h,r.fillStyle='#f00',r.fillRect(0,0,s,h),r.font=t,r.textBaseline='alphabetic',r.fillStyle='#000',r.fillText('|MÉq',0,n);var a,o,u=r.getImageData(0,0,s,h).data,l=u.length,c=4*s,d=0,f=!1;for(a=0;a<n;a++){for(o=0;o<c;o+=4)if(255!==u[d+o]){f=!0;break}if(f)break;d+=c}for(i.ascent=n-a,d=l-c,f=!1,a=h;a>n;a--){for(o=0;o<c;o+=4)if(255!==u[d+o]){f=!0;break}if(f)break;d-=c}i.descent=a-n,i.descent+=6,i.fontSize=i.ascent+i.descent,kt.fontPropertiesCache[t]=i}return i},kt.prototype.wordWrap=function(t){for(var i='',e=t.split('\n'),r=0;r<e.length;r++){for(var s=this.style.wordWrapWidth,n=e[r].split(' '),h=0;h<n.length;h++){var a=this.context.measureText(n[h]).width,o=a+this.context.measureText(' ').width;0===h||o>s?(h>0&&(i+='\n'),i+=n[h],s=this.style.wordWrapWidth-a):(s-=o,i+=' '+n[h])}r<e.length-1&&(i+='\n')}return i},kt.prototype.getBounds=function(t){return this.dirty&&(this.updateText(),this.dirty=!1),Nt.prototype.getBounds.call(this,t)},kt.prototype.destroy=function(){this.context=null,this.canvas=null,this.texture.destroy(),Nt.prototype.destroy.call(this)},kt.fontPropertiesCache={},kt.fontPropertiesCanvas=document.createElement('canvas'),kt.fontPropertiesContext=kt.fontPropertiesCanvas.getContext('2d');var jt=function(t,i,e){this.x=t||0,this.y=i||0,this.radius=e||0,this.type=m.CIRC};(jt.prototype={contains:function(t,i){if(this.radius<=0)return!1;var e=this.x-t,r=this.y-i;return(e*=e)+(r*=r)<=this.radius*this.radius},getBounds:function(){return new PIXI.Rectangle(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)}}).constructor=jt;var Vt=function(t){if(t instanceof Array||(t=Array.prototype.slice.call(arguments)),'number'!=typeof t[0]){for(var i=[],e=0,r=t.length;e<r;e++)i.push(t[e].x,t[e].y);t=i}this.closed=!0,this.points=t,this.type=m.POLY};Vt.prototype={toNumberArray:function(t){void 0===t&&(t=[]);for(var i=0;i<this.points.length;i++)'number'==typeof this.points[i]?(t.push(this.points[i]),t.push(this.points[i+1]),i++):(t.push(this.points[i].x),t.push(this.points[i].y));return t},flatten:function(){return this.points=this.toNumberArray(),this},contains:function(t,i){for(var e=!1,r=this.points.length/2,s=0,n=r-1;s<r;n=s++){var h=this.points[2*s],a=this.points[2*s+1],o=this.points[2*n],u=this.points[2*n+1];a>i!=u>i&&t<(o-h)*(i-a)/(u-a)+h&&(e=!e)}return e}},Vt.prototype.constructor=Vt;var Gt=function(t,i,e,r,s){this.x=t||0,this.y=i||0,this.width=e||0,this.height=r||0,this.radius=s||0,this.type=m.RREC};Gt.prototype.contains=function(t,i){if(this.width<=0||this.height<=0)return!1;var e=this.x;if(t>=e&&t<=e+this.width){var r=this.y;if(i>=r&&i<=r+this.height)return!0}return!1},Gt.prototype.constructor=Gt;var Yt=function(t,i,e,r,s){this.lineWidth=t,this.lineColor=i,this._lineTint=i,this.fillColor=e,this._fillTint=e,this.fill=r,this.shape=s,this.type=s.type};Yt.prototype.constructor=Yt;var Xt=function(){It.call(this),this.renderable=!0,this.lineWidth=0,this.lineColor=new l,this.graphicsData=[],this.tint=new l,this.blendMode=p.NORMAL,this.currentPath=null,this._webGL=[],this.isMask=!1,this.boundsPadding=0,this._localBounds=new z(0,0,1,1),this.dirty=!0,this.webGLDirty=!1,this.cachedSpriteDirty=!1};(Xt.prototype=Object.create(It.prototype)).constructor=Xt,Object.defineProperty(Xt.prototype,'cacheAsBitmap',{get:function(){return this._cacheAsBitmap},set:function(t){this._cacheAsBitmap=t,this._cacheAsBitmap?this._generateCachedSprite():(this.destroyCachedSprite(),this.dirty=!0)}}),Object.assign(Xt.prototype,{lineStyle:function(t,i,e){if(this.lineWidth=t||0,this.lineColor=new l(i||0),void 0!==e&&(this.lineColor.a=e),this.currentPath){if(this.currentPath.shape.points.length)return this.drawShape(new Vt(this.currentPath.shape.points.slice(-2))),this;this.currentPath.lineWidth=this.lineWidth,this.currentPath.lineColor=this.lineColor}return this},moveTo:function(t,i){return this.drawShape(new Vt([t,i])),this},lineTo:function(t,i){return this.currentPath||this.moveTo(0,0),this.currentPath.shape.points.push(t,i),this.dirty=!0,this},quadraticCurveTo:function(t,i,e,r){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var s,n,h=this.currentPath.shape.points;0===h.length&&this.moveTo(0,0);for(var a=h[h.length-2],o=h[h.length-1],u=0,l=1;l<=20;l++)s=a+(t-a)*(u=l/20),n=o+(i-o)*u,h.push(s+(t+(e-t)*u-s)*u,n+(i+(r-i)*u-n)*u);return this.dirty=!0,this},bezierCurveTo:function(t,i,e,r,s,n){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);for(var h,a,o,u,l,c=this.currentPath.shape.points,d=c[c.length-2],f=c[c.length-1],p=0,y=1;y<=20;y++)o=(a=(h=1-(p=y/20))*h)*h,l=(u=p*p)*p,c.push(o*d+3*a*p*t+3*h*u*e+l*s,o*f+3*a*p*i+3*h*u*r+l*n);return this.dirty=!0,this},arcTo:function(t,i,e,r,s){this.currentPath?0===this.currentPath.shape.points.length&&this.currentPath.shape.points.push(t,i):this.moveTo(t,i);var n=this.currentPath.shape.points,h=n[n.length-2],a=n[n.length-1]-i,o=h-t,u=r-i,l=e-t,c=Math.abs(a*l-o*u);if(c<1e-8||0===s)n[n.length-2]===t&&n[n.length-1]===i||n.push(t,i);else{var d=a*a+o*o,f=u*u+l*l,p=a*u+o*l,y=s*Math.sqrt(d)/c,m=s*Math.sqrt(f)/c,x=y*p/d,g=m*p/f,v=y*l+m*o,_=y*u+m*a,w=o*(m+x),b=a*(m+x),M=l*(y+g),E=u*(y+g),A=Math.atan2(b-_,w-v),T=Math.atan2(E-_,M-v);this.arc(v+t,_+i,s,A,T,o*u>l*a)}return this.dirty=!0,this},arc:function(t,i,e,r,s,n){if(r===s)return this;!(n=n||!1)&&s<=r?s+=2*Math.PI:n&&r<=s&&(r+=2*Math.PI);var h=n?-1*(r-s):s-r,a=Math.abs(h)/(2*Math.PI)*40;if(0===h)return this;var o=t+Math.cos(r)*e,u=i+Math.sin(r)*e;n&&this.filling?this.moveTo(t,i):this.moveTo(o,u);for(var l=this.currentPath.shape.points,c=h/(2*a),d=2*c,f=Math.cos(c),p=Math.sin(c),y=a-1,m=y%1/y,x=0;x<=y;x++){var g=c+r+d*(x+m*x),v=Math.cos(g),_=-Math.sin(g);l.push((f*v+p*_)*e+t,(f*-_+p*v)*e+i)}return this.dirty=!0,this},beginFill:function(t,i){return this.filling=!0,this.fillColor=new l(t||0),void 0!==i&&(this.fillColor.a=i),this.currentPath&&this.currentPath.shape.points.length<=2&&(this.currentPath.fill=this.filling,this.currentPath.fillColor=this.fillColor),this},endFill:function(){return this.filling=!1,this.fillColor=null,this},drawRect:function(t,i,e,r){return this.drawShape(new z(t,i,e,r)),this},drawRoundedRect:function(t,i,e,r,s){return this.drawShape(new Gt(t,i,e,r,s)),this},drawCircle:function(t,i,e){return this.drawShape(new jt(t,i,e)),this},drawPolygon:function(t){return t instanceof Array||(t=Array.prototype.slice.call(arguments)),this.drawShape(new Vt(t)),this},clear:function(){return this.lineWidth=0,this.filling=!1,this.dirty=!0,this.clearDirty=!0,this.graphicsData=[],this},render:function(t){if(!1!==this.visible&&0!==this.alpha&&!0!==this.isMask){if(this._cacheAsBitmap)return(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1),this._cachedSprite.worldAlpha=this.worldAlpha,void Nt.prototype.render.call(this._cachedSprite,t);if(t.spriteBatch.stop(),t.blendModeManager.setBlendMode(this.blendMode),this._mask&&t.maskManager.pushMask(this._mask,t),this._filters&&t.filterManager.pushFilter(this._filterBlock),this.blendMode!==t.spriteBatch.currentBlendMode){t.spriteBatch.currentBlendMode=this.blendMode;var i=t.blendModes[t.spriteBatch.currentBlendMode];t.spriteBatch.gl.blendFunc(i[0],i[1])}if(this.webGLDirty&&(this.dirty=!0,this.webGLDirty=!1),Tiny.WebGLGraphics.renderGraphics(this,t),this.children.length){t.spriteBatch.start();for(var e=0,r=this.children.length;e<r;e++)this.children[e].render(t);t.spriteBatch.stop()}this._filters&&t.filterManager.popFilter(),this._mask&&t.maskManager.popMask(this.mask,t),t.drawCount++,t.spriteBatch.start()}},getBounds:function(t){if(this.isMask)return U;this.dirty&&(this.updateLocalBounds(),this.webGLDirty=!0,this.cachedSpriteDirty=!0,this.dirty=!1);var i=this._localBounds,e=i.x,r=i.width+i.x,s=i.y,n=i.height+i.y,h=t||this.worldTransform,a=h.a,o=h.b,u=h.c,l=h.d,c=h.tx,d=h.ty,f=a*r+u*n+c,p=l*n+o*r+d,y=a*e+u*n+c,m=l*n+o*e+d,x=a*e+u*s+c,g=l*s+o*e+d,v=a*r+u*s+c,_=l*s+o*r+d,w=f,b=p,M=f,E=p;return M=v<(M=x<(M=y<M?y:M)?x:M)?v:M,E=_<(E=g<(E=m<E?m:E)?g:E)?_:E,w=v>(w=x>(w=y>w?y:w)?x:w)?v:w,b=_>(b=g>(b=m>b?m:b)?g:b)?_:b,this._bounds.x=M,this._bounds.width=w-M,this._bounds.y=E,this._bounds.height=b-E,this._bounds},updateLocalBounds:function(){var t=1/0,i=-1/0,e=1/0,r=-1/0;if(this.graphicsData.length)for(var s,n,h,a,o,u,l=0;l<this.graphicsData.length;l++){var c=this.graphicsData[l],d=c.type,f=c.lineWidth;if(s=c.shape,d===m.RECT||d===m.RREC||d===m.ELIP)h=s.x-f/2,a=s.y-f/2,t=h<t?h:t,i=h+(o=s.width+f)>i?h+o:i,e=a<e?a:e,r=a+(u=s.height+f)>r?a+u:r;else if(d===m.CIRC)h=s.x,a=s.y,t=h-(o=s.radius+f/2)<t?h-o:t,i=h+o>i?h+o:i,e=a-(u=s.radius+f/2)<e?a-u:e,r=a+u>r?a+u:r;else{n=s.points;for(var p=0;p<n.length;p+=2)t=(h=n[p])-f<t?h-f:t,i=h+f>i?h+f:i,e=(a=n[p+1])-f<e?a-f:e,r=a+f>r?a+f:r}}else t=0,i=0,e=0,r=0;var y=this.boundsPadding;this._localBounds.x=t-y,this._localBounds.width=i-t+2*y,this._localBounds.y=e-y,this._localBounds.height=r-e+2*y},drawShape:function(t){this.currentPath&&this.currentPath.shape.points.length<=2&&this.graphicsData.pop(),this.currentPath=null,t.type===m.POLY&&t.flatten();var i=new Yt(this.lineWidth,this.lineColor,this.fillColor,this.filling,t);return this.graphicsData.push(i),i.type===m.POLY&&(i.shape.closed=this.filling,this.currentPath=i),this.dirty=!0,i}});var Wt=function(t,i,e,r){this.gl=t,this.frameBuffer=t.createFramebuffer(),this.texture=t.createTexture(),r=r||0,t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,r===y.LINEAR?t.LINEAR:t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,r===y.LINEAR?t.LINEAR:t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer),t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,0),this.renderBuffer=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this.renderBuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.renderBuffer),this.resize(i,e)};Wt.prototype.constructor=Wt,Wt.prototype.clear=function(){var t=this.gl;t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT)},Wt.prototype.resize=function(t,i){if(this.width!==t||this.height!==i){this.width=t,this.height=i;var e=this.gl;e.bindTexture(e.TEXTURE_2D,this.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,i,0,e.RGBA,e.UNSIGNED_BYTE,null),e.bindRenderbuffer(e.RENDERBUFFER,this.renderBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t,i)}},Wt.prototype.destroy=function(){var t=this.gl;t.deleteFramebuffer(this.frameBuffer),t.deleteTexture(this.texture),this.frameBuffer=null,this.texture=null};var Ht=function(i,e,r,s,n){this.width=i||100,this.height=e||100,s=s||1;var h=Math.max(1,s),a=new B;if(a.width=this.width*h,a.height=this.height*h,a.resolution=s,a.scaleMode=n||0,a.valid=!0,window.rt=this,this.renderer=r||Tiny.defaultRenderer,this.renderer.gl){var o=this.renderer.gl;a._dirty[o.id]=!1,this.textureBuffer=new Wt(o,this.width*s,this.height*s,a.scaleMode),a._glTextures[o.id]=this.textureBuffer.texture,this.projection=new c(this.width*h*.5,-this.height*h*.5)}else this.render=this.renderCanvas,this.textureBuffer=new t(this.width*s,this.height*s),a.source=this.textureBuffer.canvas;O.call(this,a,new z(0,0,Math.floor(this.width*s),Math.floor(this.height*s))),this.valid=!0,this._updateUvs()};(Ht.prototype=Object.create(O.prototype)).constructor=Ht,Ht.prototype.resize=function(t,i,e){t===this.width&&i===this.height||(this.valid=t>0&&i>0,this.width=t,this.height=i,this.frame.width=this.crop.width=t*this.base.resolution,this.frame.height=this.crop.height=i*this.base.resolution,e&&(this.base.width=this.width*this.base.resolution,this.base.height=this.height*this.base.resolution),this.renderer.gl&&(this.projection.x=this.width/2,this.projection.y=-this.height/2),this.valid&&this.textureBuffer.resize(this.width,this.height))},Ht.prototype.clear=function(){this.valid&&(this.renderer.gl&&this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer),this.textureBuffer.clear())},Ht.prototype.render=function(t,i,e){if(this.valid){var r=t.worldTransform;r.identity(),r.translate(0,2*this.projection.y),i&&r.append(i),r.scale(1,-1),t.worldAlpha=1;for(var s=t.children,n=0,h=s.length;n<h;n++)s[n].updateTransform();var a=this.renderer.gl;a.viewport(0,0,this.width*this.base.resolution,this.height*this.base.resolution),a.bindFramebuffer(a.FRAMEBUFFER,this.textureBuffer.frameBuffer),e&&this.textureBuffer.clear(),this.renderer.spriteBatch.dirty=!0;var o=this.renderer.resolution;this.renderer.resolution=this.base.resolution,this.renderer.renderObject(t,this.projection,this.textureBuffer.frameBuffer),this.renderer.resolution=o,this.renderer.spriteBatch.dirty=!0,r.identity()}},Ht.prototype.getImage=function(){var t=new Image;return t.src=this.getBase64(),t},Ht.prototype.getBase64=function(){return this.getCanvas().toDataURL()},Ht.prototype.getCanvas=function(){if(this.renderer.gl){var i=this.renderer.gl,e=this.textureBuffer.width,r=this.textureBuffer.height,s=new Uint8Array(4*e*r);i.bindFramebuffer(i.FRAMEBUFFER,this.textureBuffer.frameBuffer),i.readPixels(0,0,e,r,i.RGBA,i.UNSIGNED_BYTE,s),i.bindFramebuffer(i.FRAMEBUFFER,null);var n=new t(e,r),h=n.context.getImageData(0,0,e,r);return h.data.set(s),n.context.putImageData(h,0,0),n.canvas}return this.textureBuffer.canvas},Tiny.BaseObject2D=Ot,Tiny.Object2D=It,Tiny.Scene=Dt,Tiny.Sprite=Nt,Tiny.Text=kt,Tiny.Graphics=Xt,Tiny.BaseTexture=B,Tiny.TextureUvs=P,Tiny.Texture=O,Tiny.RenderTexture=Ht,Tiny.Rectangle=z;for(var qt=[],Zt=0;Zt<256;Zt++)qt[Zt]=(Zt<16?'0':'')+Zt.toString(16);var Kt={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,e=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(qt[255&t]+qt[t>>8&255]+qt[t>>16&255]+qt[t>>24&255]+'-'+qt[255&i]+qt[i>>8&255]+'-'+qt[i>>16&15|64]+qt[i>>24&255]+'-'+qt[63&e|128]+qt[e>>8&255]+'-'+qt[e>>16&255]+qt[e>>24&255]+qt[255&r]+qt[r>>8&255]+qt[r>>16&255]+qt[r>>24&255]).toUpperCase()},clamp:function(t,i,e){return Math.max(i,Math.min(e,t))},euclideanModulo:function(t,i){return(t%i+i)%i},mapLinear:function(t,i,e,r,s){return r+(t-i)*(s-r)/(e-i)},lerp:function(t,i,e){return(1-e)*t+e*i},smoothstep:function(t,i,e){return t<=i?0:t>=e?1:(t=(t-i)/(e-i))*t*(3-2*t)},smootherstep:function(t,i,e){return t<=i?0:t>=e?1:(t=(t-i)/(e-i))*t*t*(t*(6*t-15)+10)},randInt:function(t,i){return t+Math.floor(Math.random()*(i-t+1))},randFloat:function(t,i){return t+Math.random()*(i-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*Kt.DEG2RAD},radToDeg:function(t){return t*Kt.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}};function Qt(t,i,e,r){this._x=t||0,this._y=i||0,this._z=e||0,this._w=void 0!==r?r:1}Object.assign(Qt,{slerp:function(t,i,e,r){return e.copy(t).slerp(i,r)},slerpFlat:function(t,i,e,r,s,n,h){var a=e[r+0],o=e[r+1],u=e[r+2],l=e[r+3],c=s[n+0],d=s[n+1],f=s[n+2],p=s[n+3];if(l!==p||a!==c||o!==d||u!==f){var y=1-h,m=a*c+o*d+u*f+l*p,x=m>=0?1:-1,g=1-m*m;if(g>Number.EPSILON){var v=Math.sqrt(g),_=Math.atan2(v,m*x);y=Math.sin(y*_)/v,h=Math.sin(h*_)/v}var w=h*x;if(a=a*y+c*w,o=o*y+d*w,u=u*y+f*w,l=l*y+p*w,y===1-h){var b=1/Math.sqrt(a*a+o*o+u*u+l*l);a*=b,o*=b,u*=b,l*=b}}t[i]=a,t[i+1]=o,t[i+2]=u,t[i+3]=l}}),Object.defineProperties(Qt.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(t){this._w=t,this._onChangeCallback()}}}),Object.assign(Qt.prototype,{isQuaternion:!0,set:function(t,i,e,r){return this._x=t,this._y=i,this._z=e,this._w=r,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this},setFromEuler:function(t,i){if(!t||!t.isEuler)throw new Error('Tiny.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.');var e=t._x,r=t._y,s=t._z,n=t.order,h=Math.cos,a=Math.sin,o=h(e/2),u=h(r/2),l=h(s/2),c=a(e/2),d=a(r/2),f=a(s/2);return'XYZ'===n?(this._x=c*u*l+o*d*f,this._y=o*d*l-c*u*f,this._z=o*u*f+c*d*l,this._w=o*u*l-c*d*f):'YXZ'===n?(this._x=c*u*l+o*d*f,this._y=o*d*l-c*u*f,this._z=o*u*f-c*d*l,this._w=o*u*l+c*d*f):'ZXY'===n?(this._x=c*u*l-o*d*f,this._y=o*d*l+c*u*f,this._z=o*u*f+c*d*l,this._w=o*u*l-c*d*f):'ZYX'===n?(this._x=c*u*l-o*d*f,this._y=o*d*l+c*u*f,this._z=o*u*f-c*d*l,this._w=o*u*l+c*d*f):'YZX'===n?(this._x=c*u*l+o*d*f,this._y=o*d*l+c*u*f,this._z=o*u*f-c*d*l,this._w=o*u*l-c*d*f):'XZY'===n&&(this._x=c*u*l-o*d*f,this._y=o*d*l-c*u*f,this._z=o*u*f+c*d*l,this._w=o*u*l+c*d*f),!1!==i&&this._onChangeCallback(),this},setFromAxisAngle:function(t,i){var e=i/2,r=Math.sin(e);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(e),this._onChangeCallback(),this},setFromRotationMatrix:function(t){var i,e=t.elements,r=e[0],s=e[4],n=e[8],h=e[1],a=e[5],o=e[9],u=e[2],l=e[6],c=e[10],d=r+a+c;return d>0?(i=.5/Math.sqrt(d+1),this._w=.25/i,this._x=(l-o)*i,this._y=(n-u)*i,this._z=(h-s)*i):r>a&&r>c?(i=2*Math.sqrt(1+r-a-c),this._w=(l-o)/i,this._x=.25*i,this._y=(s+h)/i,this._z=(n+u)/i):a>c?(i=2*Math.sqrt(1+a-r-c),this._w=(n-u)/i,this._x=(s+h)/i,this._y=.25*i,this._z=(o+l)/i):(i=2*Math.sqrt(1+c-r-a),this._w=(h-s)/i,this._x=(n+u)/i,this._y=(o+l)/i,this._z=.25*i),this._onChangeCallback(),this},setFromUnitVectors:function(t,i){var e=t.dot(i)+1;return e<1e-6?(e=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=e):(this._x=0,this._y=-t.z,this._z=t.y,this._w=e)):(this._x=t.y*i.z-t.z*i.y,this._y=t.z*i.x-t.x*i.z,this._z=t.x*i.y-t.y*i.x,this._w=e),this.normalize()},angleTo:function(t){return 2*Math.acos(Math.abs(Kt.clamp(this.dot(t),-1,1)))},rotateTowards:function(t,i){var e=this.angleTo(t);if(0===e)return this;var r=Math.min(1,i/e);return this.slerp(t,r),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this},multiply:function(t,i){return void 0!==i?this.multiplyQuaternions(t,i):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,i){var e=t._x,r=t._y,s=t._z,n=t._w,h=i._x,a=i._y,o=i._z,u=i._w;return this._x=e*u+n*h+r*o-s*a,this._y=r*u+n*a+s*h-e*o,this._z=s*u+n*o+e*a-r*h,this._w=n*u-e*h-r*a-s*o,this._onChangeCallback(),this},slerp:function(t,i){if(0===i)return this;if(1===i)return this.copy(t);var e=this._x,r=this._y,s=this._z,n=this._w,h=n*t._w+e*t._x+r*t._y+s*t._z;if(h<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,h=-h):this.copy(t),h>=1)return this._w=n,this._x=e,this._y=r,this._z=s,this;var a=1-h*h;if(a<=Number.EPSILON){var o=1-i;return this._w=o*n+i*this._w,this._x=o*e+i*this._x,this._y=o*r+i*this._y,this._z=o*s+i*this._z,this.normalize(),this._onChangeCallback(),this}var u=Math.sqrt(a),l=Math.atan2(u,h),c=Math.sin((1-i)*l)/u,d=Math.sin(i*l)/u;return this._w=n*c+this._w*d,this._x=e*c+this._x*d,this._y=r*c+this._y*d,this._z=s*c+this._z*d,this._onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,i){return void 0===i&&(i=0),this._x=t[i],this._y=t[i+1],this._z=t[i+2],this._w=t[i+3],this._onChangeCallback(),this},toArray:function(t,i){return void 0===t&&(t=[]),void 0===i&&(i=0),t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._w,t},_onChange:function(t){return this._onChangeCallback=t,this},_onChangeCallback:function(){}});var $t=new ti,Jt=new Qt;function ti(t,i,e){this.x=t||0,this.y=i||0,this.z=e||0}Object.assign(ti.prototype,{isVector3:!0,set:function(t,i,e){return this.x=t,this.y=i,this.z=e,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error('index is out of range: '+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error('index is out of range: '+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,i){return void 0!==i?this.addVectors(t,i):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this},addScaledVector:function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this},sub:function(t,i){return void 0!==i?this.subVectors(t,i):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this},multiply:function(t,i){return void 0!==i?this.multiplyVectors(t,i):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this},applyEuler:function(t){return!t||t.isEuler,this.applyQuaternion(Jt.setFromEuler(t))},applyAxisAngle:function(t,i){return this.applyQuaternion(Jt.setFromAxisAngle(t,i))},applyMatrix3:function(t){var i=this.x,e=this.y,r=this.z,s=t.elements;return this.x=s[0]*i+s[3]*e+s[6]*r,this.y=s[1]*i+s[4]*e+s[7]*r,this.z=s[2]*i+s[5]*e+s[8]*r,this},applyNormalMatrix:function(t){return this.applyMatrix3(t).normalize()},applyMatrix4:function(t){var i=this.x,e=this.y,r=this.z,s=t.elements,n=1/(s[3]*i+s[7]*e+s[11]*r+s[15]);return this.x=(s[0]*i+s[4]*e+s[8]*r+s[12])*n,this.y=(s[1]*i+s[5]*e+s[9]*r+s[13])*n,this.z=(s[2]*i+s[6]*e+s[10]*r+s[14])*n,this},applyQuaternion:function(t){var i=this.x,e=this.y,r=this.z,s=t.x,n=t.y,h=t.z,a=t.w,o=a*i+n*r-h*e,u=a*e+h*i-s*r,l=a*r+s*e-n*i,c=-s*i-n*e-h*r;return this.x=o*a+c*-s+u*-h-l*-n,this.y=u*a+c*-n+l*-s-o*-h,this.z=l*a+c*-h+o*-n-u*-s,this},project:function(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)},unproject:function(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)},transformDirection:function(t){var i=this.x,e=this.y,r=this.z,s=t.elements;return this.x=s[0]*i+s[4]*e+s[8]*r,this.y=s[1]*i+s[5]*e+s[9]*r,this.z=s[2]*i+s[6]*e+s[10]*r,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this},clampScalar:function(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this.z=Math.max(t,Math.min(i,this.z)),this},clampLength:function(t,i){var e=this.length();return this.divideScalar(e||1).multiplyScalar(Math.max(t,Math.min(i,e)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this},lerpVectors:function(t,i,e){return this.subVectors(i,t).multiplyScalar(e).add(t)},cross:function(t,i){return void 0!==i?this.crossVectors(t,i):this.crossVectors(this,t)},crossVectors:function(t,i){var e=t.x,r=t.y,s=t.z,n=i.x,h=i.y,a=i.z;return this.x=r*a-s*h,this.y=s*n-e*a,this.z=e*h-r*n,this},projectOnVector:function(t){var i=t.dot(this)/t.lengthSq();return this.copy(t).multiplyScalar(i)},projectOnPlane:function(t){return $t.copy(this).projectOnVector(t),this.sub($t)},reflect:function(t){return this.sub($t.copy(t).multiplyScalar(2*this.dot(t)))},angleTo:function(t){var i=Math.sqrt(this.lengthSq()*t.lengthSq()),e=this.dot(t)/i;return Math.acos(Kt.clamp(e,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var i=this.x-t.x,e=this.y-t.y,r=this.z-t.z;return i*i+e*e+r*r},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)},setFromSphericalCoords:function(t,i,e){var r=Math.sin(i)*t;return this.x=r*Math.sin(e),this.y=Math.cos(i)*t,this.z=r*Math.cos(e),this},setFromCylindrical:function(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)},setFromCylindricalCoords:function(t,i,e){return this.x=t*Math.sin(i),this.y=e,this.z=t*Math.cos(i),this},setFromMatrixPosition:function(t){var i=t.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this},setFromMatrixScale:function(t){var i=this.setFromMatrixColumn(t,0).length(),e=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=i,this.y=e,this.z=r,this},setFromMatrixColumn:function(t,i){return this.fromArray(t.elements,4*i)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,i){return void 0===i&&(i=0),this.x=t[i],this.y=t[i+1],this.z=t[i+2],this},toArray:function(t,i){return void 0===t&&(t=[]),void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t},fromAttribute:function(t,i){return this.x=t.getX(i),this.y=t.getY(i),this.z=t.getZ(i),this}});var ii=new ti,ei=new oi,ri=new ti(0,0,0),si=new ti(1,1,1),ni=new ti,hi=new ti,ai=new ti;function oi(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}Object.assign(oi.prototype,{isMatrix4:!0,set:function(t,i,e,r,s,n,h,a,o,u,l,c,d,f,p,y){var m=this.elements;return m[0]=t,m[4]=i,m[8]=e,m[12]=r,m[1]=s,m[5]=n,m[9]=h,m[13]=a,m[2]=o,m[6]=u,m[10]=l,m[14]=c,m[3]=d,m[7]=f,m[11]=p,m[15]=y,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new oi).fromArray(this.elements)},copy:function(t){var i=this.elements,e=t.elements;return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],this},copyPosition:function(t){var i=this.elements,e=t.elements;return i[12]=e[12],i[13]=e[13],i[14]=e[14],this},extractBasis:function(t,i,e){return t.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),e.setFromMatrixColumn(this,2),this},makeBasis:function(t,i,e){return this.set(t.x,i.x,e.x,0,t.y,i.y,e.y,0,t.z,i.z,e.z,0,0,0,0,1),this},extractRotation:function(t){var i=this.elements,e=t.elements,r=1/ii.setFromMatrixColumn(t,0).length(),s=1/ii.setFromMatrixColumn(t,1).length(),n=1/ii.setFromMatrixColumn(t,2).length();return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i[3]=0,i[4]=e[4]*s,i[5]=e[5]*s,i[6]=e[6]*s,i[7]=0,i[8]=e[8]*n,i[9]=e[9]*n,i[10]=e[10]*n,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this},makeRotationFromEuler:function(t){!t||t.isEuler;var i=this.elements,e=t.x,r=t.y,s=t.z,n=Math.cos(e),h=Math.sin(e),a=Math.cos(r),o=Math.sin(r),u=Math.cos(s),l=Math.sin(s);if('XYZ'===t.order){var c=n*u,d=n*l,f=h*u,p=h*l;i[0]=a*u,i[4]=-a*l,i[8]=o,i[1]=d+f*o,i[5]=c-p*o,i[9]=-h*a,i[2]=p-c*o,i[6]=f+d*o,i[10]=n*a}else if('YXZ'===t.order){var y=a*u,m=a*l,x=o*u,g=o*l;i[0]=y+g*h,i[4]=x*h-m,i[8]=n*o,i[1]=n*l,i[5]=n*u,i[9]=-h,i[2]=m*h-x,i[6]=g+y*h,i[10]=n*a}else if('ZXY'===t.order){y=a*u,m=a*l,x=o*u,g=o*l;i[0]=y-g*h,i[4]=-n*l,i[8]=x+m*h,i[1]=m+x*h,i[5]=n*u,i[9]=g-y*h,i[2]=-n*o,i[6]=h,i[10]=n*a}else if('ZYX'===t.order){c=n*u,d=n*l,f=h*u,p=h*l;i[0]=a*u,i[4]=f*o-d,i[8]=c*o+p,i[1]=a*l,i[5]=p*o+c,i[9]=d*o-f,i[2]=-o,i[6]=h*a,i[10]=n*a}else if('YZX'===t.order){var v=n*a,_=n*o,w=h*a,b=h*o;i[0]=a*u,i[4]=b-v*l,i[8]=w*l+_,i[1]=l,i[5]=n*u,i[9]=-h*u,i[2]=-o*u,i[6]=_*l+w,i[10]=v-b*l}else if('XZY'===t.order){v=n*a,_=n*o,w=h*a,b=h*o;i[0]=a*u,i[4]=-l,i[8]=o*u,i[1]=v*l+b,i[5]=n*u,i[9]=_*l-w,i[2]=w*l-_,i[6]=h*u,i[10]=b*l+v}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this},makeRotationFromQuaternion:function(t){return this.compose(ri,t,si)},lookAt:function(t,i,e){var r=this.elements;return ai.subVectors(t,i),0===ai.lengthSq()&&(ai.z=1),ai.normalize(),ni.crossVectors(e,ai),0===ni.lengthSq()&&(1===Math.abs(e.z)?ai.x+=1e-4:ai.z+=1e-4,ai.normalize(),ni.crossVectors(e,ai)),ni.normalize(),hi.crossVectors(ai,ni),r[0]=ni.x,r[4]=hi.x,r[8]=ai.x,r[1]=ni.y,r[5]=hi.y,r[9]=ai.y,r[2]=ni.z,r[6]=hi.z,r[10]=ai.z,this},multiply:function(t,i){return void 0!==i?this.multiplyMatrices(t,i):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,i){var e=t.elements,r=i.elements,s=this.elements,n=e[0],h=e[4],a=e[8],o=e[12],u=e[1],l=e[5],c=e[9],d=e[13],f=e[2],p=e[6],y=e[10],m=e[14],x=e[3],g=e[7],v=e[11],_=e[15],w=r[0],b=r[4],M=r[8],E=r[12],A=r[1],T=r[5],R=r[9],S=r[13],C=r[2],F=r[6],B=r[10],L=r[14],z=r[3],U=r[7],P=r[11],O=r[15];return s[0]=n*w+h*A+a*C+o*z,s[4]=n*b+h*T+a*F+o*U,s[8]=n*M+h*R+a*B+o*P,s[12]=n*E+h*S+a*L+o*O,s[1]=u*w+l*A+c*C+d*z,s[5]=u*b+l*T+c*F+d*U,s[9]=u*M+l*R+c*B+d*P,s[13]=u*E+l*S+c*L+d*O,s[2]=f*w+p*A+y*C+m*z,s[6]=f*b+p*T+y*F+m*U,s[10]=f*M+p*R+y*B+m*P,s[14]=f*E+p*S+y*L+m*O,s[3]=x*w+g*A+v*C+_*z,s[7]=x*b+g*T+v*F+_*U,s[11]=x*M+g*R+v*B+_*P,s[15]=x*E+g*S+v*L+_*O,this},multiplyScalar:function(t){var i=this.elements;return i[0]*=t,i[4]*=t,i[8]*=t,i[12]*=t,i[1]*=t,i[5]*=t,i[9]*=t,i[13]*=t,i[2]*=t,i[6]*=t,i[10]*=t,i[14]*=t,i[3]*=t,i[7]*=t,i[11]*=t,i[15]*=t,this},applyToBufferAttribute:function(t){for(var i=0,e=t.count;i<e;i++)ii.x=t.getX(i),ii.y=t.getY(i),ii.z=t.getZ(i),ii.applyMatrix4(this),t.setXYZ(i,ii.x,ii.y,ii.z);return t},determinant:function(){var t=this.elements,i=t[0],e=t[4],r=t[8],s=t[12],n=t[1],h=t[5],a=t[9],o=t[13],u=t[2],l=t[6],c=t[10],d=t[14];return t[3]*(+s*a*l-r*o*l-s*h*c+e*o*c+r*h*d-e*a*d)+t[7]*(+i*a*d-i*o*c+s*n*c-r*n*d+r*o*u-s*a*u)+t[11]*(+i*o*l-i*h*d-s*n*l+e*n*d+s*h*u-e*o*u)+t[15]*(-r*h*u-i*a*l+i*h*c+r*n*l-e*n*c+e*a*u)},transpose:function(){var t,i=this.elements;return t=i[1],i[1]=i[4],i[4]=t,t=i[2],i[2]=i[8],i[8]=t,t=i[6],i[6]=i[9],i[9]=t,t=i[3],i[3]=i[12],i[12]=t,t=i[7],i[7]=i[13],i[13]=t,t=i[11],i[11]=i[14],i[14]=t,this},setPosition:function(t,i,e){var r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=i,r[14]=e),this},getInverse:function(t,i){var e=this.elements,r=t.elements,s=r[0],n=r[1],h=r[2],a=r[3],o=r[4],u=r[5],l=r[6],c=r[7],d=r[8],f=r[9],p=r[10],y=r[11],m=r[12],x=r[13],g=r[14],v=r[15],_=f*g*c-x*p*c+x*l*y-u*g*y-f*l*v+u*p*v,w=m*p*c-d*g*c-m*l*y+o*g*y+d*l*v-o*p*v,b=d*x*c-m*f*c+m*u*y-o*x*y-d*u*v+o*f*v,M=m*f*l-d*x*l-m*u*p+o*x*p+d*u*g-o*f*g,E=s*_+n*w+h*b+a*M;if(0===E){if(!0===i)throw new Error("Tiny.Matrix4: .getInverse() can't invert matrix, determinant is 0");return this.identity()}var A=1/E;return e[0]=_*A,e[1]=(x*p*a-f*g*a-x*h*y+n*g*y+f*h*v-n*p*v)*A,e[2]=(u*g*a-x*l*a+x*h*c-n*g*c-u*h*v+n*l*v)*A,e[3]=(f*l*a-u*p*a-f*h*c+n*p*c+u*h*y-n*l*y)*A,e[4]=w*A,e[5]=(d*g*a-m*p*a+m*h*y-s*g*y-d*h*v+s*p*v)*A,e[6]=(m*l*a-o*g*a-m*h*c+s*g*c+o*h*v-s*l*v)*A,e[7]=(o*p*a-d*l*a+d*h*c-s*p*c-o*h*y+s*l*y)*A,e[8]=b*A,e[9]=(m*f*a-d*x*a-m*n*y+s*x*y+d*n*v-s*f*v)*A,e[10]=(o*x*a-m*u*a+m*n*c-s*x*c-o*n*v+s*u*v)*A,e[11]=(d*u*a-o*f*a-d*n*c+s*f*c+o*n*y-s*u*y)*A,e[12]=M*A,e[13]=(d*x*h-m*f*h+m*n*p-s*x*p-d*n*g+s*f*g)*A,e[14]=(m*u*h-o*x*h-m*n*l+s*x*l+o*n*g-s*u*g)*A,e[15]=(o*f*h-d*u*h+d*n*l-s*f*l-o*n*p+s*u*p)*A,this},scale:function(t){var i=this.elements,e=t.x,r=t.y,s=t.z;return i[0]*=e,i[4]*=r,i[8]*=s,i[1]*=e,i[5]*=r,i[9]*=s,i[2]*=e,i[6]*=r,i[10]*=s,i[3]*=e,i[7]*=r,i[11]*=s,this},getMaxScaleOnAxis:function(){var t=this.elements,i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],e=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(i,e,r))},makeTranslation:function(t,i,e){return this.set(1,0,0,t,0,1,0,i,0,0,1,e,0,0,0,1),this},makeRotationX:function(t){var i=Math.cos(t),e=Math.sin(t);return this.set(1,0,0,0,0,i,-e,0,0,e,i,0,0,0,0,1),this},makeRotationY:function(t){var i=Math.cos(t),e=Math.sin(t);return this.set(i,0,e,0,0,1,0,0,-e,0,i,0,0,0,0,1),this},makeRotationZ:function(t){var i=Math.cos(t),e=Math.sin(t);return this.set(i,-e,0,0,e,i,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,i){var e=Math.cos(i),r=Math.sin(i),s=1-e,n=t.x,h=t.y,a=t.z,o=s*n,u=s*h;return this.set(o*n+e,o*h-r*a,o*a+r*h,0,o*h+r*a,u*h+e,u*a-r*n,0,o*a-r*h,u*a+r*n,s*a*a+e,0,0,0,0,1),this},makeScale:function(t,i,e){return this.set(t,0,0,0,0,i,0,0,0,0,e,0,0,0,0,1),this},makeShear:function(t,i,e){return this.set(1,i,e,0,t,1,e,0,t,i,1,0,0,0,0,1),this},compose:function(t,i,e){var r=this.elements,s=i._x,n=i._y,h=i._z,a=i._w,o=s+s,u=n+n,l=h+h,c=s*o,d=s*u,f=s*l,p=n*u,y=n*l,m=h*l,x=a*o,g=a*u,v=a*l,_=e.x,w=e.y,b=e.z;return r[0]=(1-(p+m))*_,r[1]=(d+v)*_,r[2]=(f-g)*_,r[3]=0,r[4]=(d-v)*w,r[5]=(1-(c+m))*w,r[6]=(y+x)*w,r[7]=0,r[8]=(f+g)*b,r[9]=(y-x)*b,r[10]=(1-(c+p))*b,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this},decompose:function(t,i,e){var r=this.elements,s=ii.set(r[0],r[1],r[2]).length(),n=ii.set(r[4],r[5],r[6]).length(),h=ii.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),t.x=r[12],t.y=r[13],t.z=r[14],ei.copy(this);var a=1/s,o=1/n,u=1/h;return ei.elements[0]*=a,ei.elements[1]*=a,ei.elements[2]*=a,ei.elements[4]*=o,ei.elements[5]*=o,ei.elements[6]*=o,ei.elements[8]*=u,ei.elements[9]*=u,ei.elements[10]*=u,i.setFromRotationMatrix(ei),e.x=s,e.y=n,e.z=h,this},makePerspective:function(t,i,e,r,s,n){var h=this.elements,a=2*s/(i-t),o=2*s/(e-r),u=(i+t)/(i-t),l=(e+r)/(e-r),c=-(n+s)/(n-s),d=-2*n*s/(n-s);return h[0]=a,h[4]=0,h[8]=u,h[12]=0,h[1]=0,h[5]=o,h[9]=l,h[13]=0,h[2]=0,h[6]=0,h[10]=c,h[14]=d,h[3]=0,h[7]=0,h[11]=-1,h[15]=0,this},makeOrthographic:function(t,i,e,r,s,n){var h=this.elements,a=1/(i-t),o=1/(e-r),u=1/(n-s),l=(i+t)*a,c=(e+r)*o,d=(n+s)*u;return h[0]=2*a,h[4]=0,h[8]=0,h[12]=-l,h[1]=0,h[5]=2*o,h[9]=0,h[13]=-c,h[2]=0,h[6]=0,h[10]=-2*u,h[14]=-d,h[3]=0,h[7]=0,h[11]=0,h[15]=1,this},equals:function(t){for(var i=this.elements,e=t.elements,r=0;r<16;r++)if(i[r]!==e[r])return!1;return!0},fromArray:function(t,i){void 0===i&&(i=0);for(var e=0;e<16;e++)this.elements[e]=t[e+i];return this},toArray:function(t,i){void 0===t&&(t=[]),void 0===i&&(i=0);var e=this.elements;return t[i]=e[0],t[i+1]=e[1],t[i+2]=e[2],t[i+3]=e[3],t[i+4]=e[4],t[i+5]=e[5],t[i+6]=e[6],t[i+7]=e[7],t[i+8]=e[8],t[i+9]=e[9],t[i+10]=e[10],t[i+11]=e[11],t[i+12]=e[12],t[i+13]=e[13],t[i+14]=e[14],t[i+15]=e[15],t}});var ui=new oi,li=new Qt;function ci(t,i,e,r){this._x=t||0,this._y=i||0,this._z=e||0,this._order=r||ci.DefaultOrder}ci.RotationOrders=['XYZ','YZX','ZXY','XZY','YXZ','ZYX'],ci.DefaultOrder='XYZ',Object.defineProperties(ci.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(t){this._order=t,this._onChangeCallback()}}}),Object.assign(ci.prototype,{isEuler:!0,set:function(t,i,e,r){return this._x=t,this._y=i,this._z=e,this._order=r||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this},setFromRotationMatrix:function(t,i,e){var r=u.clamp,s=t.elements,n=s[0],h=s[4],a=s[8],o=s[1],l=s[5],c=s[9],d=s[2],f=s[6],p=s[10];return'XYZ'===(i=i||this._order)?(this._y=Math.asin(r(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,p),this._z=Math.atan2(-h,n)):(this._x=Math.atan2(f,l),this._z=0)):'YXZ'===i?(this._x=Math.asin(-r(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(a,p),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-d,n),this._z=0)):'ZXY'===i?(this._x=Math.asin(r(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-d,p),this._z=Math.atan2(-h,l)):(this._y=0,this._z=Math.atan2(o,n))):'ZYX'===i?(this._y=Math.asin(-r(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(f,p),this._z=Math.atan2(o,n)):(this._x=0,this._z=Math.atan2(-h,l))):'YZX'===i?(this._z=Math.asin(r(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-d,n)):(this._x=0,this._y=Math.atan2(a,p))):'XZY'===i&&(this._z=Math.asin(-r(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(f,l),this._y=Math.atan2(a,n)):(this._x=Math.atan2(-c,p),this._y=0)),this._order=i,!1!==e&&this._onChangeCallback(),this},setFromQuaternion:function(t,i,e){return ui.makeRotationFromQuaternion(t),this.setFromRotationMatrix(ui,i,e)},setFromVector3:function(t,i){return this.set(t.x,t.y,t.z,i||this._order)},reorder:function(t){return li.setFromEuler(this),this.setFromQuaternion(li,t)},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this},toArray:function(t,i){return void 0===t&&(t=[]),void 0===i&&(i=0),t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new ti(this._x,this._y,this._z)},_onChange:function(t){return this._onChangeCallback=t,this},_onChangeCallback:function(){}});var di=new Qt,fi=new oi,pi=new ti,yi=new ti;function mi(){this.parent=null,this.children=[],this.visible=!0,this.matrix=new oi,this.worldMatrix=new oi,this.matrixAutoUpdate=!0,this.position=new ti,this.quaternion=new Qt,this.scale=new ti(1,1,1),this.rotation=new ci,this.up=new ti(0,1,0),this.rotation._onChange((()=>{this.quaternion.setFromEuler(this.rotation,!1)})),this.quaternion._onChange((()=>{this.rotation.setFromQuaternion(this.quaternion,void 0,!1)}))}function xi(t,i,e,r){this.x=t||0,this.y=i||0,this.z=e||0,this.w=void 0!==r?r:1}mi.prototype={constructor:mi,isObject3D:!0,clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,i){if(void 0===i&&(i=!0),this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.worldMatrix.copy(t.worldMatrix),this.matrixAutoUpdate=t.matrixAutoUpdate,!0===i)for(var e=0;e<t.children.length;e++){var r=t.children[e];this.add(r.clone())}return this},getObjectByName:function(t=""){var i=null;return this.traverse((e=>{e.name===t&&(i=e)})),i},add:function(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t)},remove:function(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const i=this.children.indexOf(t);return-1!==i&&(t.parent=null,this.children.splice(i,1)),this},updateTransform:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.worldMatrixNeedsUpdate||t)&&(null===this.parent?this.worldMatrix.copy(this.matrix):this.worldMatrix.multiplyMatrices(this.parent.worldMatrix,this.matrix),this.worldMatrixNeedsUpdate=!1,t=!0);for(var i=0,e=this.children.length;i<e;i++)this.children[i].updateTransform(t)},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.worldMatrixNeedsUpdate=!0},traverse:function(t){if(!t(this))for(var i=0,e=this.children.length;i<e;i++)this.children[i].traverse(t)},decompose:function(){this.matrix.getTranslation(this.position),this.matrix.getRotation(this.quaternion),this.matrix.getScaling(this.scale),this.rotation.fromQuaternion(this.quaternion)},lookAt:function(t,i,e){t.isVector3?pi.copy(t):pi.set(t,i,e);var r=this.parent;this.updateTransform(!0,!1),yi.setFromMatrixPosition(this.worldMatrix),this.isCamera||this.isLight?fi.lookAt(yi,pi,this.up):fi.lookAt(pi,yi,this.up),this.quaternion.setFromRotationMatrix(fi),r&&(fi.extractRotation(r.worldMatrix),di.setFromRotationMatrix(fi),this.quaternion.premultiply(di.inverse()))}},Object.defineProperties(xi.prototype,{width:{get:function(){return this.z},set:function(t){this.z=t}},height:{get:function(){return this.w},set:function(t){this.w=t}}}),Object.assign(xi.prototype,{isVector4:!0,set:function(t,i,e,r){return this.x=t,this.y=i,this.z=e,this.w=r,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error('index is out of range: '+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error('index is out of range: '+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},add:function(t,i){return void 0!==i?this.addVectors(t,i):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this.w=t.w+i.w,this},addScaledVector:function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this.w+=t.w*i,this},sub:function(t,i){return void 0!==i?this.subVectors(t,i):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},subVectors:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this.w=t.w-i.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},applyMatrix4:function(t){var i=this.x,e=this.y,r=this.z,s=this.w,n=t.elements;return this.x=n[0]*i+n[4]*e+n[8]*r+n[12]*s,this.y=n[1]*i+n[5]*e+n[9]*r+n[13]*s,this.z=n[2]*i+n[6]*e+n[10]*r+n[14]*s,this.w=n[3]*i+n[7]*e+n[11]*r+n[15]*s,this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var i=Math.sqrt(1-t.w*t.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/i,this.y=t.y/i,this.z=t.z/i),this},setAxisAngleFromRotationMatrix:function(t){var i,e,r,s,n=.01,h=.1,a=t.elements,o=a[0],u=a[4],l=a[8],c=a[1],d=a[5],f=a[9],p=a[2],y=a[6],m=a[10];if(Math.abs(u-c)<n&&Math.abs(l-p)<n&&Math.abs(f-y)<n){if(Math.abs(u+c)<h&&Math.abs(l+p)<h&&Math.abs(f+y)<h&&Math.abs(o+d+m-3)<h)return this.set(1,0,0,0),this;i=Math.PI;var x=(o+1)/2,g=(d+1)/2,v=(m+1)/2,_=(u+c)/4,w=(l+p)/4,b=(f+y)/4;return x>g&&x>v?x<n?(e=0,r=.707106781,s=.707106781):(r=_/(e=Math.sqrt(x)),s=w/e):g>v?g<n?(e=.707106781,r=0,s=.707106781):(e=_/(r=Math.sqrt(g)),s=b/r):v<n?(e=.707106781,r=.707106781,s=0):(e=w/(s=Math.sqrt(v)),r=b/s),this.set(e,r,s,i),this}var M=Math.sqrt((y-f)*(y-f)+(l-p)*(l-p)+(c-u)*(c-u));return Math.abs(M)<.001&&(M=1),this.x=(y-f)/M,this.y=(l-p)/M,this.z=(c-u)/M,this.w=Math.acos((o+d+m-1)/2),this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},clamp:function(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this.w=Math.max(t.w,Math.min(i.w,this.w)),this},clampScalar:function(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this.z=Math.max(t,Math.min(i,this.z)),this.w=Math.max(t,Math.min(i,this.w)),this},clampLength:function(t,i){var e=this.length();return this.divideScalar(e||1).multiplyScalar(Math.max(t,Math.min(i,e)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this.w+=(t.w-this.w)*i,this},lerpVectors:function(t,i,e){return this.subVectors(i,t).multiplyScalar(e).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,i){return void 0===i&&(i=0),this.x=t[i],this.y=t[i+1],this.z=t[i+2],this.w=t[i+3],this},toArray:function(t,i){return void 0===t&&(t=[]),void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,t},fromBufferAttribute:function(t,i,e){return this.x=t.getX(i),this.y=t.getY(i),this.z=t.getZ(i),this.w=t.getW(i),this}});var gi=0;function vi(t,i,{mode:e=WebGLRenderingContext.TRIANGLES,frustumCulled:r=!0,renderOrder:s=0}={}){mi.call(this),this.id=gi++,this.geometry=t,this.material=i,this.mode=e,this.frustumCulled=r,this.renderOrder=s,this.beforeRenderCallbacks=[],this.afterRenderCallbacks=[]}vi.prototype=Object.assign(Object.create(mi.prototype),{constructor:vi,isMesh:!0,clone:function(){return new this.constructor(this.geometry,this.material).copy(this)},copy:function(t){return mi.prototype.copy.call(this,t),this.renderOrder=t.renderOrder,this.frustumCulled=t.frustumCulled,this.mode=t.mode,this},onBeforeRender:function(t){return this.beforeRenderCallbacks.push(t),this},onAfterRender:function(t){return this.afterRenderCallbacks.push(t),this},draw:function({camera:t,directionalLight:i,ambientLight:e}={}){this.material.gl.renderer.state.currentProgram!==this.material.id&&(this.material.isMeshLambertMaterial||this.material.isInstancedMeshLambertMaterial)&&(e&&this.material.uniforms.ambientLight.set(new xi(e.color.r,e.color.g,e.color.b,e.visible?e.intensity:0)),i&&(this.material.uniforms.directionalLight.set(new xi(i.color.r,i.color.g,i.color.b,i.visible?i.intensity:0)),this.material.uniforms.directionalLightDirection.set(i.position))),t.projectMatrixDirty&&this.material.uniforms.projectViewMatrix.set(t.projectionViewMatrix),this.material.uniforms.modelMatrix.set(this.worldMatrix),this.beforeRenderCallbacks.forEach((i=>i&&i({mesh:this,camera:t})));var r=this.material.cullFace&&this.worldMatrix.determinant()<0;this.material.use({flipFaces:r}),this.geometry.draw({mode:this.mode,material:this.material}),this.afterRenderCallbacks.forEach((i=>i&&i({mesh:this,camera:t})))}});function _i(t,i,e){if(e=void 0!==e?e:1,!t.attributes.instanceMatrix){var r=new Float32Array(16*e);t.setAttribute('instanceMatrix',new Tiny.Float32Attribute(r,16)),t.attributes.instanceMatrix.instanced=1}t.isInstanced=!0,t.instancedCount=e,vi.call(this,t,i),this.frustumCulled=!1,this.isInstancedMesh=!0}_i.prototype=Object.assign(Object.create(vi.prototype),{constructor:_i,setMatrixAt:function(t,i){this.geometry.attributes.instanceMatrix.set(i.elements,16*t)},draw:function({camera:t,directionalLight:i,ambientLight:e}={}){this.dynamic&&(this.needsUpdate=!0),vi.prototype.draw.call(this,{camera:t,directionalLight:i,ambientLight:e})}});var wi=function(t,i){mi.call(this),this.color=new l(t),this.intensity=void 0!==i?i:1};(wi.prototype=Object.create(mi.prototype)).constructor=wi;var bi=function(t,i){wi.call(this,t,i),this.isAmbientLight=!0};(bi.prototype=Object.create(wi.prototype)).constructor=bi;var Mi=function(t,i){wi.call(this,t,i),this.isDirectionalLight=!0};function Ei(){mi.call(this),this.isCamera=!0,this.projectMatrixDirty=!1}(Mi.prototype=Object.create(wi.prototype)).constructor=Mi,Ei.prototype=Object.assign(Object.create(mi.prototype),{constructor:Ei,updateProjectionMatrix:function(){this.projectMatrixDirty=!0}});var Ai=new oi,Ti=new ti,Ri=new ti;function Si(t=.1,i=100,e=-1,r=1,s=-1,n=1,h=1){Ei.call(this),this.near=t,this.far=i,this.left=e,this.right=r,this.bottom=s,this.top=n,this.zoom=h,this.view=null,this.projectionMatrix=new oi,this.viewMatrix=new oi,this.projectionViewMatrix=new oi,this.updateProjectionMatrix()}function Ci(t,i){switch(i.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error('Invalid component type.')}}function Fi(t,i){switch(i.constructor){case Float32Array:return t;case Uint32Array:return Math.round(4294967295*t);case Uint16Array:return Math.round(65535*t);case Uint8Array:return Math.round(255*t);case Int32Array:return Math.round(2147483647*t);case Int16Array:return Math.round(32767*t);case Int8Array:return Math.round(127*t);default:throw new Error('Invalid component type.')}}function Bi(t,i){this.x=t||0,this.y=i||0}Si.prototype=Object.assign(Object.create(Ei.prototype),{constructor:Si,isOrthographicCamera:!0,updateProjectionMatrix:function(){Ei.prototype.updateProjectionMatrix.call(this);var t=(this.right-this.left)/(2*this.zoom),i=(this.top-this.bottom)/(2*this.zoom),e=(this.right+this.left)/2,r=(this.top+this.bottom)/2,s=e-t,n=e+t,h=r+i,a=r-i;if(null!==this.view&&this.view.enabled){var o=this.zoom/(this.view.width/this.view.fullWidth),u=this.zoom/(this.view.height/this.view.fullHeight),l=(this.right-this.left)/this.view.width,c=(this.top-this.bottom)/this.view.height;n=(s+=l*(this.view.offsetX/o))+l*(this.view.width/o),a=(h-=c*(this.view.offsetY/u))-c*(this.view.height/u)}this.projectionMatrix.makeOrthographic(s,n,h,a,this.near,this.far)},updateTransform:function(){return Ei.prototype.updateTransform.call(this),this.viewMatrix.getInverse(this.worldMatrix),this.projectionViewMatrix.multiplyMatrices(this.projectionMatrix,this.viewMatrix),this},project:function(t){return t.applyMatrix4(this.viewMatrix),t.applyMatrix4(this.projectionMatrix),this},unproject:function(t){return t.applyMatrix4(Ai.inverse(this.projectionMatrix)),t.applyMatrix4(this.worldMatrix),this},updateFrustum:function(){this.frustum||(this.frustum=[new ti,new ti,new ti,new ti,new ti,new ti]);var t=this.projectionViewMatrix.elements;this.frustum[0].set(t[3]-t[0],t[7]-t[4],t[11]-t[8]).constant=t[15]-t[12],this.frustum[1].set(t[3]+t[0],t[7]+t[4],t[11]+t[8]).constant=t[15]+t[12],this.frustum[2].set(t[3]+t[1],t[7]+t[5],t[11]+t[9]).constant=t[15]+t[13],this.frustum[3].set(t[3]-t[1],t[7]-t[5],t[11]-t[9]).constant=t[15]-t[13],this.frustum[4].set(t[3]-t[2],t[7]-t[6],t[11]-t[10]).constant=t[15]-t[14],this.frustum[5].set(t[3]+t[2],t[7]+t[6],t[11]+t[10]).constant=t[15]+t[14];for(var i=0;i<6;i++){var e=1/this.frustum[i].length();this.frustum[i].multiplyScalar(e),this.frustum[i].constant*=e}},frustumIntersectsMesh:function(t,i=t.worldMatrix){if(!t.geometry.attributes.position)return!0;if(t.geometry.bounds&&t.geometry.bounds.radius!==1/0||t.geometry.computeBoundingSphere(),!t.geometry.bounds)return!0;var e=Ti;e.copy(t.geometry.bounds.center),e.applyMatrix4(i);var r=t.geometry.bounds.radius*i.getMaxScaleOnAxis();return this.frustumIntersectsSphere(e,r)},frustumIntersectsSphere:function(t,i){for(var e=Ri,r=0;r<6;r++){var s=this.frustum[r];if(e.copy(s).dot(t)+s.constant<-i)return!1}return!0}}),Object.defineProperties(Bi.prototype,{width:{get:function(){return this.x},set:function(t){this.x=t}},height:{get:function(){return this.y},set:function(t){this.y=t}}}),Object.assign(Bi.prototype,{isVector2:!0,set:function(t,i){return this.x=t,this.y=i,this},setScalar:function(t){return this.x=t,this.y=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error('index is out of range: '+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error('index is out of range: '+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,i){return void 0!==i?this.addVectors(t,i):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this},addScaledVector:function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this},sub:function(t,i){return void 0!==i?this.subVectors(t,i):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},applyMatrix3:function(t){var i=this.x,e=this.y,r=t.elements;return this.x=r[0]*i+r[3]*e+r[6],this.y=r[1]*i+r[4]*e+r[7],this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this},clampScalar:function(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this},clampLength:function(t,i){var e=this.length();return this.divideScalar(e||1).multiplyScalar(Math.max(t,Math.min(i,e)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var i=this.x-t.x,e=this.y-t.y;return i*i+e*e},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this},lerpVectors:function(t,i,e){return this.subVectors(i,t).multiplyScalar(e).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,i){return void 0===i&&(i=0),this.x=t[i],this.y=t[i+1],this},toArray:function(t,i){return void 0===t&&(t=[]),void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t},fromBufferAttribute:function(t,i,e){return this.x=t.getX(i),this.y=t.getY(i),this},rotateAround:function(t,i){var e=Math.cos(i),r=Math.sin(i),s=this.x-t.x,n=this.y-t.y;return this.x=s*e-n*r+t.x,this.y=s*r+n*e+t.y,this}});var Li=new Uint8Array(4);function zi(t){return 0==(t&t-1)}var Ui=1;function Pi(t,{image:i,target:e=t.TEXTURE_2D,type:r=t.UNSIGNED_BYTE,format:s=t.RGBA,internalFormat:n=s,wrapS:h=t.CLAMP_TO_EDGE,wrapT:a=t.CLAMP_TO_EDGE,generateMipmaps:o=!0,minFilter:u=(o?t.NEAREST_MIPMAP_LINEAR:t.LINEAR),magFilter:l=t.LINEAR,premultiplyAlpha:c=!1,unpackAlignment:d=4,flipY:f=e==t.TEXTURE_2D,anisotropy:p=0,level:y=0,width:m,height:x=m}={}){this.gl=t,this.id=Ui++,this.image=i,this.target=e,this.type=r,this.format=s,this.internalFormat=n,this.minFilter=u,this.magFilter=l,this.wrapS=h,this.wrapT=a,this.generateMipmaps=o,this.premultiplyAlpha=c,this.unpackAlignment=d,this.flipY=f,this.anisotropy=Math.min(p,this.gl.renderer.parameters.maxAnisotropy),this.level=y,this.width=m,this.height=x,this.texture=this.gl.createTexture(),this.store={image:null},this.glState=this.gl.renderer.state,this.state={},this.state.minFilter=this.gl.NEAREST_MIPMAP_LINEAR,this.state.magFilter=this.gl.LINEAR,this.state.wrapS=this.gl.REPEAT,this.state.wrapT=this.gl.REPEAT,this.state.anisotropy=0}Pi.prototype={constructor:Pi,bind:function(){this.glState.textureUnits[this.glState.activeTextureUnit]!==this.id&&(this.gl.bindTexture(this.target,this.texture),this.glState.textureUnits[this.glState.activeTextureUnit]=this.id)},update:function(t=0){var i=!(this.image===this.store.image&&!this.needsUpdate);if((i||this.glState.textureUnits[t]!==this.id)&&(this.gl.renderer.activeTexture(t),this.bind()),i){if(this.needsUpdate=!1,this.flipY!==this.glState.flipY&&(this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,this.flipY),this.glState.flipY=this.flipY),this.premultiplyAlpha!==this.glState.premultiplyAlpha&&(this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),this.glState.premultiplyAlpha=this.premultiplyAlpha),this.unpackAlignment!==this.glState.unpackAlignment&&(this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,this.unpackAlignment),this.glState.unpackAlignment=this.unpackAlignment),this.minFilter!==this.state.minFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MIN_FILTER,this.minFilter),this.state.minFilter=this.minFilter),this.magFilter!==this.state.magFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MAG_FILTER,this.magFilter),this.state.magFilter=this.magFilter),this.wrapS!==this.state.wrapS&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_S,this.wrapS),this.state.wrapS=this.wrapS),this.wrapT!==this.state.wrapT&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_T,this.wrapT),this.state.wrapT=this.wrapT),this.anisotropy&&this.anisotropy!==this.state.anisotropy&&(this.gl.texParameterf(this.target,this.gl.renderer.getExtension('EXT_texture_filter_anisotropic').TEXTURE_MAX_ANISOTROPY_EXT,this.anisotropy),this.state.anisotropy=this.anisotropy),this.image){if(this.image.width&&(this.width=this.image.width,this.height=this.image.height),this.target===this.gl.TEXTURE_CUBE_MAP)for(var e=0;e<6;e++)this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+e,this.level,this.internalFormat,this.format,this.type,this.image[e]);else if(ArrayBuffer.isView(this.image))this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,this.image);else if(this.image.isCompressedTexture)for(var r=0;r<this.image.length;r++)this.gl.compressedTexImage2D(this.target,r,this.internalFormat,this.image[r].width,this.image[r].height,0,this.image[r].data);else this.gl.texImage2D(this.target,this.level,this.internalFormat,this.format,this.type,this.image);this.generateMipmaps&&(this.gl.renderer.isWebgl2||zi(this.image.width)&&zi(this.image.height)?this.gl.generateMipmap(this.target):(this.generateMipmaps=!1,this.wrapS=this.wrapT=this.gl.CLAMP_TO_EDGE,this.minFilter=this.gl.LINEAR)),this.onUpdate&&this.onUpdate()}else if(this.target===this.gl.TEXTURE_CUBE_MAP)for(e=0;e<6;e++)this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,Li);else this.width?this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,null):this.gl.texImage2D(this.target,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,Li);this.store.image=this.image}}};var Oi=new ti,Ii=1;function Di({canvas:t=document.createElement('canvas'),width:i=300,height:e=150,dpr:r=1,alpha:s=!1,depth:n=!0,stencil:h=!0,antialias:a=!1,premultipliedAlpha:o=!1,preserveDrawingBuffer:u=!0,powerPreference:l="default",autoClear:c=!0,webgl:d=2}={}){var f={alpha:s,depth:n,stencil:h,antialias:a,premultipliedAlpha:o,preserveDrawingBuffer:u,powerPreference:l};this.dpr=r,this.alpha=s,this.color=!0,this.depth=n,this.stencil=h,this.premultipliedAlpha=o,this.autoClear=c,this.id=Ii++,this.domElement=t,2===d&&(this.gl=t.getContext('webgl2',f)),this.isWebgl2=!!this.gl,this.gl||(this.gl=t.getContext('webgl',f)),this.gl,this.gl.renderer=this,this.resize(i,e),this.state={},this.state.blendFunc={src:this.gl.ONE,dst:this.gl.ZERO},this.state.blendEquation={modeRGB:this.gl.FUNC_ADD},this.state.cullFace=null,this.state.frontFace=this.gl.CCW,this.state.depthMask=!0,this.state.depthFunc=this.gl.LESS,this.state.premultiplyAlpha=!1,this.state.flipY=!1,this.state.unpackAlignment=4,this.state.framebuffer=null,this.state.viewport={x:0,y:0,width:null,height:null},this.state.textureUnits=[],this.state.activeTextureUnit=0,this.state.boundBuffer=null,this.state.uniformLocations=new Map,this.state.currentProgram=null,this.extensions={},this.isWebgl2?(this.getExtension('EXT_color_buffer_float'),this.getExtension('OES_texture_float_linear')):(this.getExtension('OES_texture_float'),this.getExtension('OES_texture_float_linear'),this.getExtension('OES_texture_half_float'),this.getExtension('OES_texture_half_float_linear'),this.getExtension('OES_element_index_uint'),this.getExtension('OES_standard_derivatives'),this.getExtension('EXT_sRGB'),this.getExtension('WEBGL_depth_texture'),this.getExtension('WEBGL_draw_buffers')),this.getExtension('WEBGL_compressed_texture_astc'),this.getExtension('EXT_texture_compression_bptc'),this.getExtension('WEBGL_compressed_texture_s3tc'),this.getExtension('WEBGL_compressed_texture_etc1'),this.getExtension('WEBGL_compressed_texture_pvrtc'),this.getExtension('WEBKIT_WEBGL_compressed_texture_pvrtc'),this.vertexAttribDivisor=this.getExtension('ANGLE_instanced_arrays','vertexAttribDivisor','vertexAttribDivisorANGLE'),this.drawArraysInstanced=this.getExtension('ANGLE_instanced_arrays','drawArraysInstanced','drawArraysInstancedANGLE'),this.drawElementsInstanced=this.getExtension('ANGLE_instanced_arrays','drawElementsInstanced','drawElementsInstancedANGLE'),this.createVertexArray=this.getExtension('OES_vertex_array_object','createVertexArray','createVertexArrayOES'),this.bindVertexArray=this.getExtension('OES_vertex_array_object','bindVertexArray','bindVertexArrayOES'),this.deleteVertexArray=this.getExtension('OES_vertex_array_object','deleteVertexArray','deleteVertexArrayOES'),this.drawBuffers=this.getExtension('WEBGL_draw_buffers','drawBuffers','drawBuffersWEBGL'),this.parameters={},this.parameters.maxTextureUnits=this.gl.getParameter(this.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this.parameters.maxAnisotropy=this.getExtension('EXT_texture_filter_anisotropic')?this.gl.getParameter(this.getExtension('EXT_texture_filter_anisotropic').MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,Pi.WHITE=new Pi(this.gl,{image:new Uint8Array([255,255,255,255]),width:1,height:1})}Di.prototype={constructor:Di,setClearColor:function(t,i){this.gl.clearColor(t.r,t.g,t.b,i)},setPixelRatio:function(t){this.dpr=t,this.resize(this.width,this.height)},resize:function(t,i){this.width=t,this.height=i,this.gl.canvas.width=t*this.dpr,this.gl.canvas.height=i*this.dpr,this.gl.canvas.style&&Object.assign(this.gl.canvas.style,{width:t+'px',height:i+'px'})},setViewport:function(t,i,e=0,r=0){this.state.viewport.width===t&&this.state.viewport.height===i||(this.state.viewport.width=t,this.state.viewport.height=i,this.state.viewport.x=e,this.state.viewport.y=r,this.gl.viewport(e,r,t,i))},setScissor:function(t,i,e=0,r=0){this.gl.scissor(e,r,t,i)},enable:function(t){!0!==this.state[t]&&(this.gl.enable(t),this.state[t]=!0)},disable:function(t){!1!==this.state[t]&&(this.gl.disable(t),this.state[t]=!1)},setBlendFunc:function(t,i,e,r){this.state.blendFunc.src===t&&this.state.blendFunc.dst===i&&this.state.blendFunc.srcAlpha===e&&this.state.blendFunc.dstAlpha===r||(this.state.blendFunc.src=t,this.state.blendFunc.dst=i,this.state.blendFunc.srcAlpha=e,this.state.blendFunc.dstAlpha=r,void 0!==e?this.gl.blendFuncSeparate(t,i,e,r):this.gl.blendFunc(t,i))},setBlendEquation:function(t,i){t=t||this.gl.FUNC_ADD,this.state.blendEquation.modeRGB===t&&this.state.blendEquation.modeAlpha===i||(this.state.blendEquation.modeRGB=t,this.state.blendEquation.modeAlpha=i,void 0!==i?this.gl.blendEquationSeparate(t,i):this.gl.blendEquation(t))},setCullFace:function(t){this.state.cullFace!==t&&(this.state.cullFace=t,this.gl.cullFace(t))},setFrontFace:function(t){this.state.frontFace!==t&&(this.state.frontFace=t,this.gl.frontFace(t))},setDepthMask:function(t){this.state.depthMask!==t&&(this.state.depthMask=t,this.gl.depthMask(t))},setDepthFunc:function(t){this.state.depthFunc!==t&&(this.state.depthFunc=t,this.gl.depthFunc(t))},activeTexture:function(t){this.state.activeTextureUnit!==t&&(this.state.activeTextureUnit=t,this.gl.activeTexture(this.gl.TEXTURE0+t))},bindFramebuffer:function({target:t=this.gl.FRAMEBUFFER,buffer:i=null}={}){this.state.framebuffer!==i&&(this.state.framebuffer=i,this.gl.bindFramebuffer(t,i))},getExtension:function(t,i,e){return i&&this.gl[i]?this.gl[i].bind(this.gl):(this.extensions[t]||(this.extensions[t]=this.gl.getExtension(t)),i?this.extensions[t]?this.extensions[t][e].bind(this.extensions[t]):null:this.extensions[t])},sortOpaque:function(t,i){return t.renderOrder!==i.renderOrder?t.renderOrder-i.renderOrder:t.material.id!==i.material.id?t.material.id-i.material.id:t.zDepth!==i.zDepth?t.zDepth-i.zDepth:i.id-t.id},sortTransparent:function(t,i){return t.renderOrder!==i.renderOrder?t.renderOrder-i.renderOrder:t.zDepth!==i.zDepth?i.zDepth-t.zDepth:i.id-t.id},sortUI:function(t,i){return t.renderOrder!==i.renderOrder?t.renderOrder-i.renderOrder:t.material.id!==i.material.id?t.material.id-i.material.id:i.id-t.id},getRenderList:function({scene:t,camera:i,frustumCull:e,sort:r}){var s=[];if(i&&e&&i.updateFrustum(),t.traverse((t=>{if(!t.visible)return!0;t.draw&&(e&&t.frustumCulled&&i&&!i.frustumIntersectsMesh(t)||s.push(t))})),r){for(var n=[],h=[],a=[],o=0;o<s.length;o++){var u=s[o];u.material.transparent?u.material.depthTest?h.push(u):a.push(u):n.push(u),u.zDepth=0,0===u.renderOrder&&u.material.depthTest&&i&&(Oi.set(u.worldMatrix.elements[12],u.worldMatrix.elements[13],u.worldMatrix.elements[14]),Oi.applyMatrix4(i.projectionViewMatrix),u.zDepth=Oi.z)}h.sort(this.sortTransparent),s=n.concat(h,a)}return s},render:function({scene:t,camera:i,directionalLight:e,ambientLight:r,target:s=null,update:n=!0,sort:h=!0,frustumCull:a=!1,clear:o}){null===s?(this.bindFramebuffer(),this.setViewport(this.width*this.dpr,this.height*this.dpr)):(this.bindFramebuffer(s),this.setViewport(s.width,s.height)),(o||this.autoClear&&!1!==o)&&(!this.depth||s&&!s.depth||(this.enable(this.gl.DEPTH_TEST),this.setDepthMask(!0)),this.gl.clear((this.color?this.gl.COLOR_BUFFER_BIT:0)|(this.depth?this.gl.DEPTH_BUFFER_BIT:0)|(this.stencil?this.gl.STENCIL_BUFFER_BIT:0))),n&&t.updateTransform(),i&&i.updateTransform();for(var u=this.getRenderList({scene:t,camera:i,frustumCull:a,sort:h}),l=0;l<u.length;l++){var c=u[l];c.geometry.gl||c.geometry.initialize(this.gl),c.material.gl||c.material.initialize(this.gl),c.draw({camera:i,directionalLight:e,ambientLight:r})}i.projectMatrixDirty=!1}};const Ni=35044,ki=new ti,ji=new Bi;function Vi(t,i=1,e=!1){this.isAttribute=!0,this.array=t,this.itemSize=i,this.count=void 0!==t?t.length/i:0,this.normalized=e,this.usage=Ni,this.updateRange={offset:0,count:-1},this.offset=0,this.stride=0,this.instanced=0,this.needsUpdate=!0}function Gi(t,i,e){Vi.call(this,new Int8Array(t),i,e)}function Yi(t,i,e){Vi.call(this,new Uint8Array(t),i,e)}function Xi(t,i,e){Vi.call(this,new Uint8ClampedArray(t),i,e)}function Wi(t,i,e){Vi.call(this,new Int16Array(t),i,e)}function Hi(t,i,e){Vi.call(this,new Uint16Array(t),i,e)}function qi(t,i,e){Vi.call(this,new Int32Array(t),i,e)}function Zi(t,i,e){Vi.call(this,new Uint32Array(t),i,e)}function Ki(t,i,e){Vi.call(this,new Uint16Array(t),i,e)}function Qi(t,i,e){Vi.call(this,new Float32Array(t),i,e)}function $i(t,i,e){Vi.call(this,new Float64Array(t),i,e)}Vi.prototype={constructor:Vi,copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this},applyMatrix3(t){if(2===this.itemSize)for(let i=0,e=this.count;i<e;i++)ji.fromAttribute(this,i),ji.applyMatrix3(t),this.setXY(i,ji.x,ji.y);else if(3===this.itemSize)for(let i=0,e=this.count;i<e;i++)ki.fromAttribute(this,i),ki.applyMatrix3(t),this.setXYZ(i,ki.x,ki.y,ki.z);return this},applyMatrix4(t){for(let i=0,e=this.count;i<e;i++)ki.fromAttribute(this,i),ki.applyMatrix4(t),this.setXYZ(i,ki.x,ki.y,ki.z);return this},applyNormalMatrix(t){for(let i=0,e=this.count;i<e;i++)ki.fromAttribute(this,i),ki.applyNormalMatrix(t),this.setXYZ(i,ki.x,ki.y,ki.z);return this},transformDirection(t){for(let i=0,e=this.count;i<e;i++)ki.fromAttribute(this,i),ki.transformDirection(t),this.setXYZ(i,ki.x,ki.y,ki.z);return this},set(t,i=0){return this.array.set(t,i),this.needsUpdate=!0,this},getX(t){let i=this.array[t*this.itemSize];return this.normalized&&(i=Ci(i,this.array)),i},setX(t,i){return this.normalized&&(i=Fi(i,this.array)),this.array[t*this.itemSize]=i,this},getY(t){let i=this.array[t*this.itemSize+1];return this.normalized&&(i=Ci(i,this.array)),i},setY(t,i){return this.normalized&&(i=Fi(i,this.array)),this.array[t*this.itemSize+1]=i,this},getZ(t){let i=this.array[t*this.itemSize+2];return this.normalized&&(i=Ci(i,this.array)),i},setZ(t,i){return this.normalized&&(i=Fi(i,this.array)),this.array[t*this.itemSize+2]=i,this},getW(t){let i=this.array[t*this.itemSize+3];return this.normalized&&(i=Ci(i,this.array)),i},setW(t,i){return this.normalized&&(i=Fi(i,this.array)),this.array[t*this.itemSize+3]=i,this},setXY(t,i,e){return t*=this.itemSize,this.normalized&&(i=Fi(i,this.array),e=Fi(e,this.array)),this.array[t+0]=i,this.array[t+1]=e,this},setXYZ(t,i,e,r){return t*=this.itemSize,this.normalized&&(i=Fi(i,this.array),e=Fi(e,this.array),r=Fi(r,this.array)),this.array[t+0]=i,this.array[t+1]=e,this.array[t+2]=r,this},setXYZW(t,i,e,r,s){return t*=this.itemSize,this.normalized&&(i=Fi(i,this.array),e=Fi(e,this.array),r=Fi(r,this.array),s=Fi(s,this.array)),this.array[t+0]=i,this.array[t+1]=e,this.array[t+2]=r,this.array[t+3]=s,this},clone(){return new this.constructor(this.array,this.itemSize).copy(this)}},Gi.prototype=Object.assign(Object.create(Vi.prototype),{constructor:Gi}),Yi.prototype=Object.assign(Object.create(Vi.prototype),{constructor:Yi}),Xi.prototype=Object.assign(Object.create(Vi.prototype),{constructor:Xi}),Wi.prototype=Object.assign(Object.create(Vi.prototype),{constructor:Wi}),Hi.prototype=Object.assign(Object.create(Vi.prototype),{constructor:Hi}),qi.prototype=Object.assign(Object.create(Vi.prototype),{constructor:qi}),Zi.prototype=Object.assign(Object.create(Vi.prototype),{constructor:Zi}),Ki.prototype=Object.assign(Object.create(Vi.prototype),{constructor:Ki}),Qi.prototype=Object.assign(Object.create(Vi.prototype),{constructor:Qi}),$i.prototype=Object.assign(Object.create(Vi.prototype),{constructor:$i});var Ji=1;function te({vertex:t,fragment:i,uniforms:e={},transparent:r=!1,cullFace:s=WebGLRenderingContext.BACK,frontFace:n=WebGLRenderingContext.CCW,depthTest:h=!0,depthWrite:a=!0,depthFunc:o=WebGLRenderingContext.LESS}={}){this.id=Ji++,this.uniforms=e,this.vertex=t,this.fragment=i,this.transparent=r,this.cullFace=s,this.frontFace=n,this.depthTest=h,this.depthWrite=a,this.depthFunc=o,this.blendFunc={},this.blendEquation={}}te.prototype={constructor:te,initialize:function(t){var{vertex:i,fragment:e,uniforms:r}=this;this.gl=t,this.transparent&&!this.blendFunc.src&&(this.gl.renderer.premultipliedAlpha?this.setBlendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA):this.setBlendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA));var s=t.createShader(t.VERTEX_SHADER);t.shaderSource(s,i),t.compileShader(s),t.getShaderInfoLog(s);var n=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(n,e),t.compileShader(n),t.getShaderInfoLog(n),this.program=t.createProgram(),t.attachShader(this.program,s),t.attachShader(this.program,n),t.linkProgram(this.program),t.getProgramParameter(this.program,t.LINK_STATUS)){t.deleteShader(s),t.deleteShader(n),this.uniformLocations=new Map;for(var h=t.getProgramParameter(this.program,t.ACTIVE_UNIFORMS),a=0;a<h;a++){var o=t.getActiveUniform(this.program,a),u=t.getUniformLocation(this.program,o.name);this.uniformLocations.set(o,u);var l=o.name.match(/(\w+)/g);o.uniformName=l[0],o.nameComponents=l.slice(1),r[o.name]&&(r[o.name].location=u)}this.attributeLocations=new Map;for(var c=[],d=t.getProgramParameter(this.program,t.ACTIVE_ATTRIBUTES),f=0;f<d;f++){var p=t.getActiveAttrib(this.program,f);-1!==(u=t.getAttribLocation(this.program,p.name))&&(c[u]=p.name,this.attributeLocations.set(p,u))}this.attributeOrder=c.join('')}},setBlendFunc:function(t,i,e,r){this.blendFunc.src=t,this.blendFunc.dst=i,this.blendFunc.srcAlpha=e,this.blendFunc.dstAlpha=r,t&&(this.transparent=!0)},setBlendEquation:function(t,i){this.blendEquation.modeRGB=t,this.blendEquation.modeAlpha=i},applyState:function(){this.depthTest?this.gl.renderer.enable(this.gl.DEPTH_TEST):this.gl.renderer.disable(this.gl.DEPTH_TEST),this.cullFace?this.gl.renderer.enable(this.gl.CULL_FACE):this.gl.renderer.disable(this.gl.CULL_FACE),this.blendFunc.src?this.gl.renderer.enable(this.gl.BLEND):this.gl.renderer.disable(this.gl.BLEND),this.cullFace&&this.gl.renderer.setCullFace(this.cullFace),this.gl.renderer.setFrontFace(this.frontFace),this.gl.renderer.setDepthMask(this.depthWrite),this.gl.renderer.setDepthFunc(this.depthFunc),this.blendFunc.src&&this.gl.renderer.setBlendFunc(this.blendFunc.src,this.blendFunc.dst,this.blendFunc.srcAlpha,this.blendFunc.dstAlpha),this.gl.renderer.setBlendEquation(this.blendEquation.modeRGB,this.blendEquation.modeAlpha)},use:function({flipFaces:t=!1}={}){var i=-1;this.gl.renderer.state.currentProgram===this.id||(this.gl.useProgram(this.program),this.gl.renderer.state.currentProgram=this.id),this.uniformLocations.forEach(((t,e)=>{var r=this.uniforms[e.uniformName];for(var s of e.nameComponents){if(!r)break;if(!(s in r)){if(Array.isArray(r.value))break;r=void 0;break}r=r[s]}return r?r&&void 0===r.value?ee(`${e.name} uniform is missing a value parameter`):(r.isTextureUniform&&this.gl.renderer.state.currentTexture!==r.value&&(this.gl.renderer.state.currentTexture=r.value,i+=1,r.value.update(i),r.apply(this.gl,i)),void(r.dirty&&r.apply(this.gl))):ee(`Active uniform ${e.name} has not been supplied`)})),this.applyState(),t&&this.gl.renderer.setFrontFace(this.frontFace===this.gl.CCW?this.gl.CW:this.gl.CCW)},remove:function(){this.gl.deleteProgram(this.program)}};var ie=0;function ee(t){ie>100||ie++}function re({value:t,boundary:i,itemSize:e}){this.boundary=i,this.itemSize=e,this.location=null,this.glValue=1===e?0:new Float32Array(this.itemSize),this.dirty=!1,t&&this.set(t)}function se(t){re.call(this,{value:t,boundary:0,itemSize:1})}function ne(t){re.call(this,{value:t,boundary:0,itemSize:1})}function he(t){re.call(this,{value:t,boundary:8,itemSize:2})}function ae(t){re.call(this,{value:t,boundary:12,itemSize:3})}function oe(t){re.call(this,{value:t,boundary:16,itemSize:4})}function ue(t){re.call(this,{value:t,boundary:16,itemSize:3})}function le(t){re.call(this,{value:t,boundary:48,itemSize:12})}function ce(t){re.call(this,{value:t,boundary:64,itemSize:16})}re.prototype={constructor:re,set(t){this.value=t,this.dirty=!0},apply(t){}},se.prototype=Object.assign(Object.create(re),{constructor:se,set:function(t){re.prototype.set.call(this,t),this.glValue=t},apply:function(t){t.uniform1f(this.location,this.glValue),this.dirty=!1}}),ne.prototype=Object.assign(re.prototype,{constructor:ne,isTextureUniform:!0,apply:function(t,i){t.uniform1i(this.location,i),this.dirty=!1}}),he.prototype=Object.assign(Object.create(re),{constructor:he,set:function(t){re.prototype.set.call(this).call(this,t),this.glValue[0]=t.x,this.glValue[1]=t.y},apply:function(t){t.uniform2fv(this.location,this.glValue),this.dirty=!1}}),ae.prototype=Object.assign(Object.create(re),{constructor:ae,set:function(t){re.prototype.set.call(this,t),this.glValue[0]=t.x,this.glValue[1]=t.y,this.glValue[2]=t.z},apply:function(t){t.uniform3fv(this.location,this.glValue),this.dirty=!1}}),oe.prototype=Object.assign(Object.create(re),{constructor:oe,set:function(t){re.prototype.set.call(this,t),this.glValue[0]=t.x,this.glValue[1]=t.y,this.glValue[2]=t.z,this.glValue[3]=t.w},apply:function(t){t.uniform4fv(this.location,this.glValue),this.dirty=!1}}),ue.prototype=Object.assign(Object.create(re),{constructor:ue,set:function(t){re.prototype.set.call(this,t),this.glValue[0]=t.r,this.glValue[1]=t.g,this.glValue[2]=t.b},apply:function(t){t.uniform3fv(this.location,this.glValue),this.dirty=!1}}),le.prototype=Object.assign(Object.create(re),{constructor:le,set:function(t){re.prototype.set.call(this,t),this.glValue.set(t.elements)},apply:function(t){t.uniformMatrix3fv(this.location,!1,this.glValue),this.dirty=!1}}),ce.prototype=Object.assign(Object.create(re),{constructor:ce,set:function(t){re.prototype.set.call(this,t),this.glValue.set(t.elements)},apply:function(t){t.uniformMatrix4fv(this.location,!1,this.glValue),this.dirty=!1}});function de({map:t=Pi.WHITE,color:i=l.WHITE,opacity:e=1,transparent:r=!1,cullFace:s=WebGLRenderingContext.BACK,frontFace:n=WebGLRenderingContext.CCW,depthTest:h=!0,depthWrite:a=!0,depthFunc:o=WebGLRenderingContext.LESS}={}){te.call(this,{vertex:"\n    attribute vec3 position;\n    attribute float size;\n\n    uniform mat4 projectViewMatrix;\n    uniform mat4 modelMatrix;\n\n    void main() {\n        gl_Position = projectViewMatrix * modelMatrix * vec4(position, 1.0);\n        gl_PointSize = size;\n    }\n",fragment:"\n    precision highp float;\n\n    uniform sampler2D uMap;\n    uniform vec3 uColor;\n    uniform float uOpacity;\n    \n    void main() {\n      vec4 tex = texture2D(uMap, gl_PointCoord);\n        \n      gl_FragColor = tex * vec4(uColor, uOpacity);\n    }\n",uniforms:{uMap:new ne(t),uColor:new ue(i),uOpacity:new se(e),modelMatrix:new ce,projectViewMatrix:new ce},transparent:r,cullFace:s,frontFace:n,depthTest:h,depthWrite:a,depthFunc:o})}de.prototype=Object.create(te.prototype),de.prototype.constructor=de;function fe({map:t=Pi.WHITE,color:i=l.WHITE,opacity:e=1,transparent:r=!1,cullFace:s=WebGLRenderingContext.BACK,frontFace:n=WebGLRenderingContext.CCW,depthTest:h=!0,depthWrite:a=!0,depthFunc:o=WebGLRenderingContext.LESS}={}){te.call(this,{vertex:"\n    attribute vec2 uv;\n    attribute vec3 position;\n\n    uniform mat4 projectViewMatrix;\n    uniform mat4 modelMatrix;\n\n    varying vec2 vUv;\n\n    void main() {\n        vUv = uv;\n        \n        gl_Position = projectViewMatrix * modelMatrix * vec4(position, 1.0);\n    }\n",fragment:"\n    precision highp float;\n\n    uniform sampler2D uMap;\n    uniform vec3 uColor;\n    uniform float uOpacity;\n\n    varying vec2 vUv;\n\n    void main() {\n        vec4 tex = texture2D(uMap, vUv);\n        \n        gl_FragColor = tex * vec4(uColor, uOpacity);\n    }\n",uniforms:{uMap:new ne(t),uColor:new ue(i),uOpacity:new se(e),modelMatrix:new ce,projectViewMatrix:new ce},transparent:r,cullFace:s,frontFace:n,depthTest:h,depthWrite:a,depthFunc:o})}fe.prototype=Object.create(te.prototype),fe.prototype.constructor=fe;function pe({map:t=Pi.WHITE,color:i=l.WHITE,opacity:e=1,transparent:r=!1,cullFace:s=WebGLRenderingContext.BACK,frontFace:n=WebGLRenderingContext.CCW,depthTest:h=!0,depthWrite:a=!0,depthFunc:o=WebGLRenderingContext.LESS}={}){te.call(this,{vertex:"\n    attribute vec2 uv;\n    attribute vec3 position;\n    attribute vec3 normal;\n    \n    uniform mat4 projectViewMatrix;\n    uniform mat4 modelMatrix;\n\n    varying vec2 vUv;\n    varying vec3 vNormal;\n\n    void main() {\n        vUv = uv;\n        vNormal = mat3(modelMatrix) * normal;\n        \n        gl_Position = projectViewMatrix * modelMatrix * vec4(position, 1.0);\n    }\n",fragment:"\n    precision highp float;\n    \n    uniform vec4 ambientLight;\n    \n    uniform vec4 directionalLight;\n    uniform vec3 directionalLightDirection;\n\n    uniform sampler2D uMap;\n    uniform vec3 uColor;\n    uniform float uOpacity;\n\n    varying vec2 vUv;\n    varying vec3 vNormal;\n\n    void main() {\n        vec3 normal = normalize(vNormal);\n        vec4 tex = texture2D(uMap, vUv);\n        \n        float directional = max(dot(normal, normalize(directionalLightDirection)), 0.0);\n        \n        vec3 directLightColor = directionalLight.rgb * directionalLight.a * directional;\n        \n        vec3 ambLightColor = ambientLight.rgb * ambientLight.a;\n        \n        gl_FragColor.rgb = tex.rgb * (ambLightColor + directLightColor) * uColor;\n        gl_FragColor.a = tex.a * uOpacity;\n    }\n",uniforms:{uColor:new ue(i),uMap:new ne(t),uOpacity:new se(e),modelMatrix:new ce,projectViewMatrix:new ce,directionalLight:new oe,directionalLightDirection:new ae,ambientLight:new oe},transparent:r,cullFace:s,frontFace:n,depthTest:h,depthWrite:a,depthFunc:o}),this.isMeshLambertMaterial=!0}pe.prototype=Object.create(te.prototype),pe.prototype.constructor=pe;function ye({map:t=Pi.WHITE,color:i=l.WHITE,opacity:e=1,transparent:r=!1,cullFace:s=WebGLRenderingContext.BACK,frontFace:n=WebGLRenderingContext.CCW,depthTest:h=!0,depthWrite:a=!0,depthFunc:o=WebGLRenderingContext.LESS}={}){te.call(this,{vertex:"\n    attribute vec2 uv;\n    attribute vec3 position;\n    \n    attribute mat4 instanceMatrix;\n\n    uniform mat4 projectViewMatrix;\n    uniform mat4 modelMatrix;\n\n    varying vec2 vUv;\n\n    void main() {\n        vUv = uv;\n        \n        gl_Position = projectViewMatrix * instanceMatrix * modelMatrix * vec4(position, 1.0);\n    }\n",fragment:"\n    precision highp float;\n\n    uniform sampler2D uMap;\n    uniform vec3 uColor;\n    uniform float uOpacity;\n\n    varying vec2 vUv;\n\n    void main() {\n        vec4 tex = texture2D(uMap, vUv);\n        \n        gl_FragColor = tex * vec4(uColor, uOpacity);\n    }\n",uniforms:{uMap:new ne(t),uColor:new ue(i),uOpacity:new se(e),modelMatrix:new ce,projectViewMatrix:new ce},transparent:r,cullFace:s,frontFace:n,depthTest:h,depthWrite:a,depthFunc:o}),this.InstancedMeshBasicMaterial=!0}ye.prototype=Object.create(te.prototype),ye.prototype.constructor=ye;function me({map:t=Pi.WHITE,color:i=l.WHITE,opacity:e=1,transparent:r=!1,cullFace:s=WebGLRenderingContext.BACK,frontFace:n=WebGLRenderingContext.CCW,depthTest:h=!0,depthWrite:a=!0,depthFunc:o=WebGLRenderingContext.LESS}={}){te.call(this,{vertex:"\n    attribute vec2 uv;\n    attribute vec3 position;\n    attribute vec3 normal;\n    \n    attribute mat4 instanceMatrix;\n    \n    uniform mat4 projectViewMatrix;\n    uniform mat4 modelMatrix;\n    \n    varying vec2 vUv;\n    varying vec3 vNormal;\n    \n    void main() {\n        vUv = uv;\n    \n        mat4 modelInstancedMatrix = modelMatrix * instanceMatrix;\n    \n        vNormal = mat3(modelInstancedMatrix) * normal;\n    \n        gl_Position = projectViewMatrix * modelInstancedMatrix * vec4(position, 1.0);\n    }\n",fragment:"\n    precision highp float;\n    \n    uniform vec4 ambientLight;\n    \n    uniform vec4 directionalLight;\n    uniform vec3 directionalLightDirection;\n\n    uniform sampler2D uMap;\n    uniform vec3 uColor;\n    uniform float uOpacity;\n\n    varying vec2 vUv;\n    varying vec3 vNormal;\n\n    void main() {\n        vec3 normal = normalize(vNormal);\n        vec4 tex = texture2D(uMap, vUv);\n        \n        float directional = max(dot(normal, normalize(directionalLightDirection)), 0.0);\n        \n        vec3 directLightColor = directionalLight.rgb * directionalLight.a * directional;\n        \n        vec3 ambLightColor = ambientLight.rgb * ambientLight.a;\n        \n        gl_FragColor.rgb = tex.rgb * (ambLightColor + directLightColor) * uColor;\n        gl_FragColor.a = tex.a * uOpacity;\n    }\n",uniforms:{uColor:new ue(i),uMap:new ne(t),uOpacity:new se(e),modelMatrix:new ce,projectViewMatrix:new ce,directionalLight:new oe,directionalLightDirection:new ae,ambientLight:new oe},transparent:r,cullFace:s,frontFace:n,depthTest:h,depthWrite:a,depthFunc:o}),this.isInstancedMeshLambertMaterial=!0}me.prototype=Object.create(te.prototype),me.prototype.constructor=me;var xe=new ti;function ge(){this.elements=[1,0,0,0,1,0,0,0,1]}Object.assign(ge.prototype,{isMatrix3:!0,set:function(t,i,e,r,s,n,h,a,o){var u=this.elements;return u[0]=t,u[1]=r,u[2]=h,u[3]=i,u[4]=s,u[5]=a,u[6]=e,u[7]=n,u[8]=o,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t){var i=this.elements,e=t.elements;return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],this},setFromMatrix4:function(t){var i=t.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this},applyToBufferAttribute:function(t){for(var i=0,e=t.count;i<e;i++)xe.x=t.getX(i),xe.y=t.getY(i),xe.z=t.getZ(i),xe.applyMatrix3(this),t.setXYZ(i,xe.x,xe.y,xe.z);return t},multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,i){var e=t.elements,r=i.elements,s=this.elements,n=e[0],h=e[3],a=e[6],o=e[1],u=e[4],l=e[7],c=e[2],d=e[5],f=e[8],p=r[0],y=r[3],m=r[6],x=r[1],g=r[4],v=r[7],_=r[2],w=r[5],b=r[8];return s[0]=n*p+h*x+a*_,s[3]=n*y+h*g+a*w,s[6]=n*m+h*v+a*b,s[1]=o*p+u*x+l*_,s[4]=o*y+u*g+l*w,s[7]=o*m+u*v+l*b,s[2]=c*p+d*x+f*_,s[5]=c*y+d*g+f*w,s[8]=c*m+d*v+f*b,this},multiplyScalar:function(t){var i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=t,i[4]*=t,i[7]*=t,i[2]*=t,i[5]*=t,i[8]*=t,this},determinant:function(){var t=this.elements,i=t[0],e=t[1],r=t[2],s=t[3],n=t[4],h=t[5],a=t[6],o=t[7],u=t[8];return i*n*u-i*h*o-e*s*u+e*h*a+r*s*o-r*n*a},getInverse:function(t,i){t&&t.isMatrix4;var e=t.elements,r=this.elements,s=e[0],n=e[1],h=e[2],a=e[3],o=e[4],u=e[5],l=e[6],c=e[7],d=e[8],f=d*o-u*c,p=u*l-d*a,y=c*a-o*l,m=s*f+n*p+h*y;if(0===m){if(!0===i)throw new Error("Tiny.Matrix3: .getInverse() can't invert matrix, determinant is 0");return this.identity()}var x=1/m;return r[0]=f*x,r[1]=(h*c-d*n)*x,r[2]=(u*n-h*o)*x,r[3]=p*x,r[4]=(d*s-h*l)*x,r[5]=(h*a-u*s)*x,r[6]=y*x,r[7]=(n*l-c*s)*x,r[8]=(o*s-n*a)*x,this},transpose:function(){var t,i=this.elements;return t=i[1],i[1]=i[3],i[3]=t,t=i[2],i[2]=i[6],i[6]=t,t=i[5],i[5]=i[7],i[7]=t,this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){var i=this.elements;return t[0]=i[0],t[1]=i[3],t[2]=i[6],t[3]=i[1],t[4]=i[4],t[5]=i[7],t[6]=i[2],t[7]=i[5],t[8]=i[8],this},setUvTransform:function(t,i,e,r,s,n,h){var a=Math.cos(s),o=Math.sin(s);this.set(e*a,e*o,-e*(a*n+o*h)+n+t,-r*o,r*a,-r*(-o*n+a*h)+h+i,0,0,1)},scale:function(t,i){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=i,e[4]*=i,e[7]*=i,this},rotate:function(t){var i=Math.cos(t),e=Math.sin(t),r=this.elements,s=r[0],n=r[3],h=r[6],a=r[1],o=r[4],u=r[7];return r[0]=i*s+e*a,r[3]=i*n+e*o,r[6]=i*h+e*u,r[1]=-e*s+i*a,r[4]=-e*n+i*o,r[7]=-e*h+i*u,this},translate:function(t,i){var e=this.elements;return e[0]+=t*e[2],e[3]+=t*e[5],e[6]+=t*e[8],e[1]+=i*e[2],e[4]+=i*e[5],e[7]+=i*e[8],this},equals:function(t){for(var i=this.elements,e=t.elements,r=0;r<9;r++)if(i[r]!==e[r])return!1;return!0},fromArray:function(t,i){void 0===i&&(i=0);for(var e=0;e<9;e++)this.elements[e]=t[e+i];return this},toArray:function(t,i){void 0===t&&(t=[]),void 0===i&&(i=0);var e=this.elements;return t[i]=e[0],t[i+1]=e[1],t[i+2]=e[2],t[i+3]=e[3],t[i+4]=e[4],t[i+5]=e[5],t[i+6]=e[6],t[i+7]=e[7],t[i+8]=e[8],t}});var ve=new oi,_e=new ti,we=1,be=!1;function Me(t={}){this.id=we++,this.attributes=t,this.index=null,this.VAOs={},this.drawRange={start:0,count:0},this.instancedCount=0}function Ee(t,i,e,r){t=t||1,i=i||1;const s=e||1,n=r||1,h=(s+1)*(n+1),a=s*n*6,o=new Float32Array(3*h),u=new Float32Array(3*h),l=new Float32Array(2*h),c=a>65536?new Uint32Array(a):new Uint16Array(a);Ee.buildPlane(o,u,l,c,t,i,0,s,n),Me.call(this,{position:new Qi(o,3),normal:new Qi(u,3),uv:new Qi(l,2)}),this.setIndex(new Hi(c))}function Ae(t,i,e,r,s,n){t=t||1,i=i||1,e=e||1;const h=r||1,a=s||1,o=n||1,u=(h+1)*(a+1)*2+(h+1)*(o+1)*2+(a+1)*(o+1)*2,l=6*(h*a*2+h*o*2+a*o*2),c=new Float32Array(3*u),d=new Float32Array(3*u),f=new Float32Array(2*u),p=u>65536?new Uint32Array(l):new Uint16Array(l);let y=0,m=0;Ee.buildPlane(c,d,f,p,e,i,t,o,a,2,1,0,-1,-1,y,m),y+=(o+1)*(a+1),m+=o*a,Ee.buildPlane(c,d,f,p,e,i,-t,o,a,2,1,0,1,-1,y,m),y+=(o+1)*(a+1),m+=o*a,Ee.buildPlane(c,d,f,p,t,e,i,o,h,0,2,1,1,1,y,m),y+=(h+1)*(o+1),m+=h*o,Ee.buildPlane(c,d,f,p,t,e,-i,o,h,0,2,1,1,-1,y,m),y+=(h+1)*(o+1),m+=h*o,Ee.buildPlane(c,d,f,p,t,i,-e,h,a,0,1,2,-1,-1,y,m),y+=(h+1)*(a+1),m+=h*a,Ee.buildPlane(c,d,f,p,t,i,e,h,a,0,1,2,1,-1,y,m),Me.call(this,{position:new Qi(c,3),normal:new Qi(d,3),uv:new Qi(f,2)}),this.setIndex(new Hi(p))}Me.prototype={constructor:Me,initialize:function(t){var{attributes:i}=this;for(var e in this.gl=t,this.gl.renderer.bindVertexArray(null),this.gl.renderer.currentGeometry=null,this.glState=this.gl.renderer.state,i)this.setAttribute(e,i[e])},translate:function(t,i,e){return ve.makeTranslation(t,i,e),this.applyMatrix4(ve),this},clone:function(){return(new this.constructor).copy(this)},scale:function(t,i,e){return ve.makeScale(t,i,e),this.applyMatrix4(ve),this},applyMatrix4:function(t){var i=this.attributes.position;void 0!==i&&(i.applyMatrix4(t),i.needsUpdate=!0);var e=this.attributes.normal;if(void 0!==e){var r=(new ge).getNormalMatrix(t);e.applyNormalMatrix(r),e.needsUpdate=!0}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},copy:function(t){this.index=null,this.attributes={},this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var i=t.attributes;for(var e in i)this.attributes[e]=i[e].clone();return t.index&&this.setIndex(t.index.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this},setAttribute:function(t,i){return this.attributes[t]=i,this.index||(this.drawRange.count=Math.max(this.drawRange.count,i.count)),this},updateAttribute:function(t,i=this.gl.ARRAY_BUFFER){var e=!t.buffer;e&&(t.buffer=this.gl.createBuffer()),this.glState.boundBuffer!==t.buffer&&(this.gl.bindBuffer(i,t.buffer),this.glState.boundBuffer=t.buffer),e?this.gl.bufferData(i,t.array,t.usage):this.gl.bufferSubData(i,0,t.array),t.needsUpdate=!1},setIndex:function(t){this.index=t,this.drawRange.count=t.count},setDrawRange:function(t,i){this.drawRange.start=t,this.drawRange.count=i},setInstancedCount:function(t){this.instancedCount=t},createVAO:function(t){this.VAOs[t.attributeOrder]=this.gl.renderer.createVertexArray(),this.gl.renderer.bindVertexArray(this.VAOs[t.attributeOrder]),this.bindAttributes(t)},bindAttributes:function(t){t.attributeLocations.forEach(((t,{name:i,type:e})=>{if(this.attributes[i]){var r=this.attributes[i];r.buffer||this.updateAttribute(r),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,r.buffer),this.glState.boundBuffer=r.buffer;var s=1;35674===e&&(s=2),35675===e&&(s=3),35676===e&&(s=4);for(var n=r.itemSize/s,h=1===s?0:s*s*4,a=1===s?0:4*s,o=0;o<s;o++)this.gl.vertexAttribPointer(t+o,n,this.gl.FLOAT,r.normalized,r.stride+h,r.offset+o*a),this.gl.enableVertexAttribArray(t+o),this.gl.renderer.vertexAttribDivisor(t+o,r.instanced)}})),this.index&&this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.index.buffer)},draw:function({material:t,mode:i=WebGLRenderingContext.TRIANGLES}){this.gl.renderer.currentGeometry!==`${this.id}_${t.attributeOrder}`&&(this.VAOs[t.attributeOrder]||this.createVAO(t),this.gl.renderer.bindVertexArray(this.VAOs[t.attributeOrder]),this.gl.renderer.currentGeometry=`${this.id}_${t.attributeOrder}`),t.attributeLocations.forEach(((t,{name:i})=>{var e=this.attributes[i];e&&e.needsUpdate&&this.updateAttribute(e)})),this.index&&this.index.needsUpdate&&this.updateAttribute(this.index,this.gl.ELEMENT_ARRAY_BUFFER);var e=2;this.index?.type===this.gl.UNSIGNED_INT&&(e=4),this.isInstanced?this.index?this.gl.renderer.drawElementsInstanced(i,this.drawRange.count,this.gl.UNSIGNED_SHORT,this.index.offset+this.drawRange.start*e,this.instancedCount):this.gl.renderer.drawArraysInstanced(i,this.drawRange.start,this.drawRange.count,this.instancedCount):this.index?this.gl.drawElements(i,this.drawRange.count,this.gl.UNSIGNED_SHORT,this.index.offset+this.drawRange.start*e):this.gl.drawArrays(i,this.drawRange.start,this.drawRange.count)},getPosition:function(){var t=this.attributes.position;return t.array?t:be?void 0:be=!0},computeBoundingBox:function(t){t||(t=this.getPosition());var i=t.array,e=t.itemSize;this.bounds||(this.bounds={min:new ti,max:new ti,center:new ti,scale:new ti,radius:1/0});var r=this.bounds.min,s=this.bounds.max,n=this.bounds.center,h=this.bounds.scale;r.set(1/0,1/0,1/0),s.set(-1/0,-1/0,-1/0);for(var a=0,o=i.length;a<o;a+=e){var u=i[a],l=i[a+1],c=i[a+2];r.x=Math.min(u,r.x),r.y=Math.min(l,r.y),r.z=Math.min(c,r.z),s.x=Math.max(u,s.x),s.y=Math.max(l,s.y),s.z=Math.max(c,s.z)}h.subVectors(s,r),n.subVectors(r,s).divideScalar(2)},computeBoundingSphere:function(t){t||(t=this.getPosition());var i=t.array,e=t.itemSize;this.bounds||this.computeBoundingBox(t);for(var r=0,s=0,n=i.length;s<n;s+=e)_e.fromArray(i,s),r=Math.max(r,this.bounds.center.distanceToSquared(_e));this.bounds.radius=Math.sqrt(r)},computeVertexNormals:function(){var t=this.index,i=this.attributes.position;if(void 0!==i){var e=this.attributes.normal;void 0===e&&(this.setAttribute('normal',new Qi(new Float32Array(3*i.count),3)),e=this.attributes.normal);var r=new ti,s=new ti,n=new ti,h=new ti,a=new ti,o=new ti,u=new ti,l=new ti;if(t)for(var c=0,d=t.count;c<d;c+=3){var f=t.getX(c),p=t.getX(c+1),y=t.getX(c+2);r.fromAttribute(i,f),s.fromAttribute(i,p),n.fromAttribute(i,y),u.subVectors(n,s),l.subVectors(r,s),u.cross(l),h.fromAttribute(e,f),a.fromAttribute(e,p),o.fromAttribute(e,y),h.add(u),a.add(u),o.add(u),e.setXYZ(f,h.x,h.y,h.z),e.setXYZ(p,a.x,a.y,a.z),e.setXYZ(y,o.x,o.y,o.z)}e.needsUpdate=!0}},remove:function(){for(var t in this.VAOs)this.gl.renderer.deleteVertexArray(this.VAOs[t]),delete this.VAOs[t];for(var t in this.attributes)this.gl.deleteBuffer(this.attributes[t].buffer),delete this.attributes[t]}},Tiny.Geometry=Me,Ee.prototype=Object.create(Me.prototype),Ee.prototype.constructor=Ee,Ee.buildPlane=function(t,i,e,r,s,n,h,a,o,u,l,c,d,f,p,y){u=u||0,l=void 0!==l?l:1,c=void 0!==c?c:2,d=void 0!==d?d:1,f=void 0!==f?f:-1,y=y||0;const m=p=p||0,x=s/a,g=n/o;for(let v=0;v<=o;v++){let _=v*g-n/2;for(let n=0;n<=a;n++,p++){let g=n*x-s/2;if(t[3*p+u]=g*d,t[3*p+l]=_*f,t[3*p+c]=h/2,i[3*p+u]=0,i[3*p+l]=0,i[3*p+c]=h>=0?1:-1,e[2*p]=n/a,e[2*p+1]=1-v/o,v===o||n===a)continue;let w=m+n+v*(a+1),b=m+n+(v+1)*(a+1),M=m+n+(v+1)*(a+1)+1,E=m+n+v*(a+1)+1;r[6*y]=w,r[6*y+1]=b,r[6*y+2]=E,r[6*y+3]=b,r[6*y+4]=M,r[6*y+5]=E,y++}}},Ae.prototype=Object.create(Me.prototype),Ae.prototype.constructor=Ae,Tiny.Vec3=ti,Tiny.Mat4=oi,Tiny.Quat=Qt,Tiny.Object3D=mi,Tiny.Mesh=vi,Tiny.InstancedMesh=_i,Tiny.Light=wi,Tiny.AmbientLight=bi,Tiny.DirectionalLight=Mi,Tiny.Camera=Ei,Tiny.OrthographicCamera=Si,Tiny.WebGLRenderer=Di,Tiny.WebGlTexture=Pi,Tiny.PlaneGeometry=Ee,Tiny.BoxGeometry=Ae,Tiny.Material=te,Tiny.MeshBasicMaterial=fe,Tiny.MeshLambertMaterial=pe,Tiny.PointsMaterial=de,Tiny.InstancedMeshBasicMaterial=ye,Tiny.InstancedMeshLambertMaterial=me,Tiny.Uniform=re,Tiny.FloatUniform=se,Tiny.TextureUniform=ne,Tiny.Vector2Uniform=he,Tiny.Vector3Uniform=ae,Tiny.Vector4Uniform=oe,Tiny.ColorUniform=ue,Tiny.Matrix3Uniform=le,Tiny.Matrix4Uniform=ce,Tiny.Attribute=Vi,Tiny.Float64Attribute=$i,Tiny.Float32Attribute=Qi,Tiny.Float16Attribute=Ki,Tiny.Uint32Attribute=Zi,Tiny.Int32Attribute=qi,Tiny.Uint16Attribute=Hi,Tiny.Int16Attribute=Wi,Tiny.Uint8ClampedAttribute=Xi,Tiny.Uint8Attribute=Yi,Tiny.Int8Attribute=Gi}()}();